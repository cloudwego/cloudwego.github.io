<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.151.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Getting Started | CloudWeGo</title><meta name=description content="A leading practice for building enterprise cloud native middleware!"><meta property="og:url" content="https://www.cloudwego.io/docs/volo/motore/getting_started/"><meta property="og:site_name" content="CloudWeGo"><meta property="og:title" content="Getting Started"><meta property="og:description" content="This document introduces the core concepts of the Motore framework through a complete example to help you quickly understand Motore."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2025-11-24T16:04:16+08:00"><meta itemprop=name content="Getting Started"><meta itemprop=description content="This document introduces the core concepts of the Motore framework through a complete example to help you quickly understand Motore."><meta itemprop=dateModified content="2025-11-24T16:04:16+08:00"><meta itemprop=wordCount content="1722"><meta itemprop=keywords content="Motore,Volo,Rust,Middleware,Getting Started"><meta name=twitter:card content="summary"><meta name=twitter:title content="Getting Started"><meta name=twitter:description content="This document introduces the core concepts of the Motore framework through a complete example to help you quickly understand Motore."><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYWRQRLPRM"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QYWRQRLPRM")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?f1808c42af827f368aa7eca3baae6d55",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=preload href=/scss/main.min.d82085885aff5076523f2bb4904f9e11bd16c28b46ecb5319ec0d01cb087e9de.css as=style><link href=/scss/main.min.d82085885aff5076523f2bb4904f9e11bd16c28b46ecb5319ec0d01cb087e9de.css rel=stylesheet integrity><script src=/js/jquery.min.js></script><link rel=stylesheet href=/css/prism.css><link rel=stylesheet href=/css/docsearch.css></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand-xl navbar-dark td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><img src=/img/logo.png></span>
</a><button class=navbar-toggler type=button data-toggle=collapse data-target=#main_navbar aria-controls=main_navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0 ml-auto"><li class="dropdown sub-menu active"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>Documentation</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/docs/kitex/>Kitex</a>
<a class=dropdown-item href=/docs/hertz/>Hertz</a>
<a class=dropdown-item href=/docs/volo/>Volo</a>
<a class=dropdown-item href=/docs/netpoll/>Netpoll</a>
<a class=dropdown-item href=/docs/eino/>Eino</a></div></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/about/><span>About</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><span>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cooperation/><span>Cooperation</span></a></li><li class="dropdown sub-menu"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>Security</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/security/safety-bulletin/>safety-bulletin</a>
<a class=dropdown-item href=/security/vulnerability-reporting/>vulnerability-reporting</a></div></li><li class="nav-item dropdown mr-4"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/docs/volo/motore/getting_started/>中文</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><div id=docsearch></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div id=docsearch></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav foldable-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/docs/volo/motore/getting_started/>中文</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsvolo-li><input type=checkbox id=m-docsvolo-check checked>
<label for=m-docsvolo-check><a href=/docs/volo/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvolo><span>Volo</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvolooverview-li><input type=checkbox id=m-docsvolooverview-check checked>
<label for=m-docsvolooverview-check><a href=/docs/volo/overview/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvolooverview><span>Overview</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsvolocli-li><input type=checkbox id=m-docsvolocli-check checked>
<label for=m-docsvolocli-check><a href=/docs/volo/cli/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvolocli><span>Cli</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvolocligetting-started-li><input type=checkbox id=m-docsvolocligetting-started-check>
<label for=m-docsvolocligetting-started-check><a href=/docs/volo/cli/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvolocligetting-started><span>Getting Started</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvoloclimigrate-li><input type=checkbox id=m-docsvoloclimigrate-check>
<label for=m-docsvoloclimigrate-check><a href=/docs/volo/cli/migrate/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvoloclimigrate><span>Migrate</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsvolovolo-http-li><input type=checkbox id=m-docsvolovolo-http-check checked>
<label for=m-docsvolovolo-http-check><a href=/docs/volo/volo-http/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvolovolo-http><span>Volo-HTTP</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvolovolo-httpoverview-li><input type=checkbox id=m-docsvolovolo-httpoverview-check>
<label for=m-docsvolovolo-httpoverview-check><a href=/docs/volo/volo-http/overview/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvolovolo-httpoverview><span>Overview</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvolovolo-httpgetting-started-li><input type=checkbox id=m-docsvolovolo-httpgetting-started-check>
<label for=m-docsvolovolo-httpgetting-started-check><a href=/docs/volo/volo-http/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvolovolo-httpgetting-started><span>Getting Started</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsvolovolo-httptutorials-li><input type=checkbox id=m-docsvolovolo-httptutorials-check>
<label for=m-docsvolovolo-httptutorials-check><a href=/docs/volo/volo-http/tutorials/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvolovolo-httptutorials><span>Tutorials</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvolovolo-httptutorialsroute-li><input type=checkbox id=m-docsvolovolo-httptutorialsroute-check>
<label for=m-docsvolovolo-httptutorialsroute-check><a href=/docs/volo/volo-http/tutorials/route/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsvolovolo-httptutorialsroute><span>Route</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvolovolo-httptutorialsrequest-li><input type=checkbox id=m-docsvolovolo-httptutorialsrequest-check>
<label for=m-docsvolovolo-httptutorialsrequest-check><a href=/docs/volo/volo-http/tutorials/request/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsvolovolo-httptutorialsrequest><span>Request</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvolovolo-httptutorialsresponse-li><input type=checkbox id=m-docsvolovolo-httptutorialsresponse-check>
<label for=m-docsvolovolo-httptutorialsresponse-check><a href=/docs/volo/volo-http/tutorials/response/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsvolovolo-httptutorialsresponse><span>Response</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvolovolo-httptutorialsmiddleware-li><input type=checkbox id=m-docsvolovolo-httptutorialsmiddleware-check>
<label for=m-docsvolovolo-httptutorialsmiddleware-check><a href=/docs/volo/volo-http/tutorials/middleware/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsvolovolo-httptutorialsmiddleware><span>Middleware</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvolovolo-httptutorialsstatic-fs-li><input type=checkbox id=m-docsvolovolo-httptutorialsstatic-fs-check>
<label for=m-docsvolovolo-httptutorialsstatic-fs-check><a href=/docs/volo/volo-http/tutorials/static-fs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsvolovolo-httptutorialsstatic-fs><span>Static-FS</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvolovolo-httptutorialswebsocket-li><input type=checkbox id=m-docsvolovolo-httptutorialswebsocket-check>
<label for=m-docsvolovolo-httptutorialswebsocket-check><a href=/docs/volo/volo-http/tutorials/websocket/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsvolovolo-httptutorialswebsocket><span>WebSocket</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsvolovolo-thrift-li><input type=checkbox id=m-docsvolovolo-thrift-check checked>
<label for=m-docsvolovolo-thrift-check><a href=/docs/volo/volo-thrift/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvolovolo-thrift><span>Volo-Thrift</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvolovolo-thriftgetting-started-li><input type=checkbox id=m-docsvolovolo-thriftgetting-started-check>
<label for=m-docsvolovolo-thriftgetting-started-check><a href=/docs/volo/volo-thrift/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvolovolo-thriftgetting-started><span>Getting Started</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsvolovolo-grpc-li><input type=checkbox id=m-docsvolovolo-grpc-check checked>
<label for=m-docsvolovolo-grpc-check><a href=/docs/volo/volo-grpc/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvolovolo-grpc><span>Volo-gRPC</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvolovolo-grpcgetting-started-li><input type=checkbox id=m-docsvolovolo-grpcgetting-started-check>
<label for=m-docsvolovolo-grpcgetting-started-check><a href=/docs/volo/volo-grpc/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvolovolo-grpcgetting-started><span>Getting Started</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsvologuide-li><input type=checkbox id=m-docsvologuide-check checked>
<label for=m-docsvologuide-check><a href=/docs/volo/guide/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvologuide><span>Guide</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvologuidewith_callopt-li><input type=checkbox id=m-docsvologuidewith_callopt-check>
<label for=m-docsvologuidewith_callopt-check><a href=/docs/volo/guide/with_callopt/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsvologuidewith_callopt><span>Specifying CallOpt During Invocation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvologuidediscovery_lb-li><input type=checkbox id=m-docsvologuidediscovery_lb-check>
<label for=m-docsvologuidediscovery_lb-check><a href=/docs/volo/guide/discovery_lb/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsvologuidediscovery_lb><span>Custom Service Discovery and Load Balancing</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvologuideobservability-li><input type=checkbox id=m-docsvologuideobservability-check>
<label for=m-docsvologuideobservability-check><a href=/docs/volo/guide/observability/ title="Custom Logging / Monitoring / Tracing" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsvologuideobservability><span>Logging / Monitoring / Tracing</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvologuidemetadata-li><input type=checkbox id=m-docsvologuidemetadata-check>
<label for=m-docsvologuidemetadata-check><a href=/docs/volo/guide/metadata/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsvologuidemetadata><span>Metadata Propagation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvologuideconfig-li><input type=checkbox id=m-docsvologuideconfig-check>
<label for=m-docsvologuideconfig-check><a href=/docs/volo/guide/config/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsvologuideconfig><span>volo.yml Configuration File Format</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsvolomotore-li><input type=checkbox id=m-docsvolomotore-check checked>
<label for=m-docsvolomotore-check><a href=/docs/volo/motore/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvolomotore><span>Motore</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docsvolomotoregetting_started-li><input type=checkbox id=m-docsvolomotoregetting_started-check checked>
<label for=m-docsvolomotoregetting_started-check><a href=/docs/volo/motore/getting_started/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-docsvolomotoregetting_started><span class=td-sidebar-nav-active-item>Getting Started</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvolomotoremotore_volo_relationship-li><input type=checkbox id=m-docsvolomotoremotore_volo_relationship-check>
<label for=m-docsvolomotoremotore_volo_relationship-check><a href=/docs/volo/motore/motore_volo_relationship/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsvolomotoremotore_volo_relationship><span>The Relationship Between Motore and Volo</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvolopilota-li><input type=checkbox id=m-docsvolopilota-check checked>
<label for=m-docsvolopilota-check><a href=/docs/volo/pilota/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvolopilota><span>Pilota</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsvolofaq-li><input type=checkbox id=m-docsvolofaq-check checked>
<label for=m-docsvolofaq-check><a href=/docs/volo/faq/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsvolofaq><span>FAQ</span></a></label></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/cloudwego/cloudwego.github.io/edit/main/content/en/docs/volo/motore/getting_started.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/new/main/content/en/docs/volo/motore?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/issues/new?title=Getting%20Started" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-brands fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/cloudwego/volo/issues/new/choose class="td-page-meta--project td-page-meta__project-issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#prepare-the-environment>Prepare the Environment</a></li><li><a href=#tutorial-text>Tutorial Text</a></li><li><a href=#what-youve-learned>What you&rsquo;ve learned</a></li><li><a href=#whats-next>What&rsquo;s Next?</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://www.cloudwego.io/docs/>Documentation</a></li><li class=breadcrumb-item><a href=https://www.cloudwego.io/docs/volo/>Volo</a></li><li class=breadcrumb-item><a href=https://www.cloudwego.io/docs/volo/motore/>Motore</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://www.cloudwego.io/docs/volo/motore/getting_started/>Getting Started</a></li></ol></nav><div class=td-content><h1>Getting Started</h1><div class=lead>This document introduces the core concepts of the Motore framework through a complete example to help you quickly understand Motore.</div><header class=article-meta></header><h2 id=prepare-the-environment>Prepare the Environment</h2><p>The tutorial text itself is runnable Rust code. You can read it directly, or you can copy and paste the tutorial text into the <code>src/main.rs</code> file of a new cargo package and view it in an IDE. This provides many benefits, such as seeing type hints from rust-analyzer, which enhances the tutorial experience.</p><p>Don&rsquo;t forget to add the dependencies required by the tutorial text to your <code>Cargo.toml</code> file:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>package</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>name</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;hello-motore&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>version</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;0.1.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>edition</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;2024&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dependencies</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>motore</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>version</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Motore depends on tokio, and we also need a tokio runtime to execute the main function</span>
</span></span><span style=display:flex><span><span style=color:#000>tokio</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>version</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>features</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;full&#34;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=tutorial-text>Tutorial Text</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#8f5902;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * Motore: A Tower-inspired asynchronous middleware abstraction library for Rust
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> *
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * Core Concepts:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * 1. `Service`: Represents an asynchronous service (Request -&gt; Response).
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * 2. `Layer`: Represents middleware that wraps a `Service` and returns a new `Service`.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * 3. `Cx`: A mutable context that is passed through the entire call chain. You can use it to pass data throughout the call chain (such as database connections, tracing spans, user information, etc.). This is a major feature of Motore and one of the main differences from Tower.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// -----------------------------------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 1. Implement a `Service`
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// -----------------------------------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// First, let&#39;s define a context
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#8f5902;font-style:italic>#[derive(Debug, Clone)]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>MyContext</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>request_id</span>: <span style=color:#204a87;font-weight:700>u32</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>processing_steps</span>: <span style=color:#204a87;font-weight:700>u32</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>// Example: a writable context state
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>use</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>motore</span>::<span style=color:#000>service</span>::<span style=color:#000>Service</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>use</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>std</span>::<span style=color:#000>convert</span>::<span style=color:#000>Infallible</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// This is our &#34;string to uppercase&#34; service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>ToUppercaseService</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// --- Implement the Service trait for ToUppercaseService ---
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>impl</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Service</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>MyContext</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>String</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ToUppercaseService</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Response</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>String</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Error</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Infallible</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>// Infallible means this service will never fail
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>async</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>call</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx</span>: <span style=color:#204a87;font-weight:700>&amp;</span><span style=color:#000>mut</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>MyContext</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>req</span>: <span style=color:#204a87>String</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span>-&gt; <span style=color:#204a87>Result</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#3465a4>Self</span>::<span style=color:#000>Response</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#3465a4>Self</span>::<span style=color:#000>Error</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>// --- Demonstrate modifying &amp;mut Cx ---
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>cx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>processing_steps</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>println!</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[ToUppercaseService] handling req id: </span><span style=color:#4e9a06>{}</span><span style=color:#4e9a06>, step: </span><span style=color:#4e9a06>{}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>request_id</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>processing_steps</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>res</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>Ok</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>req</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>to_uppercase</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>println!</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[ToUppercaseService] responding req id: </span><span style=color:#4e9a06>{}</span><span style=color:#4e9a06>, step: </span><span style=color:#4e9a06>{}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>request_id</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>processing_steps</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>res</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// -----------------------------------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 2. Implement a `Layer`
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// -----------------------------------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// `Layer` (from `motore/src/layer/mod.rs`) is a factory
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// that takes an inner service `S` and returns a new, wrapped service `Self::Service`.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#8f5902;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>pub trait Layer&lt;S&gt; {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    /// The new Service type returned after wrapping
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    type Service;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    /// Wraps the inner service S into a new service Self::Service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    fn layer(self, inner: S) -&gt; Self::Service;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>*/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// --- Implement a `Layer` (logging middleware) ---
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// This is the standard pattern for a Layer: &#34;two structs&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 1. `LogLayer`: The Layer itself (the factory)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#8f5902;font-style:italic>#[derive(Clone)]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>LogLayer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>target</span>: <span style=color:#204a87;font-weight:700>&amp;</span><span style=color:#204a87>&#39;static</span> <span style=color:#204a87;font-weight:700>str</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// 2. `LogService&lt;S&gt;`: The new Service returned by the Layer (the wrapper)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#8f5902;font-style:italic>#[derive(Clone)]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>LogService</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>inner</span>: <span style=color:#000>S</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>// The inner service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>target</span>: <span style=color:#204a87;font-weight:700>&amp;</span><span style=color:#204a87>&#39;static</span> <span style=color:#204a87;font-weight:700>str</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>use</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>motore</span>::<span style=color:#000>layer</span>::<span style=color:#000>Layer</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// Implement the Layer trait for LogLayer
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>impl</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Layer</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LogLayer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Service</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LogService</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>layer</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inner</span>: <span style=color:#000>S</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span>-&gt; <span style=color:#000>Self</span>::<span style=color:#000>Service</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>// Return the new, wrapped Service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>LogService</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>inner</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>target</span>: <span style=color:#000>self</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>target</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>impl</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Cx</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Req</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Service</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Cx</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Req</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LogService</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// `S` must also be a Service and satisfy constraints like Send/Sync
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>S</span>: <span style=color:#000>Service</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Cx</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Req</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>Send</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>Sync</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>Cx</span>: <span style=color:#204a87>Send</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>&#39;static</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>Req</span>: <span style=color:#204a87>Send</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>&#39;static</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// The response and error types are usually the same as the inner service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Response</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>S</span>::<span style=color:#000>Response</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Error</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>S</span>::<span style=color:#000>Error</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>async</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>call</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx</span>: <span style=color:#204a87;font-weight:700>&amp;</span><span style=color:#000>mut</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Cx</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>req</span>: <span style=color:#000>Req</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span>-&gt; <span style=color:#204a87>Result</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#3465a4>Self</span>::<span style=color:#000>Response</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#3465a4>Self</span>::<span style=color:#000>Error</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>// Execute logic before calling the inner service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>println!</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[LogLayer] target: </span><span style=color:#4e9a06>{}</span><span style=color:#4e9a06>, enter&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>target</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>// Call the inner service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>result</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>inner</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>call</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cx</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>req</span><span style=color:#000;font-weight:700>).</span><span style=color:#204a87;font-weight:700>await</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>// Execute logic after the inner service returns
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>match</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>result</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87>Ok</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>_</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>println!</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[LogLayer] target: </span><span style=color:#4e9a06>{}</span><span style=color:#4e9a06>, exit (Ok)&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>target</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87>Err</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>_</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>println!</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[LogLayer] target: </span><span style=color:#4e9a06>{}</span><span style=color:#4e9a06>, exit (Err)&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>target</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>result</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// -----------------------------------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 3. Extended Knowledge: How `async fn call` works
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// -----------------------------------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// The core `Service` trait in `motore` (defined in motore/src/service/mod.rs)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// is actually defined like this:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#8f5902;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>pub trait Service&lt;Cx, Request&gt; {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    /// The response type returned when the service processes successfully
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    type Response;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    /// The error type returned when the service fails to process
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    type Error;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    /// Core method: process the request and return the response asynchronously
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ///
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    /// Note this signature! It is *not* `async fn`.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    /// It is a regular function that returns `impl Future`.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    /// This syntax is known as &#34;Return Position `impl Trait` in Trait&#34; (RPITIT).
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    fn call(
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        &amp;self,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        cx: &amp;mut Cx,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        req: Request,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ) -&gt; impl std::future::Future&lt;Output = Result&lt;Self::Response, Self::Error&gt;&gt; + Send;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>*/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// You might have noticed:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Why does the `Service` trait require the signature `fn call(...) -&gt; impl Future`,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// but what we wrote (in ToUppercaseService and LogService) was `async fn call`?
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// These two signatures are different, so why does it compile?
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// The answer is the `async fn in trait` (AFIT) feature.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// With the AFIT feature, `async fn` in a trait is actually &#34;syntactic sugar&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// for `fn ... -&gt; impl Future`.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// When the Rust compiler sees you trying to implement a trait
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// that expects `fn call(...) -&gt; impl Future` with `async fn call`,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// it automatically performs this &#34;syntactic sugar&#34; conversion (the process is called desugaring).
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// **In summary:**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 1. Motore&#39;s `Service` trait is defined using RPITIT (`fn ... -&gt; impl Future`).
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 2. Rust&#39;s AFIT feature allows us to implement this trait directly using `async fn`.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 3. When writing services and middleware, we get both the convenience of `async/await` and the zero-cost abstractions of `impl Trait`.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// -----------------------------------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 4. Assembling Services and Middleware with `ServiceBuilder`
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// -----------------------------------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// `ServiceBuilder` (from `motore/src/builder.rs`)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// allows you to stack multiple Layers onto a Service.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>use</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>motore</span>::<span style=color:#000>builder</span>::<span style=color:#000>ServiceBuilder</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>use</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>std</span>::<span style=color:#000>time</span>::<span style=color:#000>Duration</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>use</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>motore</span>::<span style=color:#000>timeout</span>::<span style=color:#000>TimeoutLayer</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>// A Layer that comes with Motore
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>async</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>run_builder</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// 1. Create a ServiceBuilder
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>builder</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceBuilder</span>::<span style=color:#000>new</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>// 2. Add Layers.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>//    Request execution order: top to bottom
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>//    Response execution order: bottom to top
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>.</span><span style=color:#000>layer</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>LogLayer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>target</span>: <span style=color:#4e9a06>&#34;Outer&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>.</span><span style=color:#000>layer</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>TimeoutLayer</span>::<span style=color:#000>new</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>Some</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Duration</span>::<span style=color:#000>from_secs</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>))))</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>.</span><span style=color:#000>layer</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>LogLayer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>target</span>: <span style=color:#4e9a06>&#34;Inner&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>});</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// 3. Apply the Layer stack to an &#34;innermost&#34; service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>//    Here we use `ToUppercaseService` as the core business service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>service</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>builder</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>service</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ToUppercaseService</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// 4. Prepare the context and request
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>//    Note: processing_steps starts at 0
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>mut</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>MyContext</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>request_id</span>: <span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>processing_steps</span>: <span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>};</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>req</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;hello motore&#34;</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>to_string</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// 5. Call it!
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>res</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>service</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>call</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#204a87;font-weight:700>mut</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>req</span><span style=color:#000;font-weight:700>).</span><span style=color:#204a87;font-weight:700>await</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>println!</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>Final response: </span><span style=color:#4e9a06>{:?}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>res</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     * Expected output:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     *
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     * [LogLayer] target: Outer, enter
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     * [LogLayer] target: Inner, enter
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     * [ToUppercaseService] handling req id: 42, step: 1     &lt;-- step becomes 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     * [ToUppercaseService] responding req id: 42, step: 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     * [LogLayer] target: Inner, exit (Ok)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     * [LogLayer] target: Outer, exit (Ok)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     *
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     * Final response: Ok(&#34;HELLO MOTORE&#34;)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#8f5902;font-style:italic>// Finally, the original cx has been modified
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#000>println!</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Final context steps: </span><span style=color:#4e9a06>{}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>processing_steps</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>// Will print 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// Fun fact: `ServiceBuilder` also implements the `Layer` trait, which means
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// you can nest one `ServiceBuilder` inside another `ServiceBuilder`&#39;s `layer` method:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// --- Suppose we have a bunch of middleware ---
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// struct LogLayer;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// struct TimeoutLayer;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// struct AuthLayer;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// struct MetricsLayer;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// struct MyCoreService;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 1. We can create a reusable &#34;authentication&#34; middleware stack
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// let auth_stack = ServiceBuilder::new()
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//     .layer(MetricsLayer)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//     .layer(AuthLayer);
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 2. Now, `auth_stack` is a `ServiceBuilder&lt;...&gt;`
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//    Since `ServiceBuilder` implements `Layer`,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//    we can use the entire `auth_stack` as a single `Layer`!
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 3. Use `auth_stack` in our main `ServiceBuilder`
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// let final_service = ServiceBuilder::new()
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//     .layer(LogLayer)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//     .layer(auth_stack) // &lt;-- This step works precisely because `ServiceBuilder` implements `Layer`
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//     .layer(TimeoutLayer)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//     .service(MyCoreService);
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// -----------------------------------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 5. Helper Utility: `service_fn`
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// -----------------------------------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// Sometimes you don&#39;t want to create a new struct for a simple service.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// `motore/src/service/service_fn.rs` provides `service_fn`, which can directly convert a compliant function into a `Service`.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>use</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>motore</span>::<span style=color:#000>service</span>::<span style=color:#000>service_fn</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>async</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>my_handler_func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cx</span>: <span style=color:#204a87;font-weight:700>&amp;</span><span style=color:#000>mut</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>MyContext</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>req</span>: <span style=color:#204a87>String</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span>-&gt; <span style=color:#204a87>Result</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87>String</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Infallible</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// --- Demonstrate modifying &amp;mut Cx ---
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>cx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>processing_steps</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>println!</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[service_fn] handling req id: </span><span style=color:#4e9a06>{}</span><span style=color:#4e9a06>, step: </span><span style=color:#4e9a06>{}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>request_id</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>processing_steps</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87>Ok</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>req</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>to_lowercase</span><span style=color:#000;font-weight:700>())</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>#[tokio::main]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>async</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>println!</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>--- Example 1: Running `run_builder` ---&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>run_builder</span><span style=color:#000;font-weight:700>().</span><span style=color:#204a87;font-weight:700>await</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>println!</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>--- Example 2: Running `service_fn` (standalone) ---&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// `service_fn` can convert a function or closure that matches the `async fn(&amp;mut Cx, Req) -&gt; Result&lt;Res, Err&gt;` signature
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// directly into a `Service`.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fn_service</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>service_fn</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>my_handler_func</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// Let&#39;s run it to prove it works
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>mut</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx1</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>MyContext</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>request_id</span>: <span style=color:#0000cf;font-weight:700>101</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>processing_steps</span>: <span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>};</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>res1</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fn_service</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>call</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#204a87;font-weight:700>mut</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx1</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;HELLO WORLD&#34;</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>to_string</span><span style=color:#000;font-weight:700>()).</span><span style=color:#204a87;font-weight:700>await</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// Check the modified context
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>println!</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;service_fn response: </span><span style=color:#4e9a06>{:?}</span><span style=color:#4e9a06>, context steps: </span><span style=color:#4e9a06>{}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>res1</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>processing_steps</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>// prints 10
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>println!</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>--- Example 3: Running `service_fn` (in a Builder) ---&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// You can also use it in a ServiceBuilder:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>service_from_fn</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServiceBuilder</span>::<span style=color:#000>new</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>.</span><span style=color:#000>layer</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>LogLayer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>target</span>: <span style=color:#4e9a06>&#34;ServiceFn&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>.</span><span style=color:#000>service_fn</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>my_handler_func</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>// shorthand for .service(service_fn(my_handler_func))
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// Run it
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>mut</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx2</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>MyContext</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>request_id</span>: <span style=color:#0000cf;font-weight:700>202</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>processing_steps</span>: <span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>};</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>res2</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>service_from_fn</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>call</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#204a87;font-weight:700>mut</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx2</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;ANOTHER EXAMPLE&#34;</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>to_string</span><span style=color:#000;font-weight:700>()).</span><span style=color:#204a87;font-weight:700>await</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// Check the modified context
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>println!</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;service_from_fn response: </span><span style=color:#4e9a06>{:?}</span><span style=color:#4e9a06>, context steps: </span><span style=color:#4e9a06>{}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>res2</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cx2</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>processing_steps</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>// prints 10
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=what-youve-learned>What you&rsquo;ve learned</h2><ul><li>Motore&rsquo;s core design: Service, Layer, and the mutable Cx context</li><li>Rust&rsquo;s AFIT and RPITIT features, and their application in Motore</li><li>How to assemble Services and Layers using <code>ServiceBuilder</code></li></ul><h2 id=whats-next>What&rsquo;s Next?</h2><p>Congratulations on getting this far! We have now learned the basic usage of Motore. We hope it will make your journey in the world of Volo much smoother.</p><p>Next, you can check out some features of Motore that were not covered in this tutorial:</p><ol><li>The tutorial only mentioned <code>Service&lt;Cx, Request></code>, but Motore also provides some important <code>Service</code> variants: for example, <a href=https://deepwiki.com/cloudwego/motore/2.1-service-trait#unaryservice-variant><code>UnaryService&lt;Request></code></a> without a context, and <a href=https://deepwiki.com/cloudwego/motore/2.1-service-trait#type-erasure-with-boxservice><code>BoxService&lt;Cx, T, U, E></code></a> for type erasure.</li><li>Motore provides more advanced tools for Layers and ServiceBuilder: for example, <a href=https://deepwiki.com/cloudwego/motore/4.2-layer-combinators#layerfn-implementation>layer_fn</a> which is very similar to <code>service_fn</code>, <a href=https://deepwiki.com/cloudwego/motore/2.3-service-builder#conditional-layer-application>option_layer</a> which supports <code>Option&lt;Layer&lt;...>></code> (and the <a href=https://deepwiki.com/cloudwego/motore/6-utilities#either-type><code>Either&lt;A, B></code> enum</a> that supports this feature), and <a href=https://deepwiki.com/cloudwego/motore/2.3-service-builder#convenience-methods-for-common-middleware>map_err</a> as a form of Layer.</li><li>Through the <code>ServiceExt</code> Trait, Motore <a href=https://deepwiki.com/cloudwego/motore/4.1-service-combinators#serviceext-trait-and-combinator-overview>provides</a> <code>Future</code>-like methods for <code>Service</code>, allowing you to call <code>.map_err()</code> and <code>.map_response()</code> on a Service.</li><li>Bidirectional compatibility with the Tower ecosystem: Motore is not only inspired by <code>Tower</code>, but also <a href=https://deepwiki.com/cloudwego/motore/5.1-tower-integration>provides a complete <strong>bidirectional</strong> adaptation layer</a> for it.</li><li>Motore provides a dedicated <a href=https://deepwiki.com/cloudwego/motore/6-utilities#makeconnection-trait><code>MakeConnection&lt;Address></code> Trait</a> to abstract the creation of &ldquo;connections&rdquo;.</li><li>The Motore package <a href=https://deepwiki.com/cloudwego/motore/1.1-project-structure#feature-flag-configuration>enables the <code>service_send</code> feature by default</a>. It requires that all <code>Future</code>s returned by <code>Service</code> satisfy the <code>Send</code> constraint. <code>motore-macros</code> also checks this feature. If you disable it, Motore can be used in a single-threaded environment (e.g., <code>tokio::main(flavor = "current_thread")</code>) without the <code>Send</code> constraint.</li></ol><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes"><a href=https://github.com/cloudwego/cloudwego.github.io/issues/new>Please tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no"><a href=https://github.com/cloudwego/cloudwego.github.io/issues/new>Please tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector(".feedback--answer-yes"),noButton=document.querySelector(".feedback--answer-no"),yesResponse=document.querySelector(".feedback--response-yes"),noResponse=document.querySelector(".feedback--response-no"),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=e=>{if(typeof ga!="function")return;const t={command:"send",hitType:"event",category:"Helpful",action:"click",label:window.location.pathname,value:e};ga(t.command,t.hitType,t.category,t.action,t.label,t.value)};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(1)}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script><br><div class=td-page-meta__lastmod>Last modified November 24, 2025: <a data-proofer-ignore href=https://github.com/cloudwego/cloudwego.github.io/commit/1915951e2d485880a9aa0d1f9fd2c2a95ff9832d>docs(volo/motore): add some content (#1451) (1915951e)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Lark aria-label=Lark><a class=text-white target=_blank rel=noopener href="https://applink.feishu.cn/client/chat/chatter/add_by_link?link_token=693v2544-2664-4421-b50f-7f1912p745r6" aria-label=Lark><img src=/webfonts/lark.svg alt style=width:26px;line-height:32.5px;margin-bottom:6px;fill:#fff></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/CloudWeGo aria-label=Twitter><img src=/webfonts/x-twitter.svg alt style=width:26px;line-height:32.5px;margin-bottom:6px;fill:#fff></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/cloudwego aria-label=GitHub><i class="fa-brands fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Discord aria-label=Discord><a class=text-white target=_blank rel=noopener href=https://discord.gg/jceZSE7DsW aria-label=Discord><i class="fa-brands fa-discord"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2026 The CloudWeGo Authors</small><p class="mt-2 text-white"><a class=cloudwego-link href=/about/ target=_blank rel=noopener>About</a>
|
<a class=cloudwego-link href=https://github.com/cloudwego/cloudwego.github.io/blob/main/LICENSE target=_blank rel=noopener>License</a></p></div></div></div></footer></div><script src=/js/popper.min.js></script><script src=/js/bootstrap.min.js></script><script src=https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js></script><script src=https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.min.js></script><script src=/js/main.min.84ba9af565392cd38463af5d663ae483367bd953c1d38a4273aa09e0bfd62d65.js integrity="sha256-hLqa9WU5LNOEY69dZjrkgzZ72VPB04pCc6oJ4L/WLWU=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/prism-custom.js></script><script src=/js/tabpane-persist.js></script><script src=/js/docsearch.js></script><script type=text/javascript>let siteLang=window.location.pathname.startsWith("/zh/")?"zh":"en";docsearch({appId:"V7I042F992",apiKey:"8380a7ac88106841cb43fb000fa2edb4",indexName:"cloudwego",container:"#docsearch",searchParameters:{hitsPerPage:5,facetFilters:[`lang:${siteLang}`]},transformItems(e){return e.map(e=>({...e,url:e.url.replace("www.cloudwego.io",location.host).replace("https:",location.protocol)}))}})</script><script src=/js/outbound-link.js></script><script src=/js/navScroll.js></script></body></html>