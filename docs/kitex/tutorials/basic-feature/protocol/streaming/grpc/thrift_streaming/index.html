<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.142.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Thrift Streaming over gRPC | CloudWeGo</title>
<meta name=description content="A leading practice for building enterprise cloud native middleware!"><meta property="og:url" content="https://www.cloudwego.io/docs/kitex/tutorials/basic-feature/protocol/streaming/grpc/thrift_streaming/"><meta property="og:site_name" content="CloudWeGo"><meta property="og:title" content="Thrift Streaming over gRPC"><meta property="og:description" content="This article describes how to define and use the Streaming API in Thrift IDL over gRPC."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2024-03-09T00:00:00+00:00"><meta property="article:modified_time" content="2025-03-07T17:25:05+08:00"><meta itemprop=name content="Thrift Streaming over gRPC"><meta itemprop=description content="This article describes how to define and use the Streaming API in Thrift IDL over gRPC."><meta itemprop=datePublished content="2024-03-09T00:00:00+00:00"><meta itemprop=dateModified content="2025-03-07T17:25:05+08:00"><meta itemprop=wordCount content="3811"><meta itemprop=keywords content="Kitex,Streaming,Thrift,gRPC"><meta name=twitter:card content="summary"><meta name=twitter:title content="Thrift Streaming over gRPC"><meta name=twitter:description content="This article describes how to define and use the Streaming API in Thrift IDL over gRPC."><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYWRQRLPRM"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QYWRQRLPRM")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?f1808c42af827f368aa7eca3baae6d55",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=preload href=/scss/main.min.b3c21c777309e05201dd625b8a4ece4076249bfa52b71d58c6e352d84c6c0320.css as=style><link href=/scss/main.min.b3c21c777309e05201dd625b8a4ece4076249bfa52b71d58c6e352d84c6c0320.css rel=stylesheet integrity><script src=/js/jquery.min.js></script><link rel=stylesheet href=/css/prism.css><link rel=stylesheet href=/css/docsearch.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYWRQRLPRM"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QYWRQRLPRM")}</script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand-xl navbar-dark td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><img src=/img/logo.png></span>
</a><button class=navbar-toggler type=button data-toggle=collapse data-target=#main_navbar aria-controls=main_navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0 ml-auto"><li class="dropdown sub-menu active"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>Documentation</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/docs/kitex/>Kitex</a>
<a class=dropdown-item href=/docs/hertz/>Hertz</a>
<a class=dropdown-item href=/docs/volo/>Volo</a>
<a class=dropdown-item href=/docs/netpoll/>Netpoll</a>
<a class=dropdown-item href=/docs/cwgo/>Cwgo</a>
<a class=dropdown-item href=/docs/eino/>Eino</a>
<a class=dropdown-item href=/docs/monolake/>Monolake</a></div></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/about/><span>About</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><span>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cooperation/><span>Cooperation</span></a></li><li class="dropdown sub-menu"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>Security</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/security/safety-bulletin/>safety-bulletin</a>
<a class=dropdown-item href=/security/vulnerability-reporting/>vulnerability-reporting</a></div></li><li class="nav-item dropdown mr-4"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/docs/kitex/tutorials/basic-feature/protocol/streaming/grpc/thrift_streaming/>中文</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><div id=docsearch></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div id=docsearch></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav foldable-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/docs/kitex/tutorials/basic-feature/protocol/streaming/grpc/thrift_streaming/>中文</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docskitex-li><input type=checkbox id=m-docskitex-check checked>
<label for=m-docskitex-check><a href=/docs/kitex/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitex><span>Kitex</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexoverview-li><input type=checkbox id=m-docskitexoverview-check checked>
<label for=m-docskitexoverview-check><a href=/docs/kitex/overview/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitexoverview><span>Overview</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitexgetting-started-li><input type=checkbox id=m-docskitexgetting-started-check checked>
<label for=m-docskitexgetting-started-check><a href=/docs/kitex/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitexgetting-started><span>Getting Started</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexgetting-startedpre-knowledge-li><input type=checkbox id=m-docskitexgetting-startedpre-knowledge-check>
<label for=m-docskitexgetting-startedpre-knowledge-check><a href=/docs/kitex/getting-started/pre-knowledge/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexgetting-startedpre-knowledge><span>Pre-knowledge</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexgetting-startedprerequisite-li><input type=checkbox id=m-docskitexgetting-startedprerequisite-check>
<label for=m-docskitexgetting-startedprerequisite-check><a href=/docs/kitex/getting-started/prerequisite/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexgetting-startedprerequisite><span>Environment Preparation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexgetting-startedquick_start-li><input type=checkbox id=m-docskitexgetting-startedquick_start-check>
<label for=m-docskitexgetting-startedquick_start-check><a href=/docs/kitex/getting-started/quick_start/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexgetting-startedquick_start><span>Basic Example</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexgetting-startedtutorial-li><input type=checkbox id=m-docskitexgetting-startedtutorial-check>
<label for=m-docskitexgetting-startedtutorial-check><a href=/docs/kitex/getting-started/tutorial/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexgetting-startedtutorial><span>Advanced Tutorial</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexgetting-startedexamples-li><input type=checkbox id=m-docskitexgetting-startedexamples-check>
<label for=m-docskitexgetting-startedexamples-check><a href=/docs/kitex/getting-started/examples/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexgetting-startedexamples><span>Code Examples</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docskitextutorials-li><input type=checkbox id=m-docskitextutorials-check checked>
<label for=m-docskitextutorials-check><a href=/docs/kitex/tutorials/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorials><span>Tutorials</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docskitextutorialsbasic-feature-li><input type=checkbox id=m-docskitextutorialsbasic-feature-check checked>
<label for=m-docskitextutorialsbasic-feature-check><a href=/docs/kitex/tutorials/basic-feature/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsbasic-feature><span>Basic Feature</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featuremessage_type-li><input type=checkbox id=m-docskitextutorialsbasic-featuremessage_type-check>
<label for=m-docskitextutorialsbasic-featuremessage_type-check><a href=/docs/kitex/tutorials/basic-feature/message_type/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featuremessage_type><span>Message Types</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsbasic-featurestreamx-li><input type=checkbox id=m-docskitextutorialsbasic-featurestreamx-check>
<label for=m-docskitextutorialsbasic-featurestreamx-check><a href=/docs/kitex/tutorials/basic-feature/streamx/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsbasic-featurestreamx><span>StreamX</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streambasicprogramming-li><input type=checkbox id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streambasicprogramming-check>
<label for=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streambasicprogramming-check><a href=/docs/kitex/tutorials/basic-feature/streamx/kitex+streamx+-+stream+basic+programming/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streambasicprogramming><span>StreamX Basic Programming</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streammiddleware-li><input type=checkbox id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streammiddleware-check>
<label for=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streammiddleware-check><a href=/docs/kitex/tutorials/basic-feature/streamx/kitex+streamx+-+stream+middleware/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streammiddleware><span>StreamX Middleware</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streammetainfo-li><input type=checkbox id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streammetainfo-check>
<label for=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streammetainfo-check><a href=/docs/kitex/tutorials/basic-feature/streamx/kitex+streamx+-+stream+metainfo/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streammetainfo><span>StreamX Metainfo</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streamerrorhandling-li><input type=checkbox id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streamerrorhandling-check>
<label for=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streamerrorhandling-check><a href=/docs/kitex/tutorials/basic-feature/streamx/kitex+streamx+-+stream+error+handling/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streamerrorhandling><span>StreamX Error Handling</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streamfaq-li><input type=checkbox id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streamfaq-check>
<label for=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streamfaq-check><a href=/docs/kitex/tutorials/basic-feature/streamx/kitex+streamx+-+stream+faq/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streamfaq><span>StreamX FAQ</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docskitextutorialsbasic-featureprotocol-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocol-check checked>
<label for=m-docskitextutorialsbasic-featureprotocol-check><a href=/docs/kitex/tutorials/basic-feature/protocol/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsbasic-featureprotocol><span>Protocol</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featureprotocoltransport_protocol-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocoltransport_protocol-check>
<label for=m-docskitextutorialsbasic-featureprotocoltransport_protocol-check><a href=/docs/kitex/tutorials/basic-feature/protocol/transport_protocol/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featureprotocoltransport_protocol><span>Transport Protocol</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docskitextutorialsbasic-featureprotocolstreaming-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocolstreaming-check checked>
<label for=m-docskitextutorialsbasic-featureprotocolstreaming-check><a href=/docs/kitex/tutorials/basic-feature/protocol/streaming/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsbasic-featureprotocolstreaming><span>Streaming</span></a></label><ul class="ul-6 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docskitextutorialsbasic-featureprotocolstreaminggrpc-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocolstreaminggrpc-check checked>
<label for=m-docskitextutorialsbasic-featureprotocolstreaminggrpc-check><a href=/docs/kitex/tutorials/basic-feature/protocol/streaming/grpc/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsbasic-featureprotocolstreaminggrpc><span>gRPC</span></a></label><ul class="ul-7 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docskitextutorialsbasic-featureprotocolstreaminggrpcthrift_streaming-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocolstreaminggrpcthrift_streaming-check checked>
<label for=m-docskitextutorialsbasic-featureprotocolstreaminggrpcthrift_streaming-check><a href=/docs/kitex/tutorials/basic-feature/protocol/streaming/grpc/thrift_streaming/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featureprotocolstreaminggrpcthrift_streaming><span class=td-sidebar-nav-active-item>Thrift Streaming over gRPC</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featureprotocolstreaminggrpcgraceful_shutdown-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocolstreaminggrpcgraceful_shutdown-check>
<label for=m-docskitextutorialsbasic-featureprotocolstreaminggrpcgraceful_shutdown-check><a href=/docs/kitex/tutorials/basic-feature/protocol/streaming/grpc/graceful_shutdown/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featureprotocolstreaminggrpcgraceful_shutdown><span>gRPC Streaming Graceful Shutdown</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsbasic-featureprotocolserialization-protocol-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocolserialization-protocol-check>
<label for=m-docskitextutorialsbasic-featureprotocolserialization-protocol-check><a href=/docs/kitex/tutorials/basic-feature/protocol/serialization-protocol/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsbasic-featureprotocolserialization-protocol><span>Serialization Protocol</span></a></label><ul class="ul-6 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featureprotocolserialization-protocolbinary-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocolserialization-protocolbinary-check>
<label for=m-docskitextutorialsbasic-featureprotocolserialization-protocolbinary-check><a href=/docs/kitex/tutorials/basic-feature/protocol/serialization-protocol/binary/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featureprotocolserialization-protocolbinary><span>Binary</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featureprotocolserialization-protocolprotobuf-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocolserialization-protocolprotobuf-check>
<label for=m-docskitextutorialsbasic-featureprotocolserialization-protocolprotobuf-check><a href=/docs/kitex/tutorials/basic-feature/protocol/serialization-protocol/protobuf/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featureprotocolserialization-protocolprotobuf><span>Protobuf</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featureprotocolserialization-protocolhessian2-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocolserialization-protocolhessian2-check>
<label for=m-docskitextutorialsbasic-featureprotocolserialization-protocolhessian2-check><a href=/docs/kitex/tutorials/basic-feature/protocol/serialization-protocol/hessian2/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featureprotocolserialization-protocolhessian2><span>Hessian2</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurevisit_directly-li><input type=checkbox id=m-docskitextutorialsbasic-featurevisit_directly-check>
<label for=m-docskitextutorialsbasic-featurevisit_directly-check><a href=/docs/kitex/tutorials/basic-feature/visit_directly/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurevisit_directly><span>Visit Directly</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featureconnection_type-li><input type=checkbox id=m-docskitextutorialsbasic-featureconnection_type-check>
<label for=m-docskitextutorialsbasic-featureconnection_type-check><a href=/docs/kitex/tutorials/basic-feature/connection_type/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featureconnection_type><span>Connection Type</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurebizstatuserr-li><input type=checkbox id=m-docskitextutorialsbasic-featurebizstatuserr-check>
<label for=m-docskitextutorialsbasic-featurebizstatuserr-check><a href=/docs/kitex/tutorials/basic-feature/bizstatuserr/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurebizstatuserr><span>Business Exception</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurewarming_up-li><input type=checkbox id=m-docskitextutorialsbasic-featurewarming_up-check>
<label for=m-docskitextutorialsbasic-featurewarming_up-check><a href=/docs/kitex/tutorials/basic-feature/warming_up/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurewarming_up><span>Warming Up</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurepanic-li><input type=checkbox id=m-docskitextutorialsbasic-featurepanic-check>
<label for=m-docskitextutorialsbasic-featurepanic-check><a href=/docs/kitex/tutorials/basic-feature/panic/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurepanic><span>Deal with panic</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featureacquire_rpcinfo-li><input type=checkbox id=m-docskitextutorialsbasic-featureacquire_rpcinfo-check>
<label for=m-docskitextutorialsbasic-featureacquire_rpcinfo-check><a href=/docs/kitex/tutorials/basic-feature/acquire_rpcinfo/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featureacquire_rpcinfo><span>Acquire Kitex RPC Info</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsservice-governance-li><input type=checkbox id=m-docskitextutorialsservice-governance-check>
<label for=m-docskitextutorialsservice-governance-check><a href=/docs/kitex/tutorials/service-governance/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsservice-governance><span>Service Governance</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsservice-governanceloadbalance-li><input type=checkbox id=m-docskitextutorialsservice-governanceloadbalance-check>
<label for=m-docskitextutorialsservice-governanceloadbalance-check><a href=/docs/kitex/tutorials/service-governance/loadbalance/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsservice-governanceloadbalance><span>LoadBalancer</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsservice-governancetimeout-li><input type=checkbox id=m-docskitextutorialsservice-governancetimeout-check>
<label for=m-docskitextutorialsservice-governancetimeout-check><a href=/docs/kitex/tutorials/service-governance/timeout/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsservice-governancetimeout><span>Timeouts</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsservice-governanceretry-li><input type=checkbox id=m-docskitextutorialsservice-governanceretry-check>
<label for=m-docskitextutorialsservice-governanceretry-check><a href=/docs/kitex/tutorials/service-governance/retry/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsservice-governanceretry><span>Retry</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsservice-governancecircuitbreaker-li><input type=checkbox id=m-docskitextutorialsservice-governancecircuitbreaker-check>
<label for=m-docskitextutorialsservice-governancecircuitbreaker-check><a href=/docs/kitex/tutorials/service-governance/circuitbreaker/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsservice-governancecircuitbreaker><span>Circuit Breaker</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsservice-governancefallback-li><input type=checkbox id=m-docskitextutorialsservice-governancefallback-check>
<label for=m-docskitextutorialsservice-governancefallback-check><a href=/docs/kitex/tutorials/service-governance/fallback/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsservice-governancefallback><span>Fallback</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsservice-governancelimiting-li><input type=checkbox id=m-docskitextutorialsservice-governancelimiting-check>
<label for=m-docskitextutorialsservice-governancelimiting-check><a href=/docs/kitex/tutorials/service-governance/limiting/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsservice-governancelimiting><span>Rate Limiting</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsservice-governanceaccess_control-li><input type=checkbox id=m-docskitextutorialsservice-governanceaccess_control-check>
<label for=m-docskitextutorialsservice-governanceaccess_control-check><a href=/docs/kitex/tutorials/service-governance/access_control/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsservice-governanceaccess_control><span>Customized Access Control</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsobservability-li><input type=checkbox id=m-docskitextutorialsobservability-check>
<label for=m-docskitextutorialsobservability-check><a href=/docs/kitex/tutorials/observability/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsobservability><span>Observability</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsobservabilityinstrumentation-li><input type=checkbox id=m-docskitextutorialsobservabilityinstrumentation-check>
<label for=m-docskitextutorialsobservabilityinstrumentation-check><a href=/docs/kitex/tutorials/observability/instrumentation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsobservabilityinstrumentation><span>Instrumentation Control</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsobservabilitytracing-li><input type=checkbox id=m-docskitextutorialsobservabilitytracing-check>
<label for=m-docskitextutorialsobservabilitytracing-check><a href=/docs/kitex/tutorials/observability/tracing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsobservabilitytracing><span>Tracing</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsobservabilitylogging-li><input type=checkbox id=m-docskitextutorialsobservabilitylogging-check>
<label for=m-docskitextutorialsobservabilitylogging-check><a href=/docs/kitex/tutorials/observability/logging/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsobservabilitylogging><span>Logging</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsadvanced-feature-li><input type=checkbox id=m-docskitextutorialsadvanced-feature-check>
<label for=m-docskitextutorialsadvanced-feature-check><a href=/docs/kitex/tutorials/advanced-feature/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsadvanced-feature><span>Advanced Feature</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featurepayload_validator-li><input type=checkbox id=m-docskitextutorialsadvanced-featurepayload_validator-check>
<label for=m-docskitextutorialsadvanced-featurepayload_validator-check><a href=/docs/kitex/tutorials/advanced-feature/payload_validator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featurepayload_validator><span>Payload Validator</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsadvanced-featuregeneric-call-li><input type=checkbox id=m-docskitextutorialsadvanced-featuregeneric-call-check>
<label for=m-docskitextutorialsadvanced-featuregeneric-call-check><a href=/docs/kitex/tutorials/advanced-feature/generic-call/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsadvanced-featuregeneric-call><span>Generic Call</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuregeneric-callbasic_usage-li><input type=checkbox id=m-docskitextutorialsadvanced-featuregeneric-callbasic_usage-check>
<label for=m-docskitextutorialsadvanced-featuregeneric-callbasic_usage-check><a href=/docs/kitex/tutorials/advanced-feature/generic-call/basic_usage/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuregeneric-callbasic_usage><span>Basic Usage</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuregeneric-callthrift_idl_annotation_standards-li><input type=checkbox id=m-docskitextutorialsadvanced-featuregeneric-callthrift_idl_annotation_standards-check>
<label for=m-docskitextutorialsadvanced-featuregeneric-callthrift_idl_annotation_standards-check><a href=/docs/kitex/tutorials/advanced-feature/generic-call/thrift_idl_annotation_standards/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuregeneric-callthrift_idl_annotation_standards><span>IDL Definition Specification for Mapping between Thrift and HTTP</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuregeneric-callgeneric-call-dynamicgo-li><input type=checkbox id=m-docskitextutorialsadvanced-featuregeneric-callgeneric-call-dynamicgo-check>
<label for=m-docskitextutorialsadvanced-featuregeneric-callgeneric-call-dynamicgo-check><a href=/docs/kitex/tutorials/advanced-feature/generic-call/generic-call-dynamicgo/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuregeneric-callgeneric-call-dynamicgo><span>User guide to generic call with dynamicgo</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuregeneric-callgeneric-call-reflection-li><input type=checkbox id=m-docskitextutorialsadvanced-featuregeneric-callgeneric-call-reflection-check>
<label for=m-docskitextutorialsadvanced-featuregeneric-callgeneric-call-reflection-check><a href=/docs/kitex/tutorials/advanced-feature/generic-call/generic-call-reflection/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuregeneric-callgeneric-call-reflection><span>Use Thrift reflection to improve generic-call performance</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuregeneric-callgeneric_streaming-li><input type=checkbox id=m-docskitextutorialsadvanced-featuregeneric-callgeneric_streaming-check>
<label for=m-docskitextutorialsadvanced-featuregeneric-callgeneric_streaming-check><a href=/docs/kitex/tutorials/advanced-feature/generic-call/generic_streaming/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuregeneric-callgeneric_streaming><span>User Guide to Generic Call for Streaming</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuremetainfo-li><input type=checkbox id=m-docskitextutorialsadvanced-featuremetainfo-check>
<label for=m-docskitextutorialsadvanced-featuremetainfo-check><a href=/docs/kitex/tutorials/advanced-feature/metainfo/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuremetainfo><span>Metainfo</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featureinvoker-li><input type=checkbox id=m-docskitextutorialsadvanced-featureinvoker-check>
<label for=m-docskitextutorialsadvanced-featureinvoker-check><a href=/docs/kitex/tutorials/advanced-feature/invoker/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featureinvoker><span>Server SDK Mode</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featureerror_handler-li><input type=checkbox id=m-docskitextutorialsadvanced-featureerror_handler-check>
<label for=m-docskitextutorialsadvanced-featureerror_handler-check><a href=/docs/kitex/tutorials/advanced-feature/error_handler/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featureerror_handler><span>Customize Error Handler</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featurestart_shutdown_hook-li><input type=checkbox id=m-docskitextutorialsadvanced-featurestart_shutdown_hook-check>
<label for=m-docskitextutorialsadvanced-featurestart_shutdown_hook-check><a href=/docs/kitex/tutorials/advanced-feature/start_shutdown_hook/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featurestart_shutdown_hook><span>Customize Hook for Start/Shutdown of Server-side</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuregrpcproxy-li><input type=checkbox id=m-docskitextutorialsadvanced-featuregrpcproxy-check>
<label for=m-docskitextutorialsadvanced-featuregrpcproxy-check><a href=/docs/kitex/tutorials/advanced-feature/grpcproxy/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuregrpcproxy><span>gRPC Proxy</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featurecodec_frugal-li><input type=checkbox id=m-docskitextutorialsadvanced-featurecodec_frugal-check>
<label for=m-docskitextutorialsadvanced-featurecodec_frugal-check><a href=/docs/kitex/tutorials/advanced-feature/codec_frugal/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featurecodec_frugal><span>Frugal</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featurexds-li><input type=checkbox id=m-docskitextutorialsadvanced-featurexds-check>
<label for=m-docskitextutorialsadvanced-featurexds-check><a href=/docs/kitex/tutorials/advanced-feature/xds/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featurexds><span>xDS Support</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featurefieldmask-li><input type=checkbox id=m-docskitextutorialsadvanced-featurefieldmask-check>
<label for=m-docskitextutorialsadvanced-featurefieldmask-check><a href=/docs/kitex/tutorials/advanced-feature/fieldmask/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featurefieldmask><span>Serialize Data Ondemands</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featureprofiler-li><input type=checkbox id=m-docskitextutorialsadvanced-featureprofiler-check>
<label for=m-docskitextutorialsadvanced-featureprofiler-check><a href=/docs/kitex/tutorials/advanced-feature/profiler/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featureprofiler><span>Request Profiler</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsadvanced-featuremulti_service-li><input type=checkbox id=m-docskitextutorialsadvanced-featuremulti_service-check>
<label for=m-docskitextutorialsadvanced-featuremulti_service-check><a href=/docs/kitex/tutorials/advanced-feature/multi_service/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsadvanced-featuremulti_service><span>Multiple Services</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuremulti_servicemulti_service-li><input type=checkbox id=m-docskitextutorialsadvanced-featuremulti_servicemulti_service-check>
<label for=m-docskitextutorialsadvanced-featuremulti_servicemulti_service-check><a href=/docs/kitex/tutorials/advanced-feature/multi_service/multi_service/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuremulti_servicemulti_service><span>Multiple Services</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuremulti_servicemulti_handler-li><input type=checkbox id=m-docskitextutorialsadvanced-featuremulti_servicemulti_handler-check>
<label for=m-docskitextutorialsadvanced-featuremulti_servicemulti_handler-check><a href=/docs/kitex/tutorials/advanced-feature/multi_service/multi_handler/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuremulti_servicemulti_handler><span>Generating Multiple Handlers for Multiple Services</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuregls-li><input type=checkbox id=m-docskitextutorialsadvanced-featuregls-check>
<label for=m-docskitextutorialsadvanced-featuregls-check><a href=/docs/kitex/tutorials/advanced-feature/gls/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuregls><span>GLS Feature Usage</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialscode-gen-li><input type=checkbox id=m-docskitextutorialscode-gen-check>
<label for=m-docskitextutorialscode-gen-check><a href=/docs/kitex/tutorials/code-gen/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialscode-gen><span>Code Generation</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-gencode_generation-li><input type=checkbox id=m-docskitextutorialscode-gencode_generation-check>
<label for=m-docskitextutorialscode-gencode_generation-check><a href=/docs/kitex/tutorials/code-gen/code_generation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-gencode_generation><span>Code Generation Tool</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-gencombine_service-li><input type=checkbox id=m-docskitextutorialscode-gencombine_service-check>
<label for=m-docskitextutorialscode-gencombine_service-check><a href=/docs/kitex/tutorials/code-gen/combine_service/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-gencombine_service><span>Combine Service [DEPRECATED]</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-genvalidator-li><input type=checkbox id=m-docskitextutorialscode-genvalidator-check>
<label for=m-docskitextutorialscode-genvalidator-check><a href=/docs/kitex/tutorials/code-gen/validator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-genvalidator><span>Thrift Validator</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-genfastpb-li><input type=checkbox id=m-docskitextutorialscode-genfastpb-check>
<label for=m-docskitextutorialscode-genfastpb-check><a href=/docs/kitex/tutorials/code-gen/fastpb/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-genfastpb><span>Fastpb</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-gentemplate_extension-li><input type=checkbox id=m-docskitextutorialscode-gentemplate_extension-check>
<label for=m-docskitextutorialscode-gentemplate_extension-check><a href=/docs/kitex/tutorials/code-gen/template_extension/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-gentemplate_extension><span>Extend the Templates of Service Generated Code</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-genstruct_reference_generator-li><input type=checkbox id=m-docskitextutorialscode-genstruct_reference_generator-check>
<label for=m-docskitextutorialscode-genstruct_reference_generator-check><a href=/docs/kitex/tutorials/code-gen/struct_reference_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-genstruct_reference_generator><span>Generate Structs Reference</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-gencustom_tpl-li><input type=checkbox id=m-docskitextutorialscode-gencustom_tpl-check>
<label for=m-docskitextutorialscode-gencustom_tpl-check><a href=/docs/kitex/tutorials/code-gen/custom_tpl/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-gencustom_tpl><span>Custom Scaffold Template</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-genidl_trimmer-li><input type=checkbox id=m-docskitextutorialscode-genidl_trimmer-check>
<label for=m-docskitextutorialscode-genidl_trimmer-check><a href=/docs/kitex/tutorials/code-gen/idl_trimmer/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-genidl_trimmer><span>Thriftgo IDL Trimmer</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-genprotoc_validator-li><input type=checkbox id=m-docskitextutorialscode-genprotoc_validator-check>
<label for=m-docskitextutorialscode-genprotoc_validator-check><a href=/docs/kitex/tutorials/code-gen/protoc_validator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-genprotoc_validator><span>Protoc Validator</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-gencustom_struct_tags-li><input type=checkbox id=m-docskitextutorialscode-gencustom_struct_tags-check>
<label for=m-docskitextutorialscode-gencustom_struct_tags-check><a href=/docs/kitex/tutorials/code-gen/custom_struct_tags/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-gencustom_struct_tags><span>Custom Struct Tags</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-genskip_decoder-li><input type=checkbox id=m-docskitextutorialscode-genskip_decoder-check>
<label for=m-docskitextutorialscode-genskip_decoder-check><a href=/docs/kitex/tutorials/code-gen/skip_decoder/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-genskip_decoder><span>SkipDecoder</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsframework-exten-li><input type=checkbox id=m-docskitextutorialsframework-exten-check>
<label for=m-docskitextutorialsframework-exten-check><a href=/docs/kitex/tutorials/framework-exten/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsframework-exten><span>Framework Extension</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extenmiddleware-li><input type=checkbox id=m-docskitextutorialsframework-extenmiddleware-check>
<label for=m-docskitextutorialsframework-extenmiddleware-check><a href=/docs/kitex/tutorials/framework-exten/middleware/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extenmiddleware><span>Middleware Extensions</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extensuite-li><input type=checkbox id=m-docskitextutorialsframework-extensuite-check>
<label for=m-docskitextutorialsframework-extensuite-check><a href=/docs/kitex/tutorials/framework-exten/suite/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extensuite><span>Suite Extensions</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extenregistry-li><input type=checkbox id=m-docskitextutorialsframework-extenregistry-check>
<label for=m-docskitextutorialsframework-extenregistry-check><a href=/docs/kitex/tutorials/framework-exten/registry/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extenregistry><span>Extension of Service Registry</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extenservice_discovery-li><input type=checkbox id=m-docskitextutorialsframework-extenservice_discovery-check>
<label for=m-docskitextutorialsframework-extenservice_discovery-check><a href=/docs/kitex/tutorials/framework-exten/service_discovery/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extenservice_discovery><span>Service Discovery Extension</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extenloadbalance-li><input type=checkbox id=m-docskitextutorialsframework-extenloadbalance-check>
<label for=m-docskitextutorialsframework-extenloadbalance-check><a href=/docs/kitex/tutorials/framework-exten/loadbalance/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extenloadbalance><span>Customize LoadBalancer</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extenmonitoring-li><input type=checkbox id=m-docskitextutorialsframework-extenmonitoring-check>
<label for=m-docskitextutorialsframework-extenmonitoring-check><a href=/docs/kitex/tutorials/framework-exten/monitoring/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extenmonitoring><span>Monitoring Extension</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extencodec-li><input type=checkbox id=m-docskitextutorialsframework-extencodec-check>
<label for=m-docskitextutorialsframework-extencodec-check><a href=/docs/kitex/tutorials/framework-exten/codec/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extencodec><span>Extension of Codec</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extentransport-li><input type=checkbox id=m-docskitextutorialsframework-extentransport-check>
<label for=m-docskitextutorialsframework-extentransport-check><a href=/docs/kitex/tutorials/framework-exten/transport/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extentransport><span>Extension of Transport Module</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extentrans_pipeline-li><input type=checkbox id=m-docskitextutorialsframework-extentrans_pipeline-check>
<label for=m-docskitextutorialsframework-extentrans_pipeline-check><a href=/docs/kitex/tutorials/framework-exten/trans_pipeline/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extentrans_pipeline><span>Extension of Transport Pipeline-Bound</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extentransmeta-li><input type=checkbox id=m-docskitextutorialsframework-extentransmeta-check>
<label for=m-docskitextutorialsframework-extentransmeta-check><a href=/docs/kitex/tutorials/framework-exten/transmeta/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extentransmeta><span>Extension of Metadata Transparent Transmission</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extendiagnosis-li><input type=checkbox id=m-docskitextutorialsframework-extendiagnosis-check>
<label for=m-docskitextutorialsframework-extendiagnosis-check><a href=/docs/kitex/tutorials/framework-exten/diagnosis/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extendiagnosis><span>Extension of Diagnosis</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extenimplemented_extension-li><input type=checkbox id=m-docskitextutorialsframework-extenimplemented_extension-check>
<label for=m-docskitextutorialsframework-extenimplemented_extension-check><a href=/docs/kitex/tutorials/framework-exten/implemented_extension/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extenimplemented_extension><span>Implemented Extension</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsoptions-li><input type=checkbox id=m-docskitextutorialsoptions-check>
<label for=m-docskitextutorialsoptions-check><a href=/docs/kitex/tutorials/options/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsoptions><span>Option</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsoptionsclient_options-li><input type=checkbox id=m-docskitextutorialsoptionsclient_options-check>
<label for=m-docskitextutorialsoptionsclient_options-check><a href=/docs/kitex/tutorials/options/client_options/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsoptionsclient_options><span>Client Option</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsoptionsserver_options-li><input type=checkbox id=m-docskitextutorialsoptionsserver_options-check>
<label for=m-docskitextutorialsoptionsserver_options-check><a href=/docs/kitex/tutorials/options/server_options/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsoptionsserver_options><span>Server Option</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsoptionscall_options-li><input type=checkbox id=m-docskitextutorialsoptionscall_options-check>
<label for=m-docskitextutorialsoptionscall_options-check><a href=/docs/kitex/tutorials/options/call_options/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsoptionscall_options><span>Call Option</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsthird-party-li><input type=checkbox id=m-docskitextutorialsthird-party-check>
<label for=m-docskitextutorialsthird-party-check><a href=/docs/kitex/tutorials/third-party/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsthird-party><span>Third-Party</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsthird-partyservice_discovery-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discovery-check>
<label for=m-docskitextutorialsthird-partyservice_discovery-check><a href=/docs/kitex/tutorials/third-party/service_discovery/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsthird-partyservice_discovery><span>Service Discovery</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoveryetcd-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoveryetcd-check>
<label for=m-docskitextutorialsthird-partyservice_discoveryetcd-check><a href=/docs/kitex/tutorials/third-party/service_discovery/etcd/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoveryetcd><span>Etcd</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoveryconsul-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoveryconsul-check>
<label for=m-docskitextutorialsthird-partyservice_discoveryconsul-check><a href=/docs/kitex/tutorials/third-party/service_discovery/consul/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoveryconsul><span>Consul</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoveryeureka-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoveryeureka-check>
<label for=m-docskitextutorialsthird-partyservice_discoveryeureka-check><a href=/docs/kitex/tutorials/third-party/service_discovery/eureka/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoveryeureka><span>Eureka</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoverynacos-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoverynacos-check>
<label for=m-docskitextutorialsthird-partyservice_discoverynacos-check><a href=/docs/kitex/tutorials/third-party/service_discovery/nacos/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoverynacos><span>Nacos</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoverypolaris-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoverypolaris-check>
<label for=m-docskitextutorialsthird-partyservice_discoverypolaris-check><a href=/docs/kitex/tutorials/third-party/service_discovery/polaris/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoverypolaris><span>Polaris</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoveryservice-comb-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoveryservice-comb-check>
<label for=m-docskitextutorialsthird-partyservice_discoveryservice-comb-check><a href=/docs/kitex/tutorials/third-party/service_discovery/service-comb/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoveryservice-comb><span>ServiceComb</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoveryzookeeper-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoveryzookeeper-check>
<label for=m-docskitextutorialsthird-partyservice_discoveryzookeeper-check><a href=/docs/kitex/tutorials/third-party/service_discovery/zookeeper/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoveryzookeeper><span>Zookeeper</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoverydns-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoverydns-check>
<label for=m-docskitextutorialsthird-partyservice_discoverydns-check><a href=/docs/kitex/tutorials/third-party/service_discovery/dns/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoverydns><span>DNS</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoveryrule-based-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoveryrule-based-check>
<label for=m-docskitextutorialsthird-partyservice_discoveryrule-based-check><a href=/docs/kitex/tutorials/third-party/service_discovery/rule-based/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoveryrule-based><span>Service Filtering</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsthird-partyconfig-center-li><input type=checkbox id=m-docskitextutorialsthird-partyconfig-center-check>
<label for=m-docskitextutorialsthird-partyconfig-center-check><a href=/docs/kitex/tutorials/third-party/config-center/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsthird-partyconfig-center><span>ConfigCenter</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyconfig-centeretcd-li><input type=checkbox id=m-docskitextutorialsthird-partyconfig-centeretcd-check>
<label for=m-docskitextutorialsthird-partyconfig-centeretcd-check><a href=/docs/kitex/tutorials/third-party/config-center/etcd/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyconfig-centeretcd><span>Etcd</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyconfig-centerapollo-li><input type=checkbox id=m-docskitextutorialsthird-partyconfig-centerapollo-check>
<label for=m-docskitextutorialsthird-partyconfig-centerapollo-check><a href=/docs/kitex/tutorials/third-party/config-center/apollo/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyconfig-centerapollo><span>Apollo</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyconfig-centernacos-li><input type=checkbox id=m-docskitextutorialsthird-partyconfig-centernacos-check>
<label for=m-docskitextutorialsthird-partyconfig-centernacos-check><a href=/docs/kitex/tutorials/third-party/config-center/nacos/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyconfig-centernacos><span>Nacos</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyconfig-centerfile-li><input type=checkbox id=m-docskitextutorialsthird-partyconfig-centerfile-check>
<label for=m-docskitextutorialsthird-partyconfig-centerfile-check><a href=/docs/kitex/tutorials/third-party/config-center/file/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyconfig-centerfile><span>File</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyconfig-centerzookeeper-li><input type=checkbox id=m-docskitextutorialsthird-partyconfig-centerzookeeper-check>
<label for=m-docskitextutorialsthird-partyconfig-centerzookeeper-check><a href=/docs/kitex/tutorials/third-party/config-center/zookeeper/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyconfig-centerzookeeper><span>Zookeeper</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyconfig-centerconsul-li><input type=checkbox id=m-docskitextutorialsthird-partyconfig-centerconsul-check>
<label for=m-docskitextutorialsthird-partyconfig-centerconsul-check><a href=/docs/kitex/tutorials/third-party/config-center/consul/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyconfig-centerconsul><span>Consul</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyobservability-li><input type=checkbox id=m-docskitextutorialsthird-partyobservability-check>
<label for=m-docskitextutorialsthird-partyobservability-check><a href=/docs/kitex/tutorials/third-party/observability/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyobservability><span>Observability</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialstool-li><input type=checkbox id=m-docskitextutorialstool-check>
<label for=m-docskitextutorialstool-check><a href=/docs/kitex/tutorials/tool/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialstool><span>Tool</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialstoolkitexcall-li><input type=checkbox id=m-docskitextutorialstoolkitexcall-check>
<label for=m-docskitextutorialstoolkitexcall-check><a href=/docs/kitex/tutorials/tool/kitexcall/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialstoolkitexcall><span>kitexcall: the CLI tool for sending RPC call in JSON format</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitexreference-li><input type=checkbox id=m-docskitexreference-check checked>
<label for=m-docskitexreference-check><a href=/docs/kitex/reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitexreference><span>Reference</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexreferencetransport_protocol_ttheader-li><input type=checkbox id=m-docskitexreferencetransport_protocol_ttheader-check>
<label for=m-docskitexreferencetransport_protocol_ttheader-check><a href=/docs/kitex/reference/transport_protocol_ttheader/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexreferencetransport_protocol_ttheader><span>TTHeader</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexreferenceexception-li><input type=checkbox id=m-docskitexreferenceexception-check>
<label for=m-docskitexreferenceexception-check><a href=/docs/kitex/reference/exception/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexreferenceexception><span>Exception Instruction</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexreferenceversion-li><input type=checkbox id=m-docskitexreferenceversion-check>
<label for=m-docskitexreferenceversion-check><a href=/docs/kitex/reference/version/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexreferenceversion><span>Version Specification</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitexbest-practice-li><input type=checkbox id=m-docskitexbest-practice-check checked>
<label for=m-docskitexbest-practice-check><a href=/docs/kitex/best-practice/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitexbest-practice><span>Best Practice</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practiceusage_attention-li><input type=checkbox id=m-docskitexbest-practiceusage_attention-check>
<label for=m-docskitexbest-practiceusage_attention-check><a href=/docs/kitex/best-practice/usage_attention/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practiceusage_attention><span>Usage Attention</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practicegraceful_shutdown-li><input type=checkbox id=m-docskitexbest-practicegraceful_shutdown-check>
<label for=m-docskitexbest-practicegraceful_shutdown-check><a href=/docs/kitex/best-practice/graceful_shutdown/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practicegraceful_shutdown><span>Graceful Shutdown</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practiceerror_handle-li><input type=checkbox id=m-docskitexbest-practiceerror_handle-check>
<label for=m-docskitexbest-practiceerror_handle-check><a href=/docs/kitex/best-practice/error_handle/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practiceerror_handle><span>Error Handle</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practiceremove_apache_codec-li><input type=checkbox id=m-docskitexbest-practiceremove_apache_codec-check>
<label for=m-docskitexbest-practiceremove_apache_codec-check><a href=/docs/kitex/best-practice/remove_apache_codec/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practiceremove_apache_codec><span>Kitex Remove Apache Thrift User Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitexbest-practiceintegration-testing-li><input type=checkbox id=m-docskitexbest-practiceintegration-testing-check>
<label for=m-docskitexbest-practiceintegration-testing-check><a href=/docs/kitex/best-practice/integration-testing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitexbest-practiceintegration-testing><span>Integration Testing</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practiceintegration-testingmock_client-li><input type=checkbox id=m-docskitexbest-practiceintegration-testingmock_client-check>
<label for=m-docskitexbest-practiceintegration-testingmock_client-check><a href=/docs/kitex/best-practice/integration-testing/mock_client/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practiceintegration-testingmock_client><span>How To Mock A Kitex Client</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practiceintegration-testingdebug_efficiently-li><input type=checkbox id=m-docskitexbest-practiceintegration-testingdebug_efficiently-check>
<label for=m-docskitexbest-practiceintegration-testingdebug_efficiently-check><a href=/docs/kitex/best-practice/integration-testing/debug_efficiently/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practiceintegration-testingdebug_efficiently><span>Debug Efficiently</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitexbest-practiceself_check-li><input type=checkbox id=m-docskitexbest-practiceself_check-check>
<label for=m-docskitexbest-practiceself_check-check><a href=/docs/kitex/best-practice/self_check/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitexbest-practiceself_check><span>Self Troubleshooting Guide</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practiceself_checkpanic_self_check-li><input type=checkbox id=m-docskitexbest-practiceself_checkpanic_self_check-check>
<label for=m-docskitexbest-practiceself_checkpanic_self_check-check><a href=/docs/kitex/best-practice/self_check/panic_self_check/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practiceself_checkpanic_self_check><span>Panic Self-check Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practiceself_checkmem_leak_self_check-li><input type=checkbox id=m-docskitexbest-practiceself_checkmem_leak_self_check-check>
<label for=m-docskitexbest-practiceself_checkmem_leak_self_check-check><a href=/docs/kitex/best-practice/self_check/mem_leak_self_check/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practiceself_checkmem_leak_self_check><span>Memory Leak Self-Check Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practiceself_checkfast_write_read_panic-li><input type=checkbox id=m-docskitexbest-practiceself_checkfast_write_read_panic-check>
<label for=m-docskitexbest-practiceself_checkfast_write_read_panic-check><a href=/docs/kitex/best-practice/self_check/fast_write_read_panic/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practiceself_checkfast_write_read_panic><span>FastWrite/FastRead Panic Error</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexfaq-li><input type=checkbox id=m-docskitexfaq-check checked>
<label for=m-docskitexfaq-check><a href=/docs/kitex/faq/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitexfaq><span>FAQ</span></a></label></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/cloudwego/cloudwego.github.io/edit/main/content/en//docs/kitex/tutorials/basic-feature/protocol/streaming/grpc/thrift_streaming target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/new/main/content/en//docs/kitex/tutorials/basic-feature/protocol/streaming/grpc/thrift_streaming?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/issues/new?labels=bug&amp;template=DOCS_UPDATE.md&amp;title=Thrift%20Streaming%20over%20gRPC" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/cloudwego/kitex/issues/new/choose target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a><ul><li><a href=#glossary>Glossary</a></li></ul></li><li><a href=#streaming-over-http2>Streaming over HTTP2</a><ul><li><a href=#getting-started>Getting Started</a></li><li><a href=#governance>Governance</a></li><li><a href=#middleware>Middleware</a></li><li><a href=#metainfo>Metainfo</a></li><li><a href=#observability>Observability</a></li><li><a href=#generic-not-implemented-yet>Generic (Not implemented yet)</a></li><li><a href=#attention>Attention</a></li></ul></li><li><a href=#streaming-over-ttheaderplanned>Streaming over TTHeader（Planned）</a></li><li><a href=#faq>FAQ</a><ul><li><a href=#is-multi-service-supported-one-server-multi-services->Is Multi-Service supported (One server, multi services) ?</a></li><li><a href=#is-streaming-over-http2-interoperable-with-other-grpc-implementations->Is &ldquo;Streaming over HTTP2&rdquo; interoperable with other grpc implementations ?</a></li><li><a href=#server-streaming-apihow-to-end-the-stream-prematurely-at-client-side>Server Streaming API：How to end the stream prematurely at client side?</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://www.cloudwego.io/docs/>Documentation</a></li><li class=breadcrumb-item><a href=https://www.cloudwego.io/docs/kitex/>Kitex</a></li><li class=breadcrumb-item><a href=https://www.cloudwego.io/docs/kitex/tutorials/>Tutorials</a></li><li class=breadcrumb-item><a href=https://www.cloudwego.io/docs/kitex/tutorials/basic-feature/>Basic Feature</a></li><li class=breadcrumb-item><a href=https://www.cloudwego.io/docs/kitex/tutorials/basic-feature/protocol/>Protocol</a></li><li class=breadcrumb-item><a href=https://www.cloudwego.io/docs/kitex/tutorials/basic-feature/protocol/streaming/>Streaming</a></li><li class=breadcrumb-item><a href=https://www.cloudwego.io/docs/kitex/tutorials/basic-feature/protocol/streaming/grpc/>gRPC</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://www.cloudwego.io/docs/kitex/tutorials/basic-feature/protocol/streaming/grpc/thrift_streaming/>Thrift Streaming over gRPC</a></li></ol></nav><div class=td-content><h1>Thrift Streaming over gRPC</h1><div class=lead>This article describes how to define and use the Streaming API in Thrift IDL over gRPC.</div><header class=article-meta></header><h2 id=introduction>Introduction</h2><p>Many business scenarios (such as LLM&rsquo;s streaming response and large-scale data transmission) require a Streaming API: first establish a stream between client and server instances, and then send and receive messages unidirectionally or bidirectionally based on this stream.</p><blockquote><p>This feature is introduced in Kitex <code>v0.9.0</code>, but there&rsquo;s some issues related to the tracing which is fixed in <code>v0.9.1</code>. You&rsquo;re recommended to use the new version, and this doc is based on the new version to avoid trivial descriptions.</p></blockquote><h3 id=glossary>Glossary</h3><h4 id=pingpong-api-kitexthrift>PingPong API (KitexThrift)</h4><p>Kitex&rsquo;s default mode of Thrift APIs.</p><ul><li>Only support Ping-Pong request/response (no Streaming).</li><li>Thrift Payload may have prefixed <a href=/docs/kitex/reference/transport_protocol_ttheader/>TTHeader</a>、<a href=https://github.com/apache/thrift/blob/0.13.0/doc/specs/thrift-rpc.md#framed-vs-unframed-transport>Framed</a>，or their combination (TTHeader + Framed + Payload).</li></ul><h4 id=unary-api>Unary API</h4><blockquote><p><a href=https://grpc.io/docs/what-is-grpc/core-concepts/#unary-rpc>Concept borrowed from GRPC</a>, specifically referring to Ping-Pong API on a stream.</p></blockquote><p>In a stream-based (such as HTTP2 stream) Ping-Pong request, the client sends a Message, the server returns a Message, and then closes the stream.
<strong>Since there will be performance losses, it&rsquo;s not recommended to use Unary APIs without special requirements. Please just use the KitexThrift API.</strong>
If there&rsquo;s really a need, you can enable it with an annotation in your Thrift IDL.</p><h4 id=streaming-api>Streaming API</h4><p>There are 3 kinds of Streaming APIs (referring to <a href=https://grpc.io/docs/what-is-grpc/core-concepts/>grpc core concepts</a>).</p><h5 id=server-streaming>Server Streaming</h5><p>The client sends a message, the server returns multiple messages, and then closes the stream.
It&rsquo;s suitable for LLM scenarios.</p><h5 id=client-streaming>Client Streaming</h5><p>The client sends multiple messages, the server returns one message, and then closes the stream.</p><h5 id=bidirectional-streaming>Bidirectional Streaming</h5><p>The sending and receiving of Client/Server are independent, which can be organized in arbitrary order.</p><h2 id=streaming-over-http2>Streaming over HTTP2</h2><p>This scheme is based on GRPC/HTTP2 implementation, replacing the encoding of Payload from Protobuf to Thrift.</p><h3 id=getting-started>Getting Started</h3><h4 id=preparation>Preparation</h4><p>Install Kitex >= v0.9.1 and Thriftgo >= v0.3.6 which support Thrift Streaming.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go install github.com/cloudwego/thriftgo@latest
</span></span><span style=display:flex><span>go install github.com/cloudwego/kitex/tool/cmd/kitex@latest
</span></span></code></pre></div><h4 id=compose-thrift-idl>Compose Thrift IDL</h4><p>Kitex determines the Streaming type of a method through the <code>streaming.mode</code> annotation.</p><table><thead><tr><th>Value</th><th>Meaning</th><th>Extra Note</th></tr></thead><tbody><tr><td>bidirectional</td><td>Bidirectional streaming</td><td>The sending and receiving of Client/Server are independent</td></tr><tr><td>client</td><td>Client Side Streaming</td><td>The client sends multiple messages, the server returns one message</td></tr><tr><td>server</td><td>Server Side Streaming</td><td>The client sends a message, the server returns multiple messages</td></tr><tr><td>unary</td><td>Unary over Streaming</td><td>Client sends a Message, the Server returns a Message (Not recommended due to performance loss)</td></tr><tr><td>(other)</td><td>Invalid, leading to an error</td><td></td></tr></tbody></table><p>NOTE：</p><ol><li>Streaming API should have exactly one request and one response, otherwise Kitex will report an error.</li><li><strong>Kitex supports both PingPong APIs (non-streaming) and Streaming APIs in the same Service</strong><ol><li>Kitex server will automatically detect the protocol and route requests</li></ol></li><li>Unary over HTTP2 is not recommended due to performance loss; just use PingPong APIs</li><li><code>streaming.mode</code> can appear at most once, otherwise kitex will report an error</li></ol><p><a href=https://github.com/cloudwego/kitex-examples/blob/v0.3.1/thrift_streaming/api.thrift>Example IDL</a> (The following examples are based on this IDL):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-thrift data-lang=thrift><span style=display:flex><span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>go</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>echo</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>struct</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Request</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>optional</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>string</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>message</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>struct</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Response</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>optional</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>string</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>message</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>service</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TestService</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>Response</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Echo</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Request</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>req</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>streaming.mode</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;bidirectional&#34;</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>Response</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EchoClient</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Request</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>req</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>streaming.mode</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;client&#34;</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>Response</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EchoServer</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Request</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>req</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>streaming.mode</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;server&#34;</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// Response EchoUnary (1: Request req) (streaming.mode=&#34;unary&#34;), // not recommended
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>Response</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EchoPingPong</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Request</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>req</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>// KitexThrift, non-streaming
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=scaffold-generation>Scaffold Generation</h4><p>For new projects, first initialize the project directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir demo-project <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#204a87>cd</span> demo-project
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>module</span><span style=color:#ce5c00;font-weight:700>=</span>demo
</span></span><span style=display:flex><span>go mod init <span style=color:#000>$module</span>
</span></span></code></pre></div><p>The use of Kitex is just the same as before, for example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kitex -module <span style=color:#000>$module</span> -service demo-server api.thrift
</span></span></code></pre></div><p>Note: For existing projects, you also need to regenerate the code and update the kitex version in your <code>go.mod</code>.</p><p>Then run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go mod tidy
</span></span></code></pre></div><h4 id=write-business-code>Write business code</h4><h5 id=create-stream-client-for-the-caller-side>Create Stream Client (for the caller side)</h5><p>NOTE:</p><ul><li>You need to create <strong>StreamClient</strong> for calling a Streaming API</li><li><code>streamclient.Option</code> (not client.Option) is used for creating a StreamClient</li><li><code>streamcall.Option</code> (not callopt.Option) is used for a Streaming API call</li></ul><p>Example code:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;github.com/cloudwego/kitex/client/streamclient&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;github.com/cloudwego/kitex/client/callopt/streamcall&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>streamClient</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>testservice</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MustNewStreamClient</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;demo-server&#34;</span><span style=color:#000;font-weight:700>,</span>                                  <span style=color:#8f5902;font-style:italic>// Service Name</span>
</span></span><span style=display:flex><span>    <span style=color:#000>streamclient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithHostPorts</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;127.0.0.1:8888&#34;</span><span style=color:#000;font-weight:700>),</span>   <span style=color:#8f5902;font-style:italic>// streamclient.Option...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>stream</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>streamClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Echo</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// business logic</span>
</span></span></code></pre></div><h5 id=bidirectional-streaming-api>Bidirectional Streaming API</h5><p>NOTE：</p><ol><li>The caller and callee should negotiate a way to finish the Stream, otherwise it may cause both parties to wait forever (goroutine leak).</li><li>The example shows full duplex mode (Recv and Send are completely independent).<ol><li>The processing logic can be adjusted according to business needs, for example (half-duplex mode), the server always receives a message and processes it before sending the result to the client.</li></ol></li></ol><h6 id=server-handler>Server Handler</h6><p>NOTE:</p><ol><li>Kitex will send the trailer frame (which means the stream is closed) after the method handler returns; there&rsquo;s no need for biz code to call stream.Close() manually.</li><li>Newly started goroutines should have panic-recover logic in business code</li><li><code>io.EOF</code> returned by Recv call indicates that the client has finished sending</li></ol><p>Example code: <a href=https://github.com/cloudwego/kitex-examples/blob/v0.3.1/thrift_streaming/handler.go#L34>kitex-examples:thrift_streaming/handler.go#L34</a></p><h6 id=stream-client>Stream Client</h6><p>Note:</p><ol><li><p>Newly started goroutines should have panic-recover logic in business code</p></li><li><p>After the client finishes sending, it should promptly call stream.Close() to inform the server.</p></li><li><p>A non-nil error (including <code>io.EOF</code>) returned by <code>Recv</code> indicates that the server has finished sending (or encountered an error)</p><ol><li>It&rsquo;s when Kitex records the <code>RPCFinish</code> event (Tracer depends on this event).</li><li>If the client and server have another termination method, <code>streaming.FinishStream(stream, err)</code> should be called manually to record the RPCFinish event.</li></ol></li></ol><p>Example code: <a href=https://github.com/cloudwego/kitex-examples/blob/v0.3.1/thrift_streaming/client/demo_client.go#L119>kitex-examples:thrift_streaming/client/demo_client.go#L119</a></p><h5 id=server-streaming-api>Server Streaming API</h5><h6 id=server-handler-1>Server Handler</h6><p>Note: Kitex will send the trailer frame (which means the stream is closed) after the method handler returns; there&rsquo;s no need for biz code to call <code>stream.Close()</code> manually.</p><p>Example code: <a href=https://github.com/cloudwego/kitex-examples/blob/v0.3.1/thrift_streaming/handler.go#L94>kitex-examples:thrift_streaming/handler.go#L94</a></p><h6 id=stream-client-1>Stream Client</h6><p>Note: A non-nil error (including <code>io.EOF</code>) returned by <code>Recv</code> indicates that the server has finished sending (or encountered an error)</p><ol><li>It&rsquo;s when Kitex records the <code>RPCFinish</code> event (Tracer depends on this event).</li><li>If the client and server have another termination method, <code>streaming.FinishStream(stream, err)</code> should be called manually to record the RPCFinish event.</li></ol><p>Example code: <a href=https://github.com/cloudwego/kitex-examples/blob/v0.3.1/thrift_streaming/client/demo_client.go#L185>kitex-examples:thrift_streaming/client/demo_client.go#L185</a></p><h5 id=client-streaming-api>Client Streaming API</h5><h6 id=server-handler-2>Server Handler</h6><p>Note: <code>io.EOF</code> returned by Recv call indicates that the client has finished sending</p><p>Example code: <a href=https://github.com/cloudwego/kitex-examples/blob/v0.3.1/thrift_streaming/handler.go#L82>kitex-examples:thrift_streaming/handler.go#L82</a></p><h6 id=stream-client-2>Stream Client</h6><p>Example code: <a href=https://github.com/cloudwego/kitex-examples/blob/v0.3.1/thrift_streaming/client/demo_client.go#L162>kitex-examples:thrift_streaming/client/demo_client.go#L162</a></p><h4 id=options>Options</h4><h5 id=streamclient-options>StreamClient Options</h5><p>Kitex distinguishes between <strong>Client</strong> (for KitexThrift PingPong API) and <strong>StreamClient</strong> (for Streaming API) in design, and requires <strong>StreamClient</strong> to use another set of Options (of different types) to avoid users specifying unsupported Options for StreamClient.</p><p>NOTE:</p><ul><li>If a client/callopt Option does not have a corresponding streamclient/streamcall Option (such as <code>WithRPCTimeout</code>), it means that StreamClient does not support this capability.</li><li>If you think StreamClient should support this capability, you can <a href=https://github.com/cloudwego/kitex/issues>submit an issue to Kitex</a>.</li></ul><h6 id=streamclientoption>streamclient.Option</h6><ul><li>Specified in <code>NewStreamClient</code></li><li>New Options:<ul><li><code>WithRecvMiddleware</code>、<code>WithRecvMiddlewareBuilder</code>: details in &ldquo;Recv/Send Middleware&rdquo;</li><li><code>WithSendMiddleware</code>、<code>WithSendMiddlewareBuilder</code>: details in &ldquo;Recv/Send Middleware&rdquo;</li></ul></li></ul><p>Example code:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;github.com/cloudwego/kitex/client/streamclient&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>streamClient</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>testservice</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MustNewStreamClient</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;demo-server&#34;</span><span style=color:#000;font-weight:700>,</span>                                  <span style=color:#8f5902;font-style:italic>// Service Name</span>
</span></span><span style=display:flex><span>    <span style=color:#000>streamclient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithHostPorts</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;127.0.0.1:8888&#34;</span><span style=color:#000;font-weight:700>),</span>   <span style=color:#8f5902;font-style:italic>// streamclient.Option...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h6 id=streamcalloption>streamcall.Option</h6><ul><li>Specified when creating Stream.</li><li>The priority is higher than the <code>streamclient.Option</code> with the same name (if exists).</li></ul><p>Example code：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;github.com/cloudwego/kitex/client/callopt/streamcall&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>stream</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>streamClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Echo</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Background</span><span style=color:#000;font-weight:700>(),</span>
</span></span><span style=display:flex><span>    <span style=color:#000>streamcall</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithHostPort</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;127.0.0.1:8888&#34;</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h5 id=server-options>Server Options</h5><blockquote><p>Due to the Server&rsquo;s support for automatic detection protocols, it can support both Streaming API and KitexThrift API, so it&rsquo;s impractical to use different Option types like StreamClient.</p></blockquote><ul><li>Most <a href=/docs/kitex/tutorials/options/server_options/>Server Option</a>(s) are applicable to Streaming APIs<ul><li><strong>For uncertain options, validate before deploying to the production environment</strong></li><li>Options not applicable to Streaming APIs include:<ul><li><code>WithReadWriteTimeout</code></li><li><code>WithBoundHandler</code></li><li>&mldr;</li></ul></li></ul></li><li>New options related to Recv/Send Middleware:<ul><li><code>WithRecvMiddleware</code>、<code>WithRecvMiddlewareBuilder</code></li><li><code>WithSendMiddleware</code>、<code>WithSendMiddlewareBuilder</code></li><li><code>WithCompatibleMiddlewareForUnary</code><ul><li>It&rsquo;s mainly for GRPC/Protobuf Streaming, to make the type of middleware parameters of Unary API requests the same as that of PingPong API requests.</li><li>It&rsquo;s specified by default for Thrift Streaming, but you&rsquo;re not recommended to use Unary API.</li></ul></li></ul></li></ul><h3 id=governance>Governance</h3><h4 id=timeout>Timeout</h4><h5 id=connection-timeout>Connection Timeout</h5><p>It can be specified with the following options:</p><ul><li><code>streamclient.WithConnectTimeout</code></li><li><code>streamcall.WithConnectTimeout</code> (higher priority)</li></ul><h5 id=rpc-timeout-not-supported>RPC Timeout (not supported)</h5><p>There is no corresponding option.
For the Streaming API, Kitex&rsquo;s Timeout Middleware will <a href=https://github.com/cloudwego/kitex/blob/v0.9.1/client/rpctimeout.go#L101>do nothing but just call next</a>.</p><h5 id=stream-timeout>Stream Timeout</h5><p>To control the timeout for the whole stream, please create a context object with deadline by <code>context.WithTimeout</code> or <code>context.WithDeadline</code> , and create a stream with this context object.</p><ul><li>Kitex Client<ul><li>A header <code>grpc-timeout</code> will be sent to the server</li><li>After deadline, Recv/Send will return an error <code>rpc error: code = 4 desc = context deadline exceeded</code></li></ul></li><li>Kitex Server<ul><li>The value in header <code>grpc-timeout</code> will be set as the deadline in the request context</li><li>After deadline, Recv/Send will return an error <code>rpc error: code = 4 desc = context deadline exceeded</code></li></ul></li></ul><p>Example code:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// inject deadline into context BEFORE creating a stream</span>
</span></span><span style=display:flex><span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>cancel</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithTimeout</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Background</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Second</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>cancel</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>stream</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>cli</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Echo</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h5 id=recvsend-timeout>Recv/Send Timeout</h5><p>Kitex provides a helper function <code>streaming.CallWithTimeout</code> for this.</p><h6 id=client>Client</h6><p>NOTE:</p><ol><li><p>Create a context with <code>cancel</code> <strong>BEFORE creating a Stream</strong> (e.g. by WithCancel or WithTimeout)</p></li><li><p>Set the <code>cancel</code> func as the 2nd param for <code>streaming.CallWithTimeout</code></p></li><li><p>Otherwise Send/Recv may block for a long timeout (depending on the server side) which may cause goroutine leak.</p></li><li><p>The semantic of <code>stream.Close()</code> on the client side is <code>CloseSend</code>, informing the server that there will be no new messages (the server <code>Recv</code> call returns <code>io.EOF</code>), and does not close the receiving end, so it cannot be used as the cancel method.</p></li></ol><p>Example code:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;github.com/cloudwego/kitex/pkg/streaming&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Add a cancel func to the context BEFORE creating a stream</span>
</span></span><span style=display:flex><span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>cancel</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithCancel</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Background</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>cancel</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>stream</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>cli</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Echo</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Send with timeout</span>
</span></span><span style=display:flex><span><span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>streaming</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>CallWithTimeout</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Second</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>cancel</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>error</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>stream</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Send</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>test</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Request</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>Message</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;hello&#34;</span><span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Recv with timeout</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>resp</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>test</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Response</span>
</span></span><span style=display:flex><span><span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>streaming</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>CallWithTimeout</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Second</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>cancel</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>resp</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>stream</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Recv</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>err</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>})</span>
</span></span></code></pre></div><h6 id=server>Server</h6><p><code>stream.Close()</code> can be used as cancel func (with a simple encapsulation).</p><p>Example code:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>cancel</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>CancelFunc</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>stream</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span> <span style=color:#8f5902;font-style:italic>// the cancel func in streamContext will be called internally</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>req</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>test</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>EchoRequest</span>
</span></span><span style=display:flex><span><span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>streaming</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>CallWithTimeout</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Second</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>cancel</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>errRecv</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>req</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>errRecv</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>stream</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Recv</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>errRecv</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>})</span>
</span></span></code></pre></div><h4 id=circuitbreak>CircuitBreak</h4><p>Only supports the error rate fuse when <strong>creating a connection (stream)</strong>.
No support for circuitbreaker on Recv/Send calls.</p><h4 id=retry-not-supported>Retry (Not Supported)</h4><p>Retry are not supported.</p><h4 id=fallback-not-supported>Fallback (Not Supported)</h4><p>Streaming API has no fallback support.</p><h4 id=loadbalancer>LoadBalancer</h4><ul><li>Load Balance is only supported when creating a Stream (equivalent to creating a network connection).</li><li>Subsequent Send/Recv calls will only be with the opposite end of the Stream<ul><li>It&rsquo;s the user&rsquo;s responsibility to deal with uneven load caused by Recv/Send on certain streams.<ul><li>Take file transmission as an example, one stream for a 1KB file (only one Send needed) and one stream for a 1GB file ()</li></ul></li></ul></li></ul><h5 id=consistent-hash>Consistent Hash</h5><p>Note: Since the Request obtained in a client middleware is always nil, your <code>keyFunc</code> cannot directly read the request.</p><p>Workaround:</p><ol><li>Before creating the Stream, calculate the hash value of your request and set it in ctx</li><li>Read the hash value in your <code>keyFunc</code> from ctx</li></ol><p>Example code:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>streamClient</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>testservice</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MustNewStreamClient</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;demo-server&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>streamclient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithLoadBalancer</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>loadbalance</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewConsistBalancer</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>        <span style=color:#000>loadbalance</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewConsistentHashOption</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>request</span> <span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{})</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>hashKey</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>ctx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;MY_HASH_KEY&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>hashKey</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;&#34;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#8f5902;font-style:italic>// if necessary, return a random string, but never an empty string</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87>panic</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;invalid hashKey for consistent hash&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>hashKey</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>request</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>echo</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Request</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>Message</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;hello&#34;</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>ctx</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithKey</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>background</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#4e9a06>&#34;MY_HASH_KEY&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>keyFunc</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>request</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#000>stream</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>streamClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Echo</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>request</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h4 id=server-limit-qpsconcurrency>Server Limit (QPS/Concurrency)</h4><ul><li>Support limiting when creating a stream.</li><li>After creating a Stream, there are no restrictions on subsequent Recv/Send calls, which has to be implemented by the business itself.</li></ul><h3 id=middleware>Middleware</h3><h4 id=clientserver-middleware>Client/Server Middleware</h4><h5 id=client-middleware>Client Middleware</h5><p>NOTE:</p><ul><li>Client middleware only covers the <strong>process of &ldquo;creating a stream&rdquo;</strong><ul><li>After creating the stream and returning to business code, all client middlewares are already executed</li></ul></li><li>The request parameter is always nil /(even for Server Streaming API requests/)</li><li>The response parameter is always of type *<a href=https://github.com/cloudwego/kitex/blob/v0.8.0/pkg/streaming/streaming.go#L67>streaming.Result</a>, containing the <code>Stream</code> finally returned to user code<ul><li>If there&rsquo;s a need, you can replace the Stream object with your own implementation using the <a href=https://zh.wikipedia.org/wiki/%E4%BF%AE%E9%A5%B0%E6%A8%A1%E5%BC%8F>decorator pattern</a></li></ul></li><li>If the error returned is not nil, it means Kitex fails to create a stream</li><li><strong>Client Middleware can NOT obtain the message for Recv and Send calls.</strong></li></ul><h6 id=execution-flow-diagram>Execution Flow Diagram</h6><p>Note:</p><ul><li>Below shows the flow of Bidirectional Streaming APIs (and Client Streaming APIs are similar)</li><li>But Server Streaming APIs are different: <a href=https://github.com/cloudwego/kitex-examples/blob/v0.3.1/thrift_streaming/kitex_gen/echo/testservice/testservice.go#L336>Send and Close are called in kitex_gen (generated code)</a>, before returning to user code.</li></ul><p><img src=/img/docs/streaming/kitex_client_execution_flow.png alt=image></p><h6 id=requestresponse-types-obtained>Request/Response types obtained</h6><table><thead><tr><th style=text-align:center></th><th style=text-align:center>request</th><th style=text-align:center>response</th></tr></thead><tbody><tr><td style=text-align:center>Bidirectional</td><td style=text-align:center>interface{} = nil</td><td style=text-align:center>*streaming.Result</td></tr><tr><td style=text-align:center>Client Streaming</td><td style=text-align:center>interface{} = nil</td><td style=text-align:center>*streaming.Result</td></tr><tr><td style=text-align:center>Server Streaming</td><td style=text-align:center>interface{} = nil</td><td style=text-align:center>*streaming.Result</td></tr></tbody></table><p>Note:</p><ol><li>Request message is also not available in client middleware for Server Streaming API requests. Please use Client Send Middleware instead.</li><li>For Thrift Streaming Unary APIs, it&rsquo;s just the same as PingPong APIs.</li></ol><h6 id=identifying-streamingnon-streaming-requests>Identifying Streaming/Non-Streaming Requests</h6><p><strong>Client</strong> middlewares should rely on the type of <code>response</code> to determine whether it&rsquo;s a streaming request:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>clientMW</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>next</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Endpoint</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Endpoint</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>req</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>resp</span> <span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{})</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>resp</span><span style=color:#000;font-weight:700>.(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>streaming</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Result</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>ok</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// it&#39;s a streaming request</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>next</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>req</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>resp</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>       <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// it&#39;s a non-streaming request</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>next</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>req</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>resp</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>       <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h5 id=server-middleware>Server Middleware</h5><p>NOTE:</p><ul><li>The <code>next</code> method of Server Middleware covers the entire processing process of the server handler</li><li>The request parameter is always of type *<a href=https://github.com/cloudwego/kitex/blob/v0.9.1/pkg/streaming/streaming.go#L70>streaming.Args</a>, containing the Stream finally returned to user code<ul><li>If there&rsquo;s a need, you can replace the Stream object with your own implementation using the <a href=https://zh.wikipedia.org/wiki/%E4%BF%AE%E9%A5%B0%E6%A8%A1%E5%BC%8F>decorator pattern</a></li></ul></li><li>The response parameter is always nil (even for Client Streaming API requests)</li><li>If the error returned is not nil, it means some inner middleware or the handler fails.</li><li><strong>For Streaming APIs (not including Unary), Server Middleware can NOT obtain the message processed by Recv and Send calls.</strong></li></ul><h6 id=execution-flow-diagram-1>Execution Flow Diagram</h6><ul><li>Bidirectional Streaming API</li></ul><p><img src=/img/docs/streaming/kitex_server_execution_flow_bidirectional.png alt=image></p><ul><li>Server Streaming API</li></ul><p><img src=/img/docs/streaming/kitex_server_execution_flow_server.png alt=image></p><ul><li>Client Streaming API</li></ul><p><img src=/img/docs/streaming/kitex_server_execution_flow_client.png alt=image></p><h6 id=requestresponse-field-types-obtained>Request/Response field types obtained</h6><table><thead><tr><th style=text-align:center></th><th style=text-align:center>request</th><th style=text-align:center>response</th></tr></thead><tbody><tr><td style=text-align:center>Bidirectional</td><td style=text-align:center>*streaming.Args</td><td style=text-align:center>interface{} = nil</td></tr><tr><td style=text-align:center>Client Streaming</td><td style=text-align:center>*streaming.Args</td><td style=text-align:center>interface{} = nil</td></tr><tr><td style=text-align:center>Server Streaming</td><td style=text-align:center>*streaming.Args</td><td style=text-align:center>interface{} = nil</td></tr></tbody></table><p>Note:</p><ol><li>The client request message is also not available in server middleware for Server Streaming API requests. Please use Server Recv Middleware instead.</li><li>For Thrift Streaming Unary APIs, it&rsquo;s just the same as PingPong APIs.</li></ol><h6 id=identifying-streamingnon-streaming-requests-1>Identifying Streaming/Non-Streaming Requests</h6><p><strong>Server</strong> middlewares should rely on the type of <code>request</code> to determine whether it&rsquo;s a streaming request:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>serverMW</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>next</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Endpoint</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Endpoint</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>req</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>resp</span> <span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{})</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>req</span><span style=color:#000;font-weight:700>.(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>streaming</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Args</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>ok</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// it&#39;s a streaming request</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>next</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>req</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>resp</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>       <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// it&#39;s a non-streaming request</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>next</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>req</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>resp</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>       <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Note: for Thrift Streaming Unary APIs, it&rsquo;s just the same as PingPong APIs.</p><h4 id=recvsend-middleware>Recv/Send Middleware</h4><p>Messages can be intercepted with Recv/Send Middleware.</p><p><img src=/img/docs/streaming/kitex_recvsend_middleware.png alt=image></p><h5 id=recv-middleware>Recv Middleware</h5><p>NOTE: in Recv Middleware, <strong><code>next</code> should be called before reading the message</strong></p><h6 id=streamclient>StreamClient</h6><p>NOTE: for client, the message type for a <code>Recv</code> call should be the API&rsquo;s <strong>response</strong> type defined in IDL</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;github.com/cloudwego/kitex/client/streamclient&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;github.com/cloudwego/kitex/pkg/endpoint&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;github.com/cloudwego/kitex/pkg/klog&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;github.com/cloudwego/kitex/pkg/streaming&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;github.com/cloudwego/kitex/pkg/utils/kitexutil&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>streamClient</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>testservice</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MustNewStreamClient</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;demo-server&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>streamclient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithRecvMiddleware</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>next</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RecvEndpoint</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RecvEndpoint</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stream</span> <span style=color:#000>streaming</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Stream</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>resp</span> <span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{})</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>method</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>kitexutil</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetMethod</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stream</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>          <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>next</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stream</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>resp</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#000>klog</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Infof</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[%s] client recv middleware, err = %v, resp = %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>method</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>resp</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>err</span>
</span></span><span style=display:flex><span>       <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}),</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h6 id=server-1>Server</h6><p>NOTE: for server, the message type for a <code>Recv</code> call should be the API&rsquo;s <strong>request</strong> type defined in IDL</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>svr</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>test</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewServer</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>new</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>TestServiceImpl</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>    <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithRecvMiddleware</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>next</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RecvEndpoint</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RecvEndpoint</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stream</span> <span style=color:#000>streaming</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Stream</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>req</span> <span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{})</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>method</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>kitexutil</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetMethod</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stream</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>          <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>next</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stream</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>req</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#000>klog</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Infof</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[%s] server recv middleware: &lt;= req = %v, err = %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>method</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>req</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>err</span>
</span></span><span style=display:flex><span>       <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}),</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h5 id=send-middleware>Send Middleware</h5><h6 id=streamclient-1>StreamClient</h6><p>NOTE: for client, the message type for a <code>Send</code> call should be the API&rsquo;s <strong>request</strong> type defined in IDL</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;github.com/cloudwego/kitex/client/streamclient&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;github.com/cloudwego/kitex/pkg/endpoint&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;github.com/cloudwego/kitex/pkg/klog&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;github.com/cloudwego/kitex/pkg/streaming&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;github.com/cloudwego/kitex/pkg/utils/kitexutil&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>streamClient</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>testservice</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MustNewStreamClient</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;demo-server&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>streamclient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithSendMiddleware</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>next</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SendEndpoint</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SendEndpoint</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stream</span> <span style=color:#000>streaming</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Stream</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>req</span> <span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{})</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>method</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>kitexutil</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetMethod</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stream</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>          <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>next</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stream</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>req</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#000>klog</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Infof</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[%s] client send middleware, err = %v, req = %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>method</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>req</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>err</span>
</span></span><span style=display:flex><span>       <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}),</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h6 id=server-2>Server</h6><p>NOTE: for server, the message type for a <code>Send</code> call should be the API&rsquo;s <strong>response</strong> type defined in IDL</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>svr</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>test</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewServer</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>new</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>TestServiceImpl</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>    <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithSendMiddleware</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>next</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SendEndpoint</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SendEndpoint</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stream</span> <span style=color:#000>streaming</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Stream</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>resp</span> <span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{})</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>method</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>kitexutil</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetMethod</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stream</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>          <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>next</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stream</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>resp</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#000>klog</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Infof</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[%s] server send middleware: =&gt; resp = %v, err = %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>method</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>resp</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>err</span>
</span></span><span style=display:flex><span>       <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}),</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h4 id=sharing-data-between-clientserver-and-recvsend-middlewares>Sharing Data Between Client/Server and Recv/Send Middlewares</h4><p>By injecting keys into the ctx used to create the stream, we can share data between middlewares.</p><p>Kitex provides a set of helper functions to inject a <code>sync.Map</code> for sharing data between middlewares:</p><ul><li><a href=https://github.com/cloudwego/kitex/blob/v0.9.1/pkg/utils/contextmap/contextmap.go#L32C6-L32C20>contextmap.WithContextMap(ctx)</a></li><li><a href=https://github.com/cloudwego/kitex/blob/v0.9.1/pkg/utils/contextmap/contextmap.go#L37>contextmap.GetContextMap(ctx)</a></li></ul><p>Note: Kitex often needs to read information from ctx internally (say, RPCInfo), and ctx is a linked list, <strong>injecting a key means adding a list node, which may cause performance loss.</strong> Therefore, Kitex does not inject this key by default.</p><h5 id=example-code-for-client>Example code for Client</h5><p>In Client Middleware, the stream has not been created before calling <code>next</code>, so you can inject the sync.Map into ctx and then call <code>next</code>, then the map can be obtained from <code>stream.Context()</code> in Recv/Send middleware for reading and writing.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;github.com/cloudwego/kitex/pkg/utils/contextmap&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>streamClient</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>testservice</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MustNewStreamClient</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;server&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>streamclient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithHostPorts</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;127.0.0.1:8888&#34;</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>    <span style=color:#000>streamclient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithMiddleware</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>next</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Endpoint</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Endpoint</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>req</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>resp</span> <span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{})</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>           <span style=color:#8f5902;font-style:italic>// inject sync.Map in client middleware</span>
</span></span><span style=display:flex><span>           <span style=color:#000>ctx</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>contextmap</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithContextMap</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>           <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>contextmap</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetContextMap</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>ok</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Store</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;hello&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;world&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>           <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>           <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>next</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>req</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>resp</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}),</span>
</span></span><span style=display:flex><span>    <span style=color:#000>streamclient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithRecvMiddleware</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>next</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RecvEndpoint</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>endpoint</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RecvEndpoint</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stream</span> <span style=color:#000>streaming</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Stream</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>resp</span> <span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{})</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// get the map in Recv/Send middleware for read/write</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>contextmap</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetContextMap</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stream</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>());</span> <span style=color:#000>ok</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Load</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;hello&#34;</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>ok</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>klog</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Infof</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[Recv Middleware] hello = %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>next</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stream</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>resp</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}),</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h5 id=example-code-for-server>Example code for Server</h5><p>The server side is different from the client side.
Before entering a server middleware, the stream has already been created, so it&rsquo;s impossible to inject a key inside a server middleware.
However, it can be achieved in the following way:</p><ul><li>Specify a <code>MetaHandler</code> with <code>server.WithMetaHandler</code> Option</li><li>This <code>MetaHandler</code> should implement the interface <code>StreamingMetaHandler</code></li><li>In the function <code>OnReadStream</code>, inject <code>sync.Map</code> into ctx, and return the new ctx object.</li></ul><p>Kitex provides a customMetaHandler making it quite easy to add a key to the context before creating a stream. You only need to specify the following option when initializing a server:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithMetaHandler</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>remote</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewCustomMetaHandler</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>remote</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithOnReadStream</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>contextmap</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithContextMap</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>),</span> <span style=color:#204a87;font-weight:700>nil</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)))</span>
</span></span></code></pre></div><p>Note:</p><ol><li>Full example code in: <a href=https://github.com/cloudwego/kitex-tests/blob/main/thrift_streaming/thrift_test.go#L1090>kitex-tests: TestCustomMetaHandler</a></li><li>If you don&rsquo;t want to use the RC tag for now, you may implement your MetaHandler according to <a href=https://github.com/cloudwego/kitex/blob/v0.9.1/pkg/remote/custom_meta_handler.go#L29>customMetaHandler</a></li></ol><h3 id=metainfo>Metainfo</h3><p>Please refer to the &ldquo;Kitex gRPC Metadata&rdquo; section in <a href=/docs/kitex/tutorials/advanced-feature/metainfo/#kitex-grpc-metadata>CloudWeGo - Kitex - Metainfo</a>.</p><p>NOTE</p><ul><li>metainfo<ul><li>Keys with lowercase letters or hyphen will be dropped, e.g. &ldquo;Hello&rdquo;, &ldquo;HELLO-WORLD&rdquo;</li></ul></li><li>metadata<ul><li><strong>MUST</strong> use this kitex forked pkg: <strong>github.com/cloudwego/kitex/pkg/remote/trans/nphttp2/metadata</strong></li></ul></li><li>header & trailer<ul><li>Keys with capital letters will cause errors on the client side</li></ul></li></ul><h3 id=observability>Observability</h3><h4 id=basic-events-rpcstart--rpcfinish>Basic Events: RPCStart & RPCFinish</h4><ul><li>For Server/Bidirectional Streaming APIs: Kitex Client will not record the RPCFinish event until <code>Recv()</code> receives a non-nil error (<code>io.EOF</code> or other errors).<ul><li>If you wish to finish stream early, please remember to manually call <code>streaming.FinishStream(stream, err)</code> to propagate the RPCFinish event.</li></ul></li><li>For Client Streaming APIs: Kitex Client will record the RPCFinish event at the end of the <code>CloseAndRecv()</code> call.</li></ul><p>Kitex users can add customized Tracers to deal with those events in the <code>Finish()</code> method. Refer to <a href=/docs/kitex/tutorials/observability/tracing/#customize-tracer>Kitex - Tracing - Custom Tracer</a> for more details.</p><h4 id=detailed-events-streamsend--streamrecv>Detailed Events: StreamSend & StreamRecv</h4><p>If at least one Tracer implements the interface <a href=https://github.com/cloudwego/kitex/blob/v0.9.1/pkg/rpcinfo/tracer.go#L31>rpcinfo.StreamEventReporter</a>, Kitex will inject the corresponding Recv/Send middleware for to call the tracer&rsquo;s <code>ReportStreamEvent</code> after the execution of each Recv/Send call.
The message size of current Recv/Send can be obtained by (note: do not call it in another goroutine, otherwise you may get the size of some other call):</p><ul><li><code>ri.Stats().LastSendSize()</code></li><li><code>ri.Stats().LastRecvSize()</code></li></ul><p>You can find an example here: <a href=https://github.com/cloudwego/kitex-tests/blob/96b97d00bc099eba8bea181decb4d4f9e77df1cb/thrift_streaming/thrift_tracing_test.go#L77>kitex-tests: testTracer</a>.</p><h3 id=generic-not-implemented-yet>Generic (Not implemented yet)</h3><blockquote><p>Planned, no fixed schedule yet.</p></blockquote><h3 id=attention>Attention</h3><h4 id=sendrecv-are-actually-operating-on-the-local-buffer>Send/Recv are actually operating on the local buffer</h4><p>GRPC/HTTP2 is implemented with a &ldquo;local buffer&rdquo;, where Send/Recv operations are performed.
Therefore you should be aware of:</p><ol><li>&ldquo;Send returns nil&rdquo; only means the message is appended to the local buffer, which <strong>DOES NOT</strong> indicate the message is received by the opposite end;</li><li>The time consumed by Send/Recv operations differs significantly with the &ldquo;Latency&rdquo; of a Ping-Pong API:<ol><li>If the Recv call frequency at the opposite end is higher, then the local Send will usually return immediately (the buffer is always free).</li><li>If the Recv call frequency of the opposite end is lower, the local Send may be blocked for some time (waiting for the other end to consume and free up the buffer).</li><li>If there is message(s) available in the buffer, the Recv call will return immediately, otherwise you need to wait for the other end&rsquo;s Send.</li></ol></li></ol><h4 id=clientserver-middleware-unable-to-get-the-requestresponse>Client/Server Middleware unable to get the Request/Response</h4><p>It&rsquo;s BY DESIGN.
Although for Client Streaming/Server Streaming requests, it seems to have a Request/Response just like the PingPong API, the underlying implementation is completely different, and they cannot be read in Client/Server Middleware.
Please use Recv/Send Middleware to process messages on the stream.</p><h4 id=rpcfinish-client-for-serverbidirectional-api-should-call-recv-until-receiving-a-non-nil-error>RPCFinish: client for Server/Bidirectional API should call Recv until receiving a non-nil error</h4><ul><li>For Server/Bidirectional Streaming APIs: Kitex Client will not record the RPCFinish event until <code>Recv()</code> receives a non-nil error (<code>io.EOF</code> or other errors).<ul><li>If you wish to finish stream early, please remember to manually call <code>streaming.FinishStream(stream, err)</code> to propagate the RPCFinish event.</li></ul></li><li>For Client Streaming APIs: Kitex Client will record the RPCFinish event at the end of the <code>CloseAndRecv()</code> call.</li><li>StreamRecv/StreamSend events are emitted realtime which do not rely on RPCFinish events.</li></ul><h4 id=bizstatuserror-not-directly-visible-in-client-recvmiddleware>BizStatusError: not directly visible in Client RecvMiddleware</h4><p>Business exception (BizStatusError) is a custom business status code, which will not be considered an error internally by the framework and will be encapsulated inside rpcinfo.
Therefore, if there is a business exception, the error returned by next in Client RecvMiddleware will be nil.
The following code can be used to read the business exception:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>bizErr</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>rpcinfo</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetRPCInfo</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stream</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>()).</span><span style=color:#000>Invocation</span><span style=color:#000;font-weight:700>().</span><span style=color:#000>BizStatusErr</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><h2 id=streaming-over-ttheaderplanned>Streaming over TTHeader（Planned）</h2><blockquote><p>Expected to have much better performance than HTTP2</p></blockquote><h2 id=faq>FAQ</h2><h3 id=is-multi-service-supported-one-server-multi-services->Is Multi-Service supported (One server, multi services) ?</h3><p>Yes.
Please refer to the CloudWeGo documentation: <a href=/docs/kitex/tutorials/advanced-feature/multi_service/>Kitex - Single Server Multi Service</a>.</p><h3 id=is-streaming-over-http2-interoperable-with-other-grpc-implementations->Is &ldquo;Streaming over HTTP2&rdquo; interoperable with other grpc implementations ?</h3><p>No.
But if the grpc implementation has a generic interface, you can send thrift payload with a thrift encoder/decoder, which is equivalent.</p><p>Note: the &ldquo;content-type&rdquo; header sent by Kitex client is &ldquo;application/grpc+thrift&rdquo;.</p><h3 id=server-streaming-apihow-to-end-the-stream-prematurely-at-client-side>Server Streaming API：How to end the stream prematurely at client side?</h3><p>By injecting a cancel into the client request&rsquo;s ctx, the stream can be ended prematurely when needed:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>cancel</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithCancel</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>origCtx</span><span style=color:#000;font-weight:700>)</span> <span style=color:#8f5902;font-style:italic>// or WithTimeout/WithDeadline, as needed</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>cancel</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>st</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>streamClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>someServerStreamingAPI</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>req</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// your business code</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// normally you should call st.Recv() until it returns a non-nil error (e.g. io.EOF)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// end the receiving stream prematurely</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>someCondition</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>cancel</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#000>streaming</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FinishStream</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>st</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span> <span style=color:#8f5902;font-style:italic>// necessary for generating the RPCFinish event here</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Note:</p><ul><li>For Server Streaming API requests: before business code gets the stream returning by a client call, the sending stream is <a href=https://github.com/cloudwego/kitex-examples/blob/v0.3.1/thrift_streaming/kitex_gen/echo/testservice/testservice.go#L336>already closed in the generated code</a>; therefore, the client is unable to send new messages to the server and what it can do is to end the connection prematurely to inform the server</li><li>Since <code>st.Recv()</code> does not receive a non-nil error, <code>streaming.FinishStream(st, err)</code> should be called manually to generate the stream&rsquo;s <code>RPCFinish</code> event.</li><li>For Bidirectional Streaming APIs, this way is also applicable, but it&rsquo;s better to call the <code>st.Close()</code> manually or to send a previously negotiated message to the server. Don&rsquo;t forget to call <code>streaming.FinishStream</code> in either case.</li></ul><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes"><a href=https://github.com/cloudwego/cloudwego.github.io/issues/new>Please tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no"><a href=https://github.com/cloudwego/cloudwego.github.io/issues/new>Please tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector(".feedback--answer-yes"),noButton=document.querySelector(".feedback--answer-no"),yesResponse=document.querySelector(".feedback--response-yes"),noResponse=document.querySelector(".feedback--response-no"),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=e=>{if(typeof ga!="function")return;const t={command:"send",hitType:"event",category:"Helpful",action:"click",label:window.location.pathname,value:e};ga(t.command,t.hitType,t.category,t.action,t.label,t.value)};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(1)}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified
March 7, 2025
: <a href=https://github.com/cloudwego/cloudwego.github.io/commit/590388601ba4c26232b5ba3dcdef1bb571867ba4>doc: update plugin install guide (#1272) (5903886)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Lark aria-label=Lark><a class=text-white target=_blank rel=noopener href="https://applink.feishu.cn/client/chat/chatter/add_by_link?link_token=693v2544-2664-4421-b50f-7f1912p745r6" aria-label=Lark><img src=/webfonts/lark.svg alt style=width:26px;line-height:32.5px;margin-bottom:6px;fill:#fff></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/CloudWeGo aria-label=Twitter><img src=/webfonts/x-twitter.svg alt style=width:26px;line-height:32.5px;margin-bottom:6px;fill:#fff></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/cloudwego aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Discord aria-label=Discord><a class=text-white target=_blank rel=noopener href=https://discord.gg/jceZSE7DsW aria-label=Discord><i class="fab fa-discord"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2025 The CloudWeGo Authors</small><p class="mt-2 text-white"><a class=cloudwego-link href=/about/ target=_blank rel=noopener>About</a>
|
<a class=cloudwego-link href=https://github.com/cloudwego/cloudwego.github.io/blob/main/LICENSE target=_blank rel=noopener>License</a></p></div></div></div></footer></div><script src=/js/popper.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/main.min.9a8648b987db06195f5768f0d7516e8df7c27669e91e383e25c5d07cd6325605.js integrity="sha256-moZIuYfbBhlfV2jw11FujffCdmnpHjg+JcXQfNYyVgU=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/prism-custom.js></script><script src=/js/tabpane-persist.js></script><script src=/js/docsearch.js></script><script type=text/javascript>let siteLang=window.location.pathname.startsWith("/zh/")?"zh":"en";docsearch({appId:"V7I042F992",apiKey:"8380a7ac88106841cb43fb000fa2edb4",indexName:"cloudwego",container:"#docsearch",searchParameters:{hitsPerPage:5,facetFilters:[`lang:${siteLang}`]},transformItems(e){return e.map(e=>({...e,url:e.url.replace("www.cloudwego.io",location.host).replace("https:",location.protocol)}))}})</script><script src=/js/outbound-link.js></script><script src=/js/navScroll.js></script></body></html>