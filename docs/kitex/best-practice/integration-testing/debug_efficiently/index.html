<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.142.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Debug Efficiently | CloudWeGo</title>
<meta name=description content="A leading practice for building enterprise cloud native middleware!"><meta property="og:url" content="https://www.cloudwego.io/docs/kitex/best-practice/integration-testing/debug_efficiently/"><meta property="og:site_name" content="CloudWeGo"><meta property="og:title" content="Debug Efficiently"><meta property="og:description" content="Troubleshooting Panic Issues While not all panic issues are caused by concurrency, this discussion will focus on panic issues related to concurrency.
Let’s assume we have the following code. The Handle function returns the resp directly when the ctx times out. However, there is a potential concurrency issue in this function. Even after the Process function has obtained the Response variable, it is still possible for it to be modified later, resulting in a concurrency problem."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2024-02-18T00:00:00+00:00"><meta property="article:modified_time" content="2025-03-07T17:25:05+08:00"><meta itemprop=name content="Debug Efficiently"><meta itemprop=description content="Troubleshooting Panic Issues While not all panic issues are caused by concurrency, this discussion will focus on panic issues related to concurrency.
Let’s assume we have the following code. The Handle function returns the resp directly when the ctx times out. However, there is a potential concurrency issue in this function. Even after the Process function has obtained the Response variable, it is still possible for it to be modified later, resulting in a concurrency problem."><meta itemprop=datePublished content="2024-02-18T00:00:00+00:00"><meta itemprop=dateModified content="2025-03-07T17:25:05+08:00"><meta itemprop=wordCount content="3086"><meta name=twitter:card content="summary"><meta name=twitter:title content="Debug Efficiently"><meta name=twitter:description content="Troubleshooting Panic Issues While not all panic issues are caused by concurrency, this discussion will focus on panic issues related to concurrency.
Let’s assume we have the following code. The Handle function returns the resp directly when the ctx times out. However, there is a potential concurrency issue in this function. Even after the Process function has obtained the Response variable, it is still possible for it to be modified later, resulting in a concurrency problem."><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYWRQRLPRM"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QYWRQRLPRM")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?f1808c42af827f368aa7eca3baae6d55",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=preload href=/scss/main.min.b3c21c777309e05201dd625b8a4ece4076249bfa52b71d58c6e352d84c6c0320.css as=style><link href=/scss/main.min.b3c21c777309e05201dd625b8a4ece4076249bfa52b71d58c6e352d84c6c0320.css rel=stylesheet integrity><script src=/js/jquery.min.js></script><link rel=stylesheet href=/css/prism.css><link rel=stylesheet href=/css/docsearch.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYWRQRLPRM"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QYWRQRLPRM")}</script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand-xl navbar-dark td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><img src=/img/logo.png></span>
</a><button class=navbar-toggler type=button data-toggle=collapse data-target=#main_navbar aria-controls=main_navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0 ml-auto"><li class="dropdown sub-menu active"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>Documentation</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/docs/kitex/>Kitex</a>
<a class=dropdown-item href=/docs/hertz/>Hertz</a>
<a class=dropdown-item href=/docs/volo/>Volo</a>
<a class=dropdown-item href=/docs/netpoll/>Netpoll</a>
<a class=dropdown-item href=/docs/cwgo/>Cwgo</a>
<a class=dropdown-item href=/docs/eino/>Eino</a>
<a class=dropdown-item href=/docs/monolake/>Monolake</a></div></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/about/><span>About</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><span>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cooperation/><span>Cooperation</span></a></li><li class="dropdown sub-menu"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>Security</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/security/safety-bulletin/>safety-bulletin</a>
<a class=dropdown-item href=/security/vulnerability-reporting/>vulnerability-reporting</a></div></li><li class="nav-item dropdown mr-4"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/docs/kitex/best-practice/integration-testing/debug_efficiently/>中文</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><div id=docsearch></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div id=docsearch></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav foldable-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/docs/kitex/best-practice/integration-testing/debug_efficiently/>中文</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docskitex-li><input type=checkbox id=m-docskitex-check checked>
<label for=m-docskitex-check><a href=/docs/kitex/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitex><span>Kitex</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexoverview-li><input type=checkbox id=m-docskitexoverview-check checked>
<label for=m-docskitexoverview-check><a href=/docs/kitex/overview/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitexoverview><span>Overview</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitexgetting-started-li><input type=checkbox id=m-docskitexgetting-started-check checked>
<label for=m-docskitexgetting-started-check><a href=/docs/kitex/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitexgetting-started><span>Getting Started</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexgetting-startedpre-knowledge-li><input type=checkbox id=m-docskitexgetting-startedpre-knowledge-check>
<label for=m-docskitexgetting-startedpre-knowledge-check><a href=/docs/kitex/getting-started/pre-knowledge/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexgetting-startedpre-knowledge><span>Pre-knowledge</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexgetting-startedprerequisite-li><input type=checkbox id=m-docskitexgetting-startedprerequisite-check>
<label for=m-docskitexgetting-startedprerequisite-check><a href=/docs/kitex/getting-started/prerequisite/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexgetting-startedprerequisite><span>Environment Preparation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexgetting-startedquick_start-li><input type=checkbox id=m-docskitexgetting-startedquick_start-check>
<label for=m-docskitexgetting-startedquick_start-check><a href=/docs/kitex/getting-started/quick_start/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexgetting-startedquick_start><span>Basic Example</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexgetting-startedtutorial-li><input type=checkbox id=m-docskitexgetting-startedtutorial-check>
<label for=m-docskitexgetting-startedtutorial-check><a href=/docs/kitex/getting-started/tutorial/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexgetting-startedtutorial><span>Advanced Tutorial</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexgetting-startedexamples-li><input type=checkbox id=m-docskitexgetting-startedexamples-check>
<label for=m-docskitexgetting-startedexamples-check><a href=/docs/kitex/getting-started/examples/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexgetting-startedexamples><span>Code Examples</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorials-li><input type=checkbox id=m-docskitextutorials-check checked>
<label for=m-docskitextutorials-check><a href=/docs/kitex/tutorials/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorials><span>Tutorials</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsbasic-feature-li><input type=checkbox id=m-docskitextutorialsbasic-feature-check>
<label for=m-docskitextutorialsbasic-feature-check><a href=/docs/kitex/tutorials/basic-feature/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsbasic-feature><span>Basic Feature</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featuremessage_type-li><input type=checkbox id=m-docskitextutorialsbasic-featuremessage_type-check>
<label for=m-docskitextutorialsbasic-featuremessage_type-check><a href=/docs/kitex/tutorials/basic-feature/message_type/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featuremessage_type><span>Message Types</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsbasic-featurestreamx-li><input type=checkbox id=m-docskitextutorialsbasic-featurestreamx-check>
<label for=m-docskitextutorialsbasic-featurestreamx-check><a href=/docs/kitex/tutorials/basic-feature/streamx/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsbasic-featurestreamx><span>StreamX</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streambasicprogramming-li><input type=checkbox id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streambasicprogramming-check>
<label for=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streambasicprogramming-check><a href=/docs/kitex/tutorials/basic-feature/streamx/kitex+streamx+-+stream+basic+programming/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streambasicprogramming><span>StreamX Basic Programming</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streammiddleware-li><input type=checkbox id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streammiddleware-check>
<label for=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streammiddleware-check><a href=/docs/kitex/tutorials/basic-feature/streamx/kitex+streamx+-+stream+middleware/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streammiddleware><span>StreamX Middleware</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streammetainfo-li><input type=checkbox id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streammetainfo-check>
<label for=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streammetainfo-check><a href=/docs/kitex/tutorials/basic-feature/streamx/kitex+streamx+-+stream+metainfo/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streammetainfo><span>StreamX Metainfo</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streamerrorhandling-li><input type=checkbox id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streamerrorhandling-check>
<label for=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streamerrorhandling-check><a href=/docs/kitex/tutorials/basic-feature/streamx/kitex+streamx+-+stream+error+handling/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streamerrorhandling><span>StreamX Error Handling</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streamfaq-li><input type=checkbox id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streamfaq-check>
<label for=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streamfaq-check><a href=/docs/kitex/tutorials/basic-feature/streamx/kitex+streamx+-+stream+faq/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurestreamxkitexstreamx-streamfaq><span>StreamX FAQ</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsbasic-featureprotocol-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocol-check>
<label for=m-docskitextutorialsbasic-featureprotocol-check><a href=/docs/kitex/tutorials/basic-feature/protocol/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsbasic-featureprotocol><span>Protocol</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featureprotocoltransport_protocol-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocoltransport_protocol-check>
<label for=m-docskitextutorialsbasic-featureprotocoltransport_protocol-check><a href=/docs/kitex/tutorials/basic-feature/protocol/transport_protocol/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featureprotocoltransport_protocol><span>Transport Protocol</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsbasic-featureprotocolstreaming-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocolstreaming-check>
<label for=m-docskitextutorialsbasic-featureprotocolstreaming-check><a href=/docs/kitex/tutorials/basic-feature/protocol/streaming/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsbasic-featureprotocolstreaming><span>Streaming</span></a></label><ul class="ul-6 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsbasic-featureprotocolstreaminggrpc-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocolstreaminggrpc-check>
<label for=m-docskitextutorialsbasic-featureprotocolstreaminggrpc-check><a href=/docs/kitex/tutorials/basic-feature/protocol/streaming/grpc/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsbasic-featureprotocolstreaminggrpc><span>gRPC</span></a></label><ul class="ul-7 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featureprotocolstreaminggrpcthrift_streaming-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocolstreaminggrpcthrift_streaming-check>
<label for=m-docskitextutorialsbasic-featureprotocolstreaminggrpcthrift_streaming-check><a href=/docs/kitex/tutorials/basic-feature/protocol/streaming/grpc/thrift_streaming/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featureprotocolstreaminggrpcthrift_streaming><span>Thrift Streaming over gRPC</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featureprotocolstreaminggrpcgraceful_shutdown-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocolstreaminggrpcgraceful_shutdown-check>
<label for=m-docskitextutorialsbasic-featureprotocolstreaminggrpcgraceful_shutdown-check><a href=/docs/kitex/tutorials/basic-feature/protocol/streaming/grpc/graceful_shutdown/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featureprotocolstreaminggrpcgraceful_shutdown><span>gRPC Streaming Graceful Shutdown</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsbasic-featureprotocolserialization-protocol-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocolserialization-protocol-check>
<label for=m-docskitextutorialsbasic-featureprotocolserialization-protocol-check><a href=/docs/kitex/tutorials/basic-feature/protocol/serialization-protocol/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsbasic-featureprotocolserialization-protocol><span>Serialization Protocol</span></a></label><ul class="ul-6 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featureprotocolserialization-protocolbinary-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocolserialization-protocolbinary-check>
<label for=m-docskitextutorialsbasic-featureprotocolserialization-protocolbinary-check><a href=/docs/kitex/tutorials/basic-feature/protocol/serialization-protocol/binary/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featureprotocolserialization-protocolbinary><span>Binary</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featureprotocolserialization-protocolprotobuf-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocolserialization-protocolprotobuf-check>
<label for=m-docskitextutorialsbasic-featureprotocolserialization-protocolprotobuf-check><a href=/docs/kitex/tutorials/basic-feature/protocol/serialization-protocol/protobuf/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featureprotocolserialization-protocolprotobuf><span>Protobuf</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featureprotocolserialization-protocolhessian2-li><input type=checkbox id=m-docskitextutorialsbasic-featureprotocolserialization-protocolhessian2-check>
<label for=m-docskitextutorialsbasic-featureprotocolserialization-protocolhessian2-check><a href=/docs/kitex/tutorials/basic-feature/protocol/serialization-protocol/hessian2/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featureprotocolserialization-protocolhessian2><span>Hessian2</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurevisit_directly-li><input type=checkbox id=m-docskitextutorialsbasic-featurevisit_directly-check>
<label for=m-docskitextutorialsbasic-featurevisit_directly-check><a href=/docs/kitex/tutorials/basic-feature/visit_directly/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurevisit_directly><span>Visit Directly</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featureconnection_type-li><input type=checkbox id=m-docskitextutorialsbasic-featureconnection_type-check>
<label for=m-docskitextutorialsbasic-featureconnection_type-check><a href=/docs/kitex/tutorials/basic-feature/connection_type/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featureconnection_type><span>Connection Type</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurebizstatuserr-li><input type=checkbox id=m-docskitextutorialsbasic-featurebizstatuserr-check>
<label for=m-docskitextutorialsbasic-featurebizstatuserr-check><a href=/docs/kitex/tutorials/basic-feature/bizstatuserr/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurebizstatuserr><span>Business Exception</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurewarming_up-li><input type=checkbox id=m-docskitextutorialsbasic-featurewarming_up-check>
<label for=m-docskitextutorialsbasic-featurewarming_up-check><a href=/docs/kitex/tutorials/basic-feature/warming_up/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurewarming_up><span>Warming Up</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featurepanic-li><input type=checkbox id=m-docskitextutorialsbasic-featurepanic-check>
<label for=m-docskitextutorialsbasic-featurepanic-check><a href=/docs/kitex/tutorials/basic-feature/panic/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featurepanic><span>Deal with panic</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsbasic-featureacquire_rpcinfo-li><input type=checkbox id=m-docskitextutorialsbasic-featureacquire_rpcinfo-check>
<label for=m-docskitextutorialsbasic-featureacquire_rpcinfo-check><a href=/docs/kitex/tutorials/basic-feature/acquire_rpcinfo/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsbasic-featureacquire_rpcinfo><span>Acquire Kitex RPC Info</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsservice-governance-li><input type=checkbox id=m-docskitextutorialsservice-governance-check>
<label for=m-docskitextutorialsservice-governance-check><a href=/docs/kitex/tutorials/service-governance/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsservice-governance><span>Service Governance</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsservice-governanceloadbalance-li><input type=checkbox id=m-docskitextutorialsservice-governanceloadbalance-check>
<label for=m-docskitextutorialsservice-governanceloadbalance-check><a href=/docs/kitex/tutorials/service-governance/loadbalance/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsservice-governanceloadbalance><span>LoadBalancer</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsservice-governancetimeout-li><input type=checkbox id=m-docskitextutorialsservice-governancetimeout-check>
<label for=m-docskitextutorialsservice-governancetimeout-check><a href=/docs/kitex/tutorials/service-governance/timeout/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsservice-governancetimeout><span>Timeouts</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsservice-governanceretry-li><input type=checkbox id=m-docskitextutorialsservice-governanceretry-check>
<label for=m-docskitextutorialsservice-governanceretry-check><a href=/docs/kitex/tutorials/service-governance/retry/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsservice-governanceretry><span>Retry</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsservice-governancecircuitbreaker-li><input type=checkbox id=m-docskitextutorialsservice-governancecircuitbreaker-check>
<label for=m-docskitextutorialsservice-governancecircuitbreaker-check><a href=/docs/kitex/tutorials/service-governance/circuitbreaker/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsservice-governancecircuitbreaker><span>Circuit Breaker</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsservice-governancefallback-li><input type=checkbox id=m-docskitextutorialsservice-governancefallback-check>
<label for=m-docskitextutorialsservice-governancefallback-check><a href=/docs/kitex/tutorials/service-governance/fallback/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsservice-governancefallback><span>Fallback</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsservice-governancelimiting-li><input type=checkbox id=m-docskitextutorialsservice-governancelimiting-check>
<label for=m-docskitextutorialsservice-governancelimiting-check><a href=/docs/kitex/tutorials/service-governance/limiting/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsservice-governancelimiting><span>Rate Limiting</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsservice-governanceaccess_control-li><input type=checkbox id=m-docskitextutorialsservice-governanceaccess_control-check>
<label for=m-docskitextutorialsservice-governanceaccess_control-check><a href=/docs/kitex/tutorials/service-governance/access_control/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsservice-governanceaccess_control><span>Customized Access Control</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsobservability-li><input type=checkbox id=m-docskitextutorialsobservability-check>
<label for=m-docskitextutorialsobservability-check><a href=/docs/kitex/tutorials/observability/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsobservability><span>Observability</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsobservabilityinstrumentation-li><input type=checkbox id=m-docskitextutorialsobservabilityinstrumentation-check>
<label for=m-docskitextutorialsobservabilityinstrumentation-check><a href=/docs/kitex/tutorials/observability/instrumentation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsobservabilityinstrumentation><span>Instrumentation Control</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsobservabilitytracing-li><input type=checkbox id=m-docskitextutorialsobservabilitytracing-check>
<label for=m-docskitextutorialsobservabilitytracing-check><a href=/docs/kitex/tutorials/observability/tracing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsobservabilitytracing><span>Tracing</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsobservabilitylogging-li><input type=checkbox id=m-docskitextutorialsobservabilitylogging-check>
<label for=m-docskitextutorialsobservabilitylogging-check><a href=/docs/kitex/tutorials/observability/logging/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsobservabilitylogging><span>Logging</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsadvanced-feature-li><input type=checkbox id=m-docskitextutorialsadvanced-feature-check>
<label for=m-docskitextutorialsadvanced-feature-check><a href=/docs/kitex/tutorials/advanced-feature/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsadvanced-feature><span>Advanced Feature</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featurepayload_validator-li><input type=checkbox id=m-docskitextutorialsadvanced-featurepayload_validator-check>
<label for=m-docskitextutorialsadvanced-featurepayload_validator-check><a href=/docs/kitex/tutorials/advanced-feature/payload_validator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featurepayload_validator><span>Payload Validator</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsadvanced-featuregeneric-call-li><input type=checkbox id=m-docskitextutorialsadvanced-featuregeneric-call-check>
<label for=m-docskitextutorialsadvanced-featuregeneric-call-check><a href=/docs/kitex/tutorials/advanced-feature/generic-call/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsadvanced-featuregeneric-call><span>Generic Call</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuregeneric-callbasic_usage-li><input type=checkbox id=m-docskitextutorialsadvanced-featuregeneric-callbasic_usage-check>
<label for=m-docskitextutorialsadvanced-featuregeneric-callbasic_usage-check><a href=/docs/kitex/tutorials/advanced-feature/generic-call/basic_usage/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuregeneric-callbasic_usage><span>Basic Usage</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuregeneric-callthrift_idl_annotation_standards-li><input type=checkbox id=m-docskitextutorialsadvanced-featuregeneric-callthrift_idl_annotation_standards-check>
<label for=m-docskitextutorialsadvanced-featuregeneric-callthrift_idl_annotation_standards-check><a href=/docs/kitex/tutorials/advanced-feature/generic-call/thrift_idl_annotation_standards/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuregeneric-callthrift_idl_annotation_standards><span>IDL Definition Specification for Mapping between Thrift and HTTP</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuregeneric-callgeneric-call-dynamicgo-li><input type=checkbox id=m-docskitextutorialsadvanced-featuregeneric-callgeneric-call-dynamicgo-check>
<label for=m-docskitextutorialsadvanced-featuregeneric-callgeneric-call-dynamicgo-check><a href=/docs/kitex/tutorials/advanced-feature/generic-call/generic-call-dynamicgo/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuregeneric-callgeneric-call-dynamicgo><span>User guide to generic call with dynamicgo</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuregeneric-callgeneric-call-reflection-li><input type=checkbox id=m-docskitextutorialsadvanced-featuregeneric-callgeneric-call-reflection-check>
<label for=m-docskitextutorialsadvanced-featuregeneric-callgeneric-call-reflection-check><a href=/docs/kitex/tutorials/advanced-feature/generic-call/generic-call-reflection/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuregeneric-callgeneric-call-reflection><span>Use Thrift reflection to improve generic-call performance</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuregeneric-callgeneric_streaming-li><input type=checkbox id=m-docskitextutorialsadvanced-featuregeneric-callgeneric_streaming-check>
<label for=m-docskitextutorialsadvanced-featuregeneric-callgeneric_streaming-check><a href=/docs/kitex/tutorials/advanced-feature/generic-call/generic_streaming/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuregeneric-callgeneric_streaming><span>User Guide to Generic Call for Streaming</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuremetainfo-li><input type=checkbox id=m-docskitextutorialsadvanced-featuremetainfo-check>
<label for=m-docskitextutorialsadvanced-featuremetainfo-check><a href=/docs/kitex/tutorials/advanced-feature/metainfo/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuremetainfo><span>Metainfo</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featureinvoker-li><input type=checkbox id=m-docskitextutorialsadvanced-featureinvoker-check>
<label for=m-docskitextutorialsadvanced-featureinvoker-check><a href=/docs/kitex/tutorials/advanced-feature/invoker/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featureinvoker><span>Server SDK Mode</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featureerror_handler-li><input type=checkbox id=m-docskitextutorialsadvanced-featureerror_handler-check>
<label for=m-docskitextutorialsadvanced-featureerror_handler-check><a href=/docs/kitex/tutorials/advanced-feature/error_handler/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featureerror_handler><span>Customize Error Handler</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featurestart_shutdown_hook-li><input type=checkbox id=m-docskitextutorialsadvanced-featurestart_shutdown_hook-check>
<label for=m-docskitextutorialsadvanced-featurestart_shutdown_hook-check><a href=/docs/kitex/tutorials/advanced-feature/start_shutdown_hook/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featurestart_shutdown_hook><span>Customize Hook for Start/Shutdown of Server-side</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuregrpcproxy-li><input type=checkbox id=m-docskitextutorialsadvanced-featuregrpcproxy-check>
<label for=m-docskitextutorialsadvanced-featuregrpcproxy-check><a href=/docs/kitex/tutorials/advanced-feature/grpcproxy/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuregrpcproxy><span>gRPC Proxy</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featurecodec_frugal-li><input type=checkbox id=m-docskitextutorialsadvanced-featurecodec_frugal-check>
<label for=m-docskitextutorialsadvanced-featurecodec_frugal-check><a href=/docs/kitex/tutorials/advanced-feature/codec_frugal/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featurecodec_frugal><span>Frugal</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featurexds-li><input type=checkbox id=m-docskitextutorialsadvanced-featurexds-check>
<label for=m-docskitextutorialsadvanced-featurexds-check><a href=/docs/kitex/tutorials/advanced-feature/xds/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featurexds><span>xDS Support</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featurefieldmask-li><input type=checkbox id=m-docskitextutorialsadvanced-featurefieldmask-check>
<label for=m-docskitextutorialsadvanced-featurefieldmask-check><a href=/docs/kitex/tutorials/advanced-feature/fieldmask/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featurefieldmask><span>Serialize Data Ondemands</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featureprofiler-li><input type=checkbox id=m-docskitextutorialsadvanced-featureprofiler-check>
<label for=m-docskitextutorialsadvanced-featureprofiler-check><a href=/docs/kitex/tutorials/advanced-feature/profiler/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featureprofiler><span>Request Profiler</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsadvanced-featuremulti_service-li><input type=checkbox id=m-docskitextutorialsadvanced-featuremulti_service-check>
<label for=m-docskitextutorialsadvanced-featuremulti_service-check><a href=/docs/kitex/tutorials/advanced-feature/multi_service/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsadvanced-featuremulti_service><span>Multiple Services</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuremulti_servicemulti_service-li><input type=checkbox id=m-docskitextutorialsadvanced-featuremulti_servicemulti_service-check>
<label for=m-docskitextutorialsadvanced-featuremulti_servicemulti_service-check><a href=/docs/kitex/tutorials/advanced-feature/multi_service/multi_service/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuremulti_servicemulti_service><span>Multiple Services</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuremulti_servicemulti_handler-li><input type=checkbox id=m-docskitextutorialsadvanced-featuremulti_servicemulti_handler-check>
<label for=m-docskitextutorialsadvanced-featuremulti_servicemulti_handler-check><a href=/docs/kitex/tutorials/advanced-feature/multi_service/multi_handler/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuremulti_servicemulti_handler><span>Generating Multiple Handlers for Multiple Services</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsadvanced-featuregls-li><input type=checkbox id=m-docskitextutorialsadvanced-featuregls-check>
<label for=m-docskitextutorialsadvanced-featuregls-check><a href=/docs/kitex/tutorials/advanced-feature/gls/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsadvanced-featuregls><span>GLS Feature Usage</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialscode-gen-li><input type=checkbox id=m-docskitextutorialscode-gen-check>
<label for=m-docskitextutorialscode-gen-check><a href=/docs/kitex/tutorials/code-gen/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialscode-gen><span>Code Generation</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-gencode_generation-li><input type=checkbox id=m-docskitextutorialscode-gencode_generation-check>
<label for=m-docskitextutorialscode-gencode_generation-check><a href=/docs/kitex/tutorials/code-gen/code_generation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-gencode_generation><span>Code Generation Tool</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-gencombine_service-li><input type=checkbox id=m-docskitextutorialscode-gencombine_service-check>
<label for=m-docskitextutorialscode-gencombine_service-check><a href=/docs/kitex/tutorials/code-gen/combine_service/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-gencombine_service><span>Combine Service [DEPRECATED]</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-genvalidator-li><input type=checkbox id=m-docskitextutorialscode-genvalidator-check>
<label for=m-docskitextutorialscode-genvalidator-check><a href=/docs/kitex/tutorials/code-gen/validator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-genvalidator><span>Thrift Validator</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-genfastpb-li><input type=checkbox id=m-docskitextutorialscode-genfastpb-check>
<label for=m-docskitextutorialscode-genfastpb-check><a href=/docs/kitex/tutorials/code-gen/fastpb/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-genfastpb><span>Fastpb</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-gentemplate_extension-li><input type=checkbox id=m-docskitextutorialscode-gentemplate_extension-check>
<label for=m-docskitextutorialscode-gentemplate_extension-check><a href=/docs/kitex/tutorials/code-gen/template_extension/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-gentemplate_extension><span>Extend the Templates of Service Generated Code</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-genstruct_reference_generator-li><input type=checkbox id=m-docskitextutorialscode-genstruct_reference_generator-check>
<label for=m-docskitextutorialscode-genstruct_reference_generator-check><a href=/docs/kitex/tutorials/code-gen/struct_reference_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-genstruct_reference_generator><span>Generate Structs Reference</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-gencustom_tpl-li><input type=checkbox id=m-docskitextutorialscode-gencustom_tpl-check>
<label for=m-docskitextutorialscode-gencustom_tpl-check><a href=/docs/kitex/tutorials/code-gen/custom_tpl/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-gencustom_tpl><span>Custom Scaffold Template</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-genidl_trimmer-li><input type=checkbox id=m-docskitextutorialscode-genidl_trimmer-check>
<label for=m-docskitextutorialscode-genidl_trimmer-check><a href=/docs/kitex/tutorials/code-gen/idl_trimmer/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-genidl_trimmer><span>Thriftgo IDL Trimmer</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-genprotoc_validator-li><input type=checkbox id=m-docskitextutorialscode-genprotoc_validator-check>
<label for=m-docskitextutorialscode-genprotoc_validator-check><a href=/docs/kitex/tutorials/code-gen/protoc_validator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-genprotoc_validator><span>Protoc Validator</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-gencustom_struct_tags-li><input type=checkbox id=m-docskitextutorialscode-gencustom_struct_tags-check>
<label for=m-docskitextutorialscode-gencustom_struct_tags-check><a href=/docs/kitex/tutorials/code-gen/custom_struct_tags/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-gencustom_struct_tags><span>Custom Struct Tags</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialscode-genskip_decoder-li><input type=checkbox id=m-docskitextutorialscode-genskip_decoder-check>
<label for=m-docskitextutorialscode-genskip_decoder-check><a href=/docs/kitex/tutorials/code-gen/skip_decoder/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialscode-genskip_decoder><span>SkipDecoder</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsframework-exten-li><input type=checkbox id=m-docskitextutorialsframework-exten-check>
<label for=m-docskitextutorialsframework-exten-check><a href=/docs/kitex/tutorials/framework-exten/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsframework-exten><span>Framework Extension</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extenmiddleware-li><input type=checkbox id=m-docskitextutorialsframework-extenmiddleware-check>
<label for=m-docskitextutorialsframework-extenmiddleware-check><a href=/docs/kitex/tutorials/framework-exten/middleware/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extenmiddleware><span>Middleware Extensions</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extensuite-li><input type=checkbox id=m-docskitextutorialsframework-extensuite-check>
<label for=m-docskitextutorialsframework-extensuite-check><a href=/docs/kitex/tutorials/framework-exten/suite/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extensuite><span>Suite Extensions</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extenregistry-li><input type=checkbox id=m-docskitextutorialsframework-extenregistry-check>
<label for=m-docskitextutorialsframework-extenregistry-check><a href=/docs/kitex/tutorials/framework-exten/registry/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extenregistry><span>Extension of Service Registry</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extenservice_discovery-li><input type=checkbox id=m-docskitextutorialsframework-extenservice_discovery-check>
<label for=m-docskitextutorialsframework-extenservice_discovery-check><a href=/docs/kitex/tutorials/framework-exten/service_discovery/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extenservice_discovery><span>Service Discovery Extension</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extenloadbalance-li><input type=checkbox id=m-docskitextutorialsframework-extenloadbalance-check>
<label for=m-docskitextutorialsframework-extenloadbalance-check><a href=/docs/kitex/tutorials/framework-exten/loadbalance/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extenloadbalance><span>Customize LoadBalancer</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extenmonitoring-li><input type=checkbox id=m-docskitextutorialsframework-extenmonitoring-check>
<label for=m-docskitextutorialsframework-extenmonitoring-check><a href=/docs/kitex/tutorials/framework-exten/monitoring/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extenmonitoring><span>Monitoring Extension</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extencodec-li><input type=checkbox id=m-docskitextutorialsframework-extencodec-check>
<label for=m-docskitextutorialsframework-extencodec-check><a href=/docs/kitex/tutorials/framework-exten/codec/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extencodec><span>Extension of Codec</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extentransport-li><input type=checkbox id=m-docskitextutorialsframework-extentransport-check>
<label for=m-docskitextutorialsframework-extentransport-check><a href=/docs/kitex/tutorials/framework-exten/transport/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extentransport><span>Extension of Transport Module</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extentrans_pipeline-li><input type=checkbox id=m-docskitextutorialsframework-extentrans_pipeline-check>
<label for=m-docskitextutorialsframework-extentrans_pipeline-check><a href=/docs/kitex/tutorials/framework-exten/trans_pipeline/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extentrans_pipeline><span>Extension of Transport Pipeline-Bound</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extentransmeta-li><input type=checkbox id=m-docskitextutorialsframework-extentransmeta-check>
<label for=m-docskitextutorialsframework-extentransmeta-check><a href=/docs/kitex/tutorials/framework-exten/transmeta/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extentransmeta><span>Extension of Metadata Transparent Transmission</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extendiagnosis-li><input type=checkbox id=m-docskitextutorialsframework-extendiagnosis-check>
<label for=m-docskitextutorialsframework-extendiagnosis-check><a href=/docs/kitex/tutorials/framework-exten/diagnosis/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extendiagnosis><span>Extension of Diagnosis</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsframework-extenimplemented_extension-li><input type=checkbox id=m-docskitextutorialsframework-extenimplemented_extension-check>
<label for=m-docskitextutorialsframework-extenimplemented_extension-check><a href=/docs/kitex/tutorials/framework-exten/implemented_extension/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsframework-extenimplemented_extension><span>Implemented Extension</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsoptions-li><input type=checkbox id=m-docskitextutorialsoptions-check>
<label for=m-docskitextutorialsoptions-check><a href=/docs/kitex/tutorials/options/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsoptions><span>Option</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsoptionsclient_options-li><input type=checkbox id=m-docskitextutorialsoptionsclient_options-check>
<label for=m-docskitextutorialsoptionsclient_options-check><a href=/docs/kitex/tutorials/options/client_options/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsoptionsclient_options><span>Client Option</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsoptionsserver_options-li><input type=checkbox id=m-docskitextutorialsoptionsserver_options-check>
<label for=m-docskitextutorialsoptionsserver_options-check><a href=/docs/kitex/tutorials/options/server_options/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsoptionsserver_options><span>Server Option</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsoptionscall_options-li><input type=checkbox id=m-docskitextutorialsoptionscall_options-check>
<label for=m-docskitextutorialsoptionscall_options-check><a href=/docs/kitex/tutorials/options/call_options/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsoptionscall_options><span>Call Option</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsthird-party-li><input type=checkbox id=m-docskitextutorialsthird-party-check>
<label for=m-docskitextutorialsthird-party-check><a href=/docs/kitex/tutorials/third-party/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsthird-party><span>Third-Party</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsthird-partyservice_discovery-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discovery-check>
<label for=m-docskitextutorialsthird-partyservice_discovery-check><a href=/docs/kitex/tutorials/third-party/service_discovery/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsthird-partyservice_discovery><span>Service Discovery</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoveryetcd-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoveryetcd-check>
<label for=m-docskitextutorialsthird-partyservice_discoveryetcd-check><a href=/docs/kitex/tutorials/third-party/service_discovery/etcd/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoveryetcd><span>Etcd</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoveryconsul-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoveryconsul-check>
<label for=m-docskitextutorialsthird-partyservice_discoveryconsul-check><a href=/docs/kitex/tutorials/third-party/service_discovery/consul/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoveryconsul><span>Consul</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoveryeureka-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoveryeureka-check>
<label for=m-docskitextutorialsthird-partyservice_discoveryeureka-check><a href=/docs/kitex/tutorials/third-party/service_discovery/eureka/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoveryeureka><span>Eureka</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoverynacos-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoverynacos-check>
<label for=m-docskitextutorialsthird-partyservice_discoverynacos-check><a href=/docs/kitex/tutorials/third-party/service_discovery/nacos/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoverynacos><span>Nacos</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoverypolaris-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoverypolaris-check>
<label for=m-docskitextutorialsthird-partyservice_discoverypolaris-check><a href=/docs/kitex/tutorials/third-party/service_discovery/polaris/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoverypolaris><span>Polaris</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoveryservice-comb-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoveryservice-comb-check>
<label for=m-docskitextutorialsthird-partyservice_discoveryservice-comb-check><a href=/docs/kitex/tutorials/third-party/service_discovery/service-comb/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoveryservice-comb><span>ServiceComb</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoveryzookeeper-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoveryzookeeper-check>
<label for=m-docskitextutorialsthird-partyservice_discoveryzookeeper-check><a href=/docs/kitex/tutorials/third-party/service_discovery/zookeeper/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoveryzookeeper><span>Zookeeper</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoverydns-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoverydns-check>
<label for=m-docskitextutorialsthird-partyservice_discoverydns-check><a href=/docs/kitex/tutorials/third-party/service_discovery/dns/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoverydns><span>DNS</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyservice_discoveryrule-based-li><input type=checkbox id=m-docskitextutorialsthird-partyservice_discoveryrule-based-check>
<label for=m-docskitextutorialsthird-partyservice_discoveryrule-based-check><a href=/docs/kitex/tutorials/third-party/service_discovery/rule-based/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyservice_discoveryrule-based><span>Service Filtering</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialsthird-partyconfig-center-li><input type=checkbox id=m-docskitextutorialsthird-partyconfig-center-check>
<label for=m-docskitextutorialsthird-partyconfig-center-check><a href=/docs/kitex/tutorials/third-party/config-center/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialsthird-partyconfig-center><span>ConfigCenter</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyconfig-centeretcd-li><input type=checkbox id=m-docskitextutorialsthird-partyconfig-centeretcd-check>
<label for=m-docskitextutorialsthird-partyconfig-centeretcd-check><a href=/docs/kitex/tutorials/third-party/config-center/etcd/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyconfig-centeretcd><span>Etcd</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyconfig-centerapollo-li><input type=checkbox id=m-docskitextutorialsthird-partyconfig-centerapollo-check>
<label for=m-docskitextutorialsthird-partyconfig-centerapollo-check><a href=/docs/kitex/tutorials/third-party/config-center/apollo/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyconfig-centerapollo><span>Apollo</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyconfig-centernacos-li><input type=checkbox id=m-docskitextutorialsthird-partyconfig-centernacos-check>
<label for=m-docskitextutorialsthird-partyconfig-centernacos-check><a href=/docs/kitex/tutorials/third-party/config-center/nacos/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyconfig-centernacos><span>Nacos</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyconfig-centerfile-li><input type=checkbox id=m-docskitextutorialsthird-partyconfig-centerfile-check>
<label for=m-docskitextutorialsthird-partyconfig-centerfile-check><a href=/docs/kitex/tutorials/third-party/config-center/file/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyconfig-centerfile><span>File</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyconfig-centerzookeeper-li><input type=checkbox id=m-docskitextutorialsthird-partyconfig-centerzookeeper-check>
<label for=m-docskitextutorialsthird-partyconfig-centerzookeeper-check><a href=/docs/kitex/tutorials/third-party/config-center/zookeeper/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyconfig-centerzookeeper><span>Zookeeper</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyconfig-centerconsul-li><input type=checkbox id=m-docskitextutorialsthird-partyconfig-centerconsul-check>
<label for=m-docskitextutorialsthird-partyconfig-centerconsul-check><a href=/docs/kitex/tutorials/third-party/config-center/consul/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyconfig-centerconsul><span>Consul</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialsthird-partyobservability-li><input type=checkbox id=m-docskitextutorialsthird-partyobservability-check>
<label for=m-docskitextutorialsthird-partyobservability-check><a href=/docs/kitex/tutorials/third-party/observability/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialsthird-partyobservability><span>Observability</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitextutorialstool-li><input type=checkbox id=m-docskitextutorialstool-check>
<label for=m-docskitextutorialstool-check><a href=/docs/kitex/tutorials/tool/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitextutorialstool><span>Tool</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitextutorialstoolkitexcall-li><input type=checkbox id=m-docskitextutorialstoolkitexcall-check>
<label for=m-docskitextutorialstoolkitexcall-check><a href=/docs/kitex/tutorials/tool/kitexcall/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitextutorialstoolkitexcall><span>kitexcall: the CLI tool for sending RPC call in JSON format</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitexreference-li><input type=checkbox id=m-docskitexreference-check checked>
<label for=m-docskitexreference-check><a href=/docs/kitex/reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitexreference><span>Reference</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexreferencetransport_protocol_ttheader-li><input type=checkbox id=m-docskitexreferencetransport_protocol_ttheader-check>
<label for=m-docskitexreferencetransport_protocol_ttheader-check><a href=/docs/kitex/reference/transport_protocol_ttheader/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexreferencetransport_protocol_ttheader><span>TTHeader</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexreferenceexception-li><input type=checkbox id=m-docskitexreferenceexception-check>
<label for=m-docskitexreferenceexception-check><a href=/docs/kitex/reference/exception/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexreferenceexception><span>Exception Instruction</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexreferenceversion-li><input type=checkbox id=m-docskitexreferenceversion-check>
<label for=m-docskitexreferenceversion-check><a href=/docs/kitex/reference/version/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexreferenceversion><span>Version Specification</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docskitexbest-practice-li><input type=checkbox id=m-docskitexbest-practice-check checked>
<label for=m-docskitexbest-practice-check><a href=/docs/kitex/best-practice/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitexbest-practice><span>Best Practice</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practiceusage_attention-li><input type=checkbox id=m-docskitexbest-practiceusage_attention-check>
<label for=m-docskitexbest-practiceusage_attention-check><a href=/docs/kitex/best-practice/usage_attention/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practiceusage_attention><span>Usage Attention</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practicegraceful_shutdown-li><input type=checkbox id=m-docskitexbest-practicegraceful_shutdown-check>
<label for=m-docskitexbest-practicegraceful_shutdown-check><a href=/docs/kitex/best-practice/graceful_shutdown/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practicegraceful_shutdown><span>Graceful Shutdown</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practiceerror_handle-li><input type=checkbox id=m-docskitexbest-practiceerror_handle-check>
<label for=m-docskitexbest-practiceerror_handle-check><a href=/docs/kitex/best-practice/error_handle/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practiceerror_handle><span>Error Handle</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practiceremove_apache_codec-li><input type=checkbox id=m-docskitexbest-practiceremove_apache_codec-check>
<label for=m-docskitexbest-practiceremove_apache_codec-check><a href=/docs/kitex/best-practice/remove_apache_codec/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practiceremove_apache_codec><span>Kitex Remove Apache Thrift User Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docskitexbest-practiceintegration-testing-li><input type=checkbox id=m-docskitexbest-practiceintegration-testing-check checked>
<label for=m-docskitexbest-practiceintegration-testing-check><a href=/docs/kitex/best-practice/integration-testing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitexbest-practiceintegration-testing><span>Integration Testing</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practiceintegration-testingmock_client-li><input type=checkbox id=m-docskitexbest-practiceintegration-testingmock_client-check>
<label for=m-docskitexbest-practiceintegration-testingmock_client-check><a href=/docs/kitex/best-practice/integration-testing/mock_client/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practiceintegration-testingmock_client><span>How To Mock A Kitex Client</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docskitexbest-practiceintegration-testingdebug_efficiently-li><input type=checkbox id=m-docskitexbest-practiceintegration-testingdebug_efficiently-check checked>
<label for=m-docskitexbest-practiceintegration-testingdebug_efficiently-check><a href=/docs/kitex/best-practice/integration-testing/debug_efficiently/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practiceintegration-testingdebug_efficiently><span class=td-sidebar-nav-active-item>Debug Efficiently</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskitexbest-practiceself_check-li><input type=checkbox id=m-docskitexbest-practiceself_check-check>
<label for=m-docskitexbest-practiceself_check-check><a href=/docs/kitex/best-practice/self_check/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitexbest-practiceself_check><span>Self Troubleshooting Guide</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practiceself_checkpanic_self_check-li><input type=checkbox id=m-docskitexbest-practiceself_checkpanic_self_check-check>
<label for=m-docskitexbest-practiceself_checkpanic_self_check-check><a href=/docs/kitex/best-practice/self_check/panic_self_check/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practiceself_checkpanic_self_check><span>Panic Self-check Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practiceself_checkmem_leak_self_check-li><input type=checkbox id=m-docskitexbest-practiceself_checkmem_leak_self_check-check>
<label for=m-docskitexbest-practiceself_checkmem_leak_self_check-check><a href=/docs/kitex/best-practice/self_check/mem_leak_self_check/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practiceself_checkmem_leak_self_check><span>Memory Leak Self-Check Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexbest-practiceself_checkfast_write_read_panic-li><input type=checkbox id=m-docskitexbest-practiceself_checkfast_write_read_panic-check>
<label for=m-docskitexbest-practiceself_checkfast_write_read_panic-check><a href=/docs/kitex/best-practice/self_check/fast_write_read_panic/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docskitexbest-practiceself_checkfast_write_read_panic><span>FastWrite/FastRead Panic Error</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskitexfaq-li><input type=checkbox id=m-docskitexfaq-check checked>
<label for=m-docskitexfaq-check><a href=/docs/kitex/faq/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docskitexfaq><span>FAQ</span></a></label></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/cloudwego/cloudwego.github.io/edit/main/content/en//docs/kitex/best-practice/integration-testing/debug_efficiently target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/new/main/content/en//docs/kitex/best-practice/integration-testing/debug_efficiently?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/issues/new?labels=bug&amp;template=DOCS_UPDATE.md&amp;title=Debug%20Efficiently" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/cloudwego/kitex/issues/new/choose target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#troubleshooting-panic-issues>Troubleshooting Panic Issues</a><ul><li><a href=#troubleshooting-with-the-stack-trace>Troubleshooting with the Stack Trace</a></li><li><a href=#tracing-through-race-conditions>Tracing through Race Conditions</a></li></ul></li><li><a href=#troubleshooting-crash-issues>Troubleshooting Crash Issues</a><ul><li><a href=#obtaining-a-coredump-file>Obtaining a Coredump File</a></li><li><a href=#analyzing-with-delve>Analyzing with Delve</a></li></ul></li><li><a href=#investigating-memory-leak-issues>Investigating Memory Leak Issues</a><ul><li><a href=#identifying-leaked-objects>Identifying Leaked Objects</a></li><li><a href=#tracing-the-source-of-the-leak>Tracing the Source of the Leak</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://www.cloudwego.io/docs/>Documentation</a></li><li class=breadcrumb-item><a href=https://www.cloudwego.io/docs/kitex/>Kitex</a></li><li class=breadcrumb-item><a href=https://www.cloudwego.io/docs/kitex/best-practice/>Best Practice</a></li><li class=breadcrumb-item><a href=https://www.cloudwego.io/docs/kitex/best-practice/integration-testing/>Integration Testing</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://www.cloudwego.io/docs/kitex/best-practice/integration-testing/debug_efficiently/>Debug Efficiently</a></li></ol></nav><div class=td-content><h1>Debug Efficiently</h1><header class=article-meta></header><h2 id=troubleshooting-panic-issues>Troubleshooting Panic Issues</h2><p>While not all panic issues are caused by concurrency, this discussion will focus on panic issues related to concurrency.</p><p>Let&rsquo;s assume we have the following code. The <code>Handle</code> function returns the <code>resp</code> directly when the <code>ctx</code> times out. However, there is a potential concurrency issue in this function. Even after the <code>Process</code> function has obtained the <code>Response</code> variable, it is still possible for it to be modified later, resulting in a concurrency problem.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>Handle</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Response</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>done</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>struct</span><span style=color:#000;font-weight:700>{})</span>
</span></span><span style=display:flex><span>   <span style=color:#000>resp</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>Response</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>Data</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87>byte</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;12345&#34;</span><span style=color:#000;font-weight:700>)}</span> <span style=color:#8f5902;font-style:italic>// default value</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Gosched</span><span style=color:#000;font-weight:700>()</span> <span style=color:#8f5902;font-style:italic>// mock network calls</span>
</span></span><span style=display:flex><span>      <span style=color:#000>resp</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Data</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>nil</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>done</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>select</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>case</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Done</span><span style=color:#000;font-weight:700>():</span> <span style=color:#8f5902;font-style:italic>// canceled</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>case</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>done</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>resp</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>Process</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>resp</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>Handle</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#000>size</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>resp</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Data</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>size</span> <span style=color:#000;font-weight:700>&gt;</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Gosched</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>resp</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Data</span><span style=color:#000;font-weight:700>[:</span><span style=color:#000>size</span><span style=color:#000;font-weight:700>])</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=troubleshooting-with-the-stack-trace>Troubleshooting with the Stack Trace</h3><p>The stack trace for the code above, when encountering a concurrency conflict, is as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>panic</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>runtime</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>slice</span> <span style=color:#000>bounds</span> <span style=color:#000>out</span> <span style=color:#000>of</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000;font-weight:700>[:</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>with</span> <span style=color:#000>capacity</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>recovered</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>        <span style=color:#000>panic</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>runtime</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>slice</span> <span style=color:#000>bounds</span> <span style=color:#000>out</span> <span style=color:#000>of</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000;font-weight:700>[:</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>with</span> <span style=color:#000>capacity</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>goroutine</span> <span style=color:#0000cf;font-weight:700>6</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>running</span><span style=color:#000;font-weight:700>]:</span>
</span></span><span style=display:flex><span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>func1</span><span style=color:#0000cf;font-weight:700>.2</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0x113c6c0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0xc00008c000</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1144</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x332</span>
</span></span><span style=display:flex><span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>func1</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0xc000001380</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1147</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x4b6</span>
</span></span><span style=display:flex><span><span style=color:#204a87>panic</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0x113c6c0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0xc00008c000</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>965</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x1b9</span>
</span></span><span style=display:flex><span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>example</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Process</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0x1178d68</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0xc000022480</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Users</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>bytedance</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic_test</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>36</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0xf8</span>
</span></span><span style=display:flex><span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>example</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>TestPanic</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0xc000001380</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Users</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>bytedance</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic_test</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>44</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x85</span>
</span></span><span style=display:flex><span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tRunner</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0xc000001380</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0x11557f8</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1194</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0xef</span>
</span></span><span style=display:flex><span><span style=color:#000>created</span> <span style=color:#000>by</span> <span style=color:#000>testing</span><span style=color:#000;font-weight:700>.(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>T</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>Run</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1239</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x2b3</span>
</span></span></code></pre></div><ol><li><p>Identifying the Panic Cause</p><p>First, we need to determine the actual cause of the panic. You can find it at the topmost line of the complete panic stack, which in this case is <strong><code>panic: runtime error: slice bounds out of range [:5] with capacity 0 [recovered]</code></strong>.</p></li><li><p>Locating the Original Panic Location</p><p>Second, we need to find the code line where the panic is triggered. Any panic stack will include at least one log entry from <code>runtime/panic.go</code>, and the next entry after that will indicate the actual line of code that triggered the panic. In this case, it is <strong><code>example/panic_test.go:36</code></strong>.</p><p>However, sometimes a user&rsquo;s panic is wrapped by a higher-level recover function, like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>WrapPanic</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>defer</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>recover</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87>panic</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Process</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>In this case, the panic will appear as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>panic</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>runtime</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>slice</span> <span style=color:#000>bounds</span> <span style=color:#000>out</span> <span style=color:#000>of</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000;font-weight:700>[:</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>with</span> <span style=color:#000>capacity</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>recovered</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>        <span style=color:#000>panic</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>runtime</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>slice</span> <span style=color:#000>bounds</span> <span style=color:#000>out</span> <span style=color:#000>of</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000;font-weight:700>[:</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>with</span> <span style=color:#000>capacity</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>recovered</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>        <span style=color:#000>panic</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>runtime</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>slice</span> <span style=color:#000>bounds</span> <span style=color:#000>out</span> <span style=color:#000>of</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000;font-weight:700>[:</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>with</span> <span style=color:#000>capacity</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>goroutine</span> <span style=color:#0000cf;font-weight:700>18</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>running</span><span style=color:#000;font-weight:700>]:</span>
</span></span><span style=display:flex><span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>func1</span><span style=color:#0000cf;font-weight:700>.2</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0x113c7c0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0xc00011c000</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1144</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x332</span>
</span></span><span style=display:flex><span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>func1</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0xc000082600</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1147</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x4b6</span>
</span></span><span style=display:flex><span><span style=color:#204a87>panic</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0x113c7c0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0xc00011c000</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>965</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x1b9</span>
</span></span><span style=display:flex><span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>example</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WrapPanic</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>func1</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Users</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>bytedance</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic_test</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>47</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x55</span>
</span></span><span style=display:flex><span><span style=color:#204a87>panic</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0x113c7c0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0xc00011c1</span><span style=color:#000;font-weight:700>.</span> <span style=color:#000>The</span> <span style=color:#000>panic</span> <span style=color:#000>cause</span> <span style=color:#000>is</span> <span style=color:#000>a</span> <span style=color:#4e9a06>&#34;slice bounds out of range&#34;</span> <span style=color:#204a87;font-weight:700>error</span> <span style=color:#000>with</span> <span style=color:#000>a</span> <span style=color:#000>capacity</span> <span style=color:#000>of</span> <span style=color:#0000cf;font-weight:700>0.</span>
</span></span></code></pre></div></li></ol><p>​ The order of the panic stack trace goes from top to bottom, with the outermost function calls at the bottom. We need to find the first place where panic() is called, so we need to look for the bottommost section of runtime/panic.go, and the line below it indicates the actual code line where the panic is triggered.</p><h3 id=tracing-through-race-conditions>Tracing through Race Conditions</h3><p>Continuing with the example code, in cases where the codebase is extensive, especially when involving third-party libraries, it becomes challenging to visually determine which asynchronous logic is modifying a variable. In such situations, we need to rely on tools to identify the root cause for us.</p><h4 id=debugging-with-unit-tests>Debugging with Unit Tests</h4><p>For scenarios where the modification logic is contained within the same function, we can write a simple unit test to uncover the issue:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>TestPanic</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>t</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>T</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>ctx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>cancelFn</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithTimeout</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Background</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Millisecond</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#000>cancelFn</span><span style=color:#000;font-weight:700>()</span> <span style=color:#8f5902;font-style:italic>// ctx is done</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Process</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>We can then run the test function with race detection enabled using <code>go test -race ./panic_test.go</code>. Go will output logs indicating which goroutines are concurrently reading or writing to which variables, along with the creation location of these goroutines:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>WARNING</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>DATA</span> <span style=color:#000>RACE</span>
</span></span><span style=display:flex><span><span style=color:#000>Write</span> <span style=color:#000>at</span> <span style=color:#0000cf;font-weight:700>0x00c000124030</span> <span style=color:#000>by</span> <span style=color:#000>goroutine</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#000>command</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>line</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Handle</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>func1</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Users</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>bytedance</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic_test</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>21</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x44</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>Previous</span> <span style=color:#000>read</span> <span style=color:#000>at</span> <span style=color:#0000cf;font-weight:700>0x00c000124030</span> <span style=color:#000>by</span> <span style=color:#000>goroutine</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#000>command</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>line</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Process</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Users</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>bytedance</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic_test</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>35</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x5b</span>
</span></span><span style=display:flex><span>  <span style=color:#000>command</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>line</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WrapPanic</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Users</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>bytedance</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic_test</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>50</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x6c</span>
</span></span><span style=display:flex><span>  <span style=color:#000>command</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>line</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>TestPanic</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Users</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>bytedance</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic_test</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>56</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x9a</span>
</span></span><span style=display:flex><span>  <span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tRunner</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1194</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x202</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>Goroutine</span> <span style=color:#0000cf;font-weight:700>8</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>running</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>created</span> <span style=color:#000>at</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#000>command</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>line</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Handle</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Users</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>bytedance</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic_test</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>19</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x116</span>
</span></span><span style=display:flex><span>  <span style=color:#000>command</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>line</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Process</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Users</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>bytedance</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic_test</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>34</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x46</span>
</span></span><span style=display:flex><span>  <span style=color:#000>command</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>line</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WrapPanic</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Users</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>bytedance</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic_test</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>50</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x6c</span>
</span></span><span style=display:flex><span>  <span style=color:#000>command</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>line</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>TestPanic</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Users</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>bytedance</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>Code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic_test</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>56</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x9a</span>
</span></span><span style=display:flex><span>  <span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tRunner</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1194</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x202</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>Goroutine</span> <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>finished</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>created</span> <span style=color:#000>at</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#000>testing</span><span style=color:#000;font-weight:700>.(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>T</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>Run</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1239</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x5d7</span>
</span></span><span style=display:flex><span>  <span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>runTests</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>func1</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1512</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0xa6</span>
</span></span><span style=display:flex><span>  <span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tRunner</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1194</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x202</span>
</span></span><span style=display:flex><span>  <span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>runTests</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1510</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x612</span>
</span></span><span style=display:flex><span>  <span style=color:#000>testing</span><span style=color:#000;font-weight:700>.(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>M</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>Run</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>testing</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1418</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x3b3</span>
</span></span><span style=display:flex><span>  <span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#000>_testmain</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>43</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x236</span>
</span></span></code></pre></div><p>Based on the race report above, we can gather the following information:</p><ul><li>Goroutine 8 has a race condition write at <strong>panic_test.go:21</strong>.</li><li>Goroutine 7 has a race condition read at <strong>panic_test.go:35</strong>.</li><li>Goroutine 7 has finished, but Goroutine 8 is still running.</li></ul><p>With this information, we can generally identify the root cause of the issue.</p><h4 id=debugging-in-production>Debugging in Production</h4><p>Sometimes, it is not feasible to write unit tests for certain business logic, especially when it involves collaborative interactions between multiple upstream and downstream services to trigger the specific logic. In such cases, we need to rely on debugging in a production environment to identify the problem.</p><p>Suppose we have the following code:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Request</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Id</span> <span style=color:#204a87;font-weight:700>int</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Response</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Data</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>byte</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//go:noinline</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>RPCCall</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>req</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Request</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Response</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>resp</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>Response</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>Data</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87>byte</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;hello&#34;</span><span style=color:#000;font-weight:700>)}</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>req</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Id</span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#0000cf;font-weight:700>100</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#8f5902;font-style:italic>// Logic Bug</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>         <span style=color:#000>resp</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Data</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87>byte</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;world&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>resp</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000;font-weight:700>;</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>resp</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>RPCCall</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>Request</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>Id</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>id</span><span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>if</span> <span style=color:#204a87>string</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>resp</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Data</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#4e9a06>&#34;hello&#34;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>         <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;abnormal response!&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>return</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>The <code>RPCCall</code> function simulates a race condition bug that only occurs for specific parameters in a production request. We can compile this program using <code>go build -race</code>.</p><p>It&rsquo;s important tonote that this compilation method significantly reduces program performance. If possible, it&rsquo;s recommended to have an environment for traffic replay, where you can replay production traffic on a specific instance to reproduce the problem. If traffic replay is not available, you can enable race detection on a few selected instances, but be prepared for potential timeouts due to decreased performance.</p><h2 id=troubleshooting-crash-issues>Troubleshooting Crash Issues</h2><p>In Go, there are generally two reasons for an unexpected process exit:</p><ul><li>Unrecovered panic: A panic error occurs in a Goroutine and is not recovered.</li><li>Unexpected exception: The Go runtime encounters a fatal error that cannot be recovered, such as concurrent map writes or accessing an illegal address.</li></ul><p>By default, Go prints the corresponding stack trace for all exceptional exits. For simple projects, you can use the same stack tracing methods as for troubleshooting panic issues to locate the problem. However, for complex projects, even if you can identify the location of the exit, it is still difficult to determine why the code reached that point. In such cases, you need tools that can provide detailed analysis of the system&rsquo;s state at the time of the crash.</p><p>In C/C++, GDB is commonly used for this type of debugging. In Go, we can use Delve, a debugger specifically designed to optimize Go runtime features and data structures.</p><h3 id=obtaining-a-coredump-file>Obtaining a Coredump File</h3><h4 id=passive-retrieval>Passive Retrieval</h4><p>Delve requires the coredump file saved when the process exits. To obtain it, we need to use the following steps:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Remove the size limit for coredump files</span>
</span></span><span style=display:flex><span><span style=color:#204a87>ulimit</span> -c unlimited
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check the coredump file directory</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># For machines controlled by the company, this directory is usually specified as /opt/tiger/cores.</span>
</span></span><span style=display:flex><span>cat /proc/sys/kernel/core_pattern
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Instruct the Go runtime to handle coredump files</span>
</span></span><span style=display:flex><span><span style=color:#000>GOTRACEBACK</span><span style=color:#ce5c00;font-weight:700>=</span>crash ./<span style=color:#ce5c00;font-weight:700>{</span>bin_exec<span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>Note that Go does not produce a coredump file for panics that are recovered.</p><h4 id=active-retrieval>Active Retrieval</h4><p>Furthermore, it is not necessary to wait for the program to exit to generate a coredump file. If we suspect that a program has entered an exceptional state (e.g., it is stuck) but has not exited abnormally, we can proactively send a core signal to generate the coredump file and save the state:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Force the generation of a coredump file</span>
</span></span><span style=display:flex><span>apt install gdb
</span></span><span style=display:flex><span>gcore -o server.coredump <span style=color:#ce5c00;font-weight:700>{</span>pid<span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#8f5902;font-style:italic># gcore temporarily stops the program from responding, but does not kill it</span>
</span></span></code></pre></div><h3 id=analyzing-with-delve>Analyzing with Delve</h3><p>Let&rsquo;s use the following example code, which occasionally crashes, to demonstrate how to use Delve for in-depth analysis:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>   <span style=color:#4e9a06>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#4e9a06>&#34;log&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#4e9a06>&#34;sync&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>_</span> <span style=color:#204a87;font-weight:700>error</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>MyError</span><span style=color:#000;font-weight:700>)(</span><span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>store</span> <span style=color:#000>sync</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Map</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>init</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>id</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#0000cf;font-weight:700>1000</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>item</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>Item</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>Name</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Item-%d&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>id</span><span style=color:#000;font-weight:700>)}</span>
</span></span><span style=display:flex><span>      <span style=color:#000>store</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Store</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>item</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>MyError</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Reason</span> <span style=color:#204a87;font-weight:700>string</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>e</span> <span style=color:#000>MyError</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>Error</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;MyError: %s&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>e</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Reason</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>Buy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Item</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>MyError</span>
</span></span><span style=display:flex><span>   <span style=color:#000>val</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>store</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>LoadAndDelete</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>!</span><span style=color:#000>ok</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>   <span style=color:#000>item</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>val</span><span style=color:#000;font-weight:700>.(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Item</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>item</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>Handler</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>item</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>Buy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>item</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>merr</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>.(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>MyError</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>ok</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>         <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Buy[%d] get error: %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>merr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Error</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>   <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Buy item success: %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>item</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>wg</span> <span style=color:#000>sync</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WaitGroup</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>id</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#0000cf;font-weight:700>1000</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>wg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Add</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>wg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Done</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>         <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Handling: %d&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>         <span style=color:#000>Handler</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>   <span style=color:#000>wg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Wait</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Item</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Name</span> <span style=color:#204a87;font-weight:700>string</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>In this program, the <code>init</code> function creates 1000 items of type <code>Item</code> in the <code>store</code> variable. In the <code>main</code> function, 1000 Goroutines are used to concurrently call the <code>Buy</code> function to retrieve items from the <code>store</code>. Since various exceptional conditions can occur during the purchase process, we encapsulate the failure reason using the <code>MyError</code> type.</p><p>During the program&rsquo;s execution, it may panic with the following error and exit:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>panic</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>runtime</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>invalid</span> <span style=color:#000>memory</span> <span style=color:#000>address</span> <span style=color:#000>or</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000>pointer</span> <span style=color:#000>dereference</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>signal</span> <span style=color:#000>SIGSEGV</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>segmentation</span> <span style=color:#000>violation</span> <span style=color:#000>code</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0x1</span> <span style=color:#000>addr</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0x0</span> <span style=color:#000>pc</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0x491101</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>goroutine</span> <span style=color:#0000cf;font-weight:700>48</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>running</span><span style=color:#000;font-weight:700>]:</span>
</span></span><span style=display:flex><span><span style=color:#204a87>panic</span><span style=color:#000;font-weight:700>({</span><span style=color:#0000cf;font-weight:700>0x49c4e0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0x53e0b0</span><span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>941</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x397</span> <span style=color:#000>fp</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0xc00004ad50</span> <span style=color:#000>sp</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0xc00004ac90</span> <span style=color:#000>pc</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0x437337</span>
</span></span><span style=display:flex><span><span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>panicmem</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>220</span>
</span></span><span style=display:flex><span><span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sigpanic</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>signal_unix</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>826</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x31d</span> <span style=color:#000>fp</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0xc00004ada0</span> <span style=color:#000>sp</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0xc00004ad50</span> <span style=color:#000>pc</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0x44be1d</span>
</span></span><span style=display:flex><span><span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Handler</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0x39</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>home</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>wangzhuowei</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>41</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x121</span> <span style=color:#000>fp</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0xc00004aef8</span> <span style=color:#000>sp</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0xc00004ada0</span> <span style=color:#000>pc</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0x491101</span>
</span></span><span style=display:flex><span><span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>func1</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>home</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>wangzhuowei</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>55</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x159</span> <span style=color:#000>fp</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0xc00004afe0</span> <span style=color:#000>sp</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0xc00004aef8</span> <span style=color:#000>pc</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0x491619</span>
</span></span><span style=display:flex><span><span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>goexit</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>asm_amd64</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>s</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1571</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0x1</span> <span style=color:#000>fp</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0xc00004afe8</span> <span style=color:#000>sp</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0xc00004afe0</span> <span style=color:#000>pc</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0x4635e1</span>
</span></span><span style=display:flex><span><span style=color:#000>created</span> <span style=color:#000>by</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>main</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>home</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>wangzhuowei</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>52</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0xf1</span>
</span></span></code></pre></div><p>If you have a certain understanding of common pitfalls in Go coding, you may be able to identify several bugs lurking within the code by reading it. However, assuming that the functions here consist of complex code nested dozens of layers deep, and even involve third-party SDK handling, it becomes very difficult to troubleshoot by manually reading the code.</p><h4 id=identifying-the-immediate-cause>Identifying the Immediate Cause</h4><p>Using the methods mentioned earlier, we first locate the coredump file in the local directory and then run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dlv core <span style=color:#ce5c00;font-weight:700>{</span>elf_exec<span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>{</span>coredump_file<span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>Once inside the coredump file, we start by typing &ldquo;stack&rdquo; to see where the program&rsquo;s stack was when the crash occurred:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dlv</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>stack</span>
</span></span><span style=display:flex><span> <span style=color:#0000cf;font-weight:700>0</span>  <span style=color:#0000cf;font-weight:700>0x0000000000464f01</span> <span style=color:#000>in</span> <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>raise</span>
</span></span><span style=display:flex><span>    <span style=color:#000>at</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>sys_linux_amd64</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>s</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>170</span>
</span></span><span style=display:flex><span> <span style=color:#0000cf;font-weight:700>1</span>  <span style=color:#0000cf;font-weight:700>0x000000000044bf45</span> <span style=color:#000>in</span> <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>dieFromSignal</span>
</span></span><span style=display:flex><span>    <span style=color:#000>at</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>signal_unix</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>860</span>
</span></span><span style=display:flex><span> <span style=color:#0000cf;font-weight:700>2</span>  <span style=color:#0000cf;font-weight:700>0x000000000044c516</span> <span style=color:#000>in</span> <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sigfwdgo</span>
</span></span><span style=display:flex><span>    <span style=color:#000>at</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>signal_unix</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1074</span>
</span></span><span style=display:flex><span> <span style=color:#0000cf;font-weight:700>3</span>  <span style=color:#0000cf;font-weight:700>0x000000000044ac2a</span> <span style=color:#000>in</span> <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sigtrampgo</span>
</span></span><span style=display:flex><span>    <span style=color:#000>at</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>signal_unix</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>430</span>
</span></span><span style=display:flex><span> <span style=color:#0000cf;font-weight:700>4</span>  <span style=color:#0000cf;font-weight:700>0x0000000000465cce</span> <span style=color:#000>in</span> <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sigtrampgo</span>
</span></span><span style=display:flex><span>    <span style=color:#000>at</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>autogenerated</span><span style=color:#000;font-weight:700>&gt;:</span><span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span> <span style=color:#0000cf;font-weight:700>5</span>  <span style=color:#0000cf;font-weight:700>0x00000000004651dd</span> <span style=color:#000>in</span> <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sigtramp</span>
</span></span><span style=display:flex><span>    <span style=color:#000>at</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>sys_linux_amd64</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>s</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>363</span>
</span></span><span style=display:flex><span> <span style=color:#0000cf;font-weight:700>6</span>  <span style=color:#0000cf;font-weight:700>0x00000000004652e0</span> <span style=color:#000>in</span> <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sigreturn</span>
</span></span><span style=display:flex><span>    <span style=color:#000>at</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>sys_linux_amd64</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>s</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>468</span>
</span></span><span style=display:flex><span> <span style=color:#0000cf;font-weight:700>7</span>  <span style=color:#0000cf;font-weight:700>0x0000000000437b69</span> <span style=color:#000>in</span> <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>crash</span>
</span></span><span style=display:flex><span>    <span style=color:#000>at</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>signal_unix</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>952</span>
</span></span><span style=display:flex><span> <span style=color:#0000cf;font-weight:700>8</span>  <span style=color:#0000cf;font-weight:700>0x0000000000437b69</span> <span style=color:#000>in</span> <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>fatalpanic</span>
</span></span><span style=display:flex><span>    <span style=color:#000>at</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1092</span>
</span></span><span style=display:flex><span> <span style=color:#0000cf;font-weight:700>9</span>  <span style=color:#0000cf;font-weight:700>0x0000000000437337</span> <span style=color:#000>in</span> <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>gopanic</span>
</span></span><span style=display:flex><span>    <span style=color:#000>at</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>941</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>10</span>  <span style=color:#0000cf;font-weight:700>0x000000000044be1d</span> <span style=color:#000>in</span> <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>panicmem</span>
</span></span><span style=display:flex><span>    <span style=color:#000>at</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>panic</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>220</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>11</span>  <span style=color:#0000cf;font-weight:700>0x000000000044be1d</span> <span style=color:#000>in</span> <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sigpanic</span>
</span></span><span style=display:flex><span>    <span style=color:#000>at</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>signal_unix</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>826</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>12</span>  <span style=color:#0000cf;font-weight:700>0x0000000000491101</span> <span style=color:#000>in</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Handler</span>
</span></span><span style=display:flex><span>    <span style=color:#000>at</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>home</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>wangzhuowei</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>41</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>13</span>  <span style=color:#0000cf;font-weight:700>0x0000000000491619</span> <span style=color:#000>in</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>func1</span>
</span></span><span style=display:flex><span>    <span style=color:#000>at</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>home</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>wangzhuowei</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>55</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>14</span>  <span style=color:#0000cf;font-weight:700>0x00000000004635e1</span> <span style=color:#000>in</span> <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>goexit</span>
</span></span><span style=display:flex><span>    <span style=color:#000>at</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>asm_amd64</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>s</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1571</span>
</span></span></code></pre></div><p>The leftmost number indicates the hierarchical sequence of each frame in the stack. We can use the &ldquo;frame N&rdquo; command to enter a specific frame and view more information:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dlv</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>frame</span> <span style=color:#0000cf;font-weight:700>12</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>raise</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>usr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>local</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>runtime</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>sys_linux_amd64</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>s</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>170</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>PC</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0x464f01</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>Frame</span> <span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>home</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>wangzhuowei</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>41</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>PC</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>491101</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>36</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>37</span><span style=color:#000;font-weight:700>:</span>        <span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>Handler</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>38</span><span style=color:#000;font-weight:700>:</span>                <span style=color:#000>item</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>Buy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>39</span><span style=color:#000;font-weight:700>:</span>                <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>item</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>40</span><span style=color:#000;font-weight:700>:</span>                        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>merr</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>.(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>MyError</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>ok</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>=&gt;</span>  <span style=color:#0000cf;font-weight:700>41</span><span style=color:#000;font-weight:700>:</span>                                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Buy[%d] get error: %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>merr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Error</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>:</span>                        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>43</span><span style=color:#000;font-weight:700>:</span>                        <span style=color:#204a87;font-weight:700>return</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>44</span><span style=color:#000;font-weight:700>:</span>                <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>:</span>                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Buy item success: %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>item</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>So far, the information we have can only tell us the direct cause of the panic, which is that &ldquo;merr&rdquo; inexplicably became nil at this point. In fact, this information can be obtained from analyzing the panic logs when the crash occurred. However, this information is not enough to understand what exactly happened at the scene of the incident. Therefore, we need further steps to analyze and identify the root cause of the problem.</p><h4 id=tracing-the-root-cause>Tracing the Root Cause</h4><p>In line 41 of the code, we can see that we have taken several safety precautions to obtain the actual <code>MyError</code> object. We first check if it is <code>nil</code>, and then we check if we can perform a type conversion. However, we still encounter the error &ldquo;invalid memory address or nil pointer dereference.&rdquo; Therefore, our first step is to understand what <code>merr</code> and <code>err</code> variables represent in this context:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dlv</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>print</span> <span style=color:#000>merr</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MyError</span> <span style=color:#204a87;font-weight:700>nil</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dlv</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>print</span> <span style=color:#000>err</span>
</span></span><span style=display:flex><span><span style=color:#204a87>error</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MyError</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>nil</span>
</span></span></code></pre></div><p>We can see that <code>merr</code> is of type pointer and has a value of <code>nil</code>. On the other hand, <code>err</code> is of type <code>interface{}</code>, and its display format is <code>&lt;interface name>(&lt;concrete type>)&lt;value></code>. Therefore, we can deduce that it is an object of type <code>*MyError</code> with a value of <code>nil</code>.</p><p>By reading the Go source code and documentation, we know that in Go, an interface object with a concrete type but a <code>nil</code> value is not equal to <code>nil</code>.</p><p>The next question is, in what scenario would <code>err</code> have a type but a <code>nil</code> value? We can search for all possible locations where <code>var err *MyError</code> is declared in the code, and we find the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>Buy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Item</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>MyError</span>
</span></span><span style=display:flex><span>   <span style=color:#000>val</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>store</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>LoadAndDelete</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>!</span><span style=color:#000>ok</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>   <span style=color:#000>item</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>val</span><span style=color:#000;font-weight:700>.(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Item</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>item</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>In the <code>Buy</code> function, it is evident that when the <code>id</code> object is not found in the store, it returns <code>item</code> as <code>nil</code> and <code>err</code> as a <code>nil</code> value with a non-<code>nil</code> type.</p><p>However, if we look at the <code>init</code> function at the beginning of the code, we can see that we have already created all the <code>Item</code> objects with IDs in the range [0, 1000), and the <code>main</code> function calls the <code>Buy</code> function with IDs in the range [0, 1000). So why would it not find a value? Therefore, we need to dig deeper into the call chain and examine all relevant variables:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dlv</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>frame</span> <span style=color:#0000cf;font-weight:700>13</span>
</span></span><span style=display:flex><span><span style=color:#000>Frame</span> <span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>home</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>wangzhuowei</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>55</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>PC</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>491619</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>50</span><span style=color:#000;font-weight:700>:</span>                <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>id</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#0000cf;font-weight:700>1000</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>51</span><span style=color:#000;font-weight:700>:</span>                        <span style=color:#000>wg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Add</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>52</span><span style=color:#000;font-weight:700>:</span>                        <span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>53</span><span style=color:#000;font-weight:700>:</span>                                <span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>wg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Done</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>54</span><span style=color:#000;font-weight:700>:</span>                                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Handling: %d&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>=&gt;</span>  <span style=color:#0000cf;font-weight:700>55</span><span style=color:#000;font-weight:700>:</span>                                <span style=color:#000>Handler</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>56</span><span style=color:#000;font-weight:700>:</span>                        <span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>57</span><span style=color:#000;font-weight:700>:</span>                <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dlv</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>print</span> <span style=color:#000>id</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>58</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dlv</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>frame</span> <span style=color:#0000cf;font-weight:700>12</span>
</span></span><span style=display:flex><span><span style=color:#000>Frame</span> <span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>home</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>wangzhuowei</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>code</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>chore</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>main</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>go</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>41</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>PC</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>491101</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>37</span><span style=color:#000;font-weight:700>:</span>        <span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>Handler</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>38</span><span style=color:#000;font-weight:700>:</span>                <span style=color:#000>item</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>Buy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>39</span><span style=color:#000;font-weight:700>:</span>                <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>item</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>40</span><span style=color:#000;font-weight:700>:</span>                        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>merr</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>.(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>MyError</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>ok</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>=&gt;</span>  <span style=color:#0000cf;font-weight:700>41</span><span style=color:#000;font-weight:700>:</span>                                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Buy[%d] get error: %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>merr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Error</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>:</span>                        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dlv</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>print</span> <span style=color:#000>id</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>57</span>
</span></span></code></pre></div><p>Since the <code>Handler</code> function only has a connection to the upper-level calling function through the <code>id</code> parameter, we only need to print its value. We can see that in the outer frame 13, the value of <code>id</code> is 58, while in the inner frame 12, its value is 57. This indicates that at the start of the <code>Handler</code> call, the <code>id</code> value is 57, but when the panic occurs, the <code>id</code> value has already been modified to 58. This is unexpected because it means that before calling the <code>Handler</code> function, it&rsquo;s possible that the <code>id</code> has been modified, causing the inner <code>Buy</code> function to access an object that has already been accessed and deleted. This leads to the final error message.</p><p>Once we find this clue, we can search for the code section that modifies the <code>id</code> value and identify the actual problem. In this case, it is the modification of the <code>id</code> object at line 50, which is currently being held by other goroutines.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>wg</span> <span style=color:#000>sync</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WaitGroup</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>id</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#0000cf;font-weight:700>1000</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>wg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Add</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>wg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Done</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>         <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#a40000>&#34;</span><span style=color:#000>Handling</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000>d</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>         <span style=color:#000>Handler</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>   <span style=color:#000>wg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Wait</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=investigating-memory-leak-issues>Investigating Memory Leak Issues</h2><p>When it comes to troubleshooting memory leak issues in Go, there are two main challenges:</p><ol><li>Go is a garbage-collected language that doesn&rsquo;t require manual management of object lifetimes. However, this also means that any code segment that potentially holds a variable for an extended period or partially holds a memory address (such as slices) can lead to memory leaks.</li><li>Go&rsquo;s pprof heap tool only reveals which functions allocate memory but does not show who still holds references to that memory. Currently, code inspection is the only way to identify the culprits.</li></ol><p>Assuming we have the following code, which abbreviates a user&rsquo;s SSH RSA key to the &ldquo;xx&mldr;x&rdquo; format and stores it in a cache:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>global</span> <span style=color:#204a87;font-weight:700>string</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>cache</span> <span style=color:#000>sync</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Map</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>SSHData</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>UserId</span> <span style=color:#204a87;font-weight:700>int</span>
</span></span><span style=display:flex><span>   <span style=color:#000>RSAKey</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>byte</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>AddSSH</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>SSHData</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// Mask RSAKey to xx...x format</span>
</span></span><span style=display:flex><span>   <span style=color:#000>cache</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Store</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>UserId</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RSAKey</span><span style=color:#000;font-weight:700>[:</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>],</span> <span style=color:#4e9a06>&#39;.&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;.&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;.&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>data</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RSAKey</span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RSAKey</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]))</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ListenAndServe</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;localhost:6060&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#000>global</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>string</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>make</span><span style=color:#000;font-weight:700>([]</span><span style=color:#204a87;font-weight:700>byte</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1024</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#0000cf;font-weight:700>1024</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>req</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>new</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SSHData</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>      <span style=color:#000>req</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>UserId</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>i</span>
</span></span><span style=display:flex><span>      <span style=color:#000>req</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RSAKey</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>randBytes</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2048</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#000>AddSSH</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>req</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sleep</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Millisecond</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>randBytes</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>size</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>byte</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>data</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>([]</span><span style=color:#204a87;font-weight:700>byte</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>size</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#000>size</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>data</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>byte</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;a&#39;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#0000cf;font-weight:700>26</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>data</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=identifying-leaked-objects>Identifying Leaked Objects</h3><p>To begin, we access http://localhost:6060/debug/pprof/heap to take an initial heap sample, saving the result as <code>heap.old</code>. This provides a snapshot of the heap&rsquo;s current state.</p><p><img src=/img/docs/debug_efficiently/1.png alt=image></p><p>Since the code creates 100MB of data when the service starts, this initial heap profile is not very informative. We need to focus on the memory usage that increases between two heap samples taken over a specific period.</p><p>After waiting for one minute, we access the same URL to take another sample, saving the result as <code>heap.new</code>. We then use the command <code>go tool pprof -http=:8000 -diff_base=heap.old heap.new</code> to generate a heap diff graph, which visualizes the changes in memory usage.</p><p><img src=/img/docs/debug_efficiently/2.png alt=image></p><p>From the generated heap diff graph, we can see that the additional memory is allocated by the <code>randBytes</code> function. Based on the code, it is apparent that the object referencing the return value of this function is <code>RSAKey</code>.</p><h3 id=tracing-the-source-of-the-leak>Tracing the Source of the Leak</h3><p>To trace the source of the leak, we need to inspect the code and identify where the reference to the leaked object is retained. In this example, the only function that persists such a reference is:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>AddSSH</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>SSHData</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>cache</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Store</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>UserId</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RSAKey</span><span style=color:#000;font-weight:700>[:</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>],</span> <span style=color:#4e9a06>&#39;.&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;.&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;.&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>data</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RSAKey</span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RSAKey</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]))</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>According to the code, this function stores a 6-byte object in the <code>cache</code> map for each <code>UserId</code>. Since the <code>main</code> function calls <code>AddSSH</code> 1000 times per second, it results in a memory leak of 6KB per second. Even if the program runs for an hour, it would only leak 21MB of data, which is insufficient to account for a 60MB leak within a minute.</p><p>However, upon closer examination of the <code>append</code> function, we discover that the returned slice object still holds a reference to the underlying array created by the original <code>randBytes</code> function. As long as there is a partial reference to the slice, the original object cannot be fully released.</p><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes"><a href=https://github.com/cloudwego/cloudwego.github.io/issues/new>Please tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no"><a href=https://github.com/cloudwego/cloudwego.github.io/issues/new>Please tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector(".feedback--answer-yes"),noButton=document.querySelector(".feedback--answer-no"),yesResponse=document.querySelector(".feedback--response-yes"),noResponse=document.querySelector(".feedback--response-no"),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=e=>{if(typeof ga!="function")return;const t={command:"send",hitType:"event",category:"Helpful",action:"click",label:window.location.pathname,value:e};ga(t.command,t.hitType,t.category,t.action,t.label,t.value)};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(1)}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified
March 7, 2025
: <a href=https://github.com/cloudwego/cloudwego.github.io/commit/590388601ba4c26232b5ba3dcdef1bb571867ba4>doc: update plugin install guide (#1272) (5903886)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Lark aria-label=Lark><a class=text-white target=_blank rel=noopener href="https://applink.feishu.cn/client/chat/chatter/add_by_link?link_token=693v2544-2664-4421-b50f-7f1912p745r6" aria-label=Lark><img src=/webfonts/lark.svg alt style=width:26px;line-height:32.5px;margin-bottom:6px;fill:#fff></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/CloudWeGo aria-label=Twitter><img src=/webfonts/x-twitter.svg alt style=width:26px;line-height:32.5px;margin-bottom:6px;fill:#fff></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/cloudwego aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Discord aria-label=Discord><a class=text-white target=_blank rel=noopener href=https://discord.gg/jceZSE7DsW aria-label=Discord><i class="fab fa-discord"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2025 The CloudWeGo Authors</small><p class="mt-2 text-white"><a class=cloudwego-link href=/about/ target=_blank rel=noopener>About</a>
|
<a class=cloudwego-link href=https://github.com/cloudwego/cloudwego.github.io/blob/main/LICENSE target=_blank rel=noopener>License</a></p></div></div></div></footer></div><script src=/js/popper.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/main.min.9a8648b987db06195f5768f0d7516e8df7c27669e91e383e25c5d07cd6325605.js integrity="sha256-moZIuYfbBhlfV2jw11FujffCdmnpHjg+JcXQfNYyVgU=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/prism-custom.js></script><script src=/js/tabpane-persist.js></script><script src=/js/docsearch.js></script><script type=text/javascript>let siteLang=window.location.pathname.startsWith("/zh/")?"zh":"en";docsearch({appId:"V7I042F992",apiKey:"8380a7ac88106841cb43fb000fa2edb4",indexName:"cloudwego",container:"#docsearch",searchParameters:{hitsPerPage:5,facetFilters:[`lang:${siteLang}`]},transformItems(e){return e.map(e=>({...e,url:e.url.replace("www.cloudwego.io",location.host).replace("https:",location.protocol)}))}})</script><script src=/js/outbound-link.js></script><script src=/js/navScroll.js></script></body></html>