<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.142.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Config Guide | CloudWeGo</title>
<meta name=description content="A leading practice for building enterprise cloud native middleware!"><meta property="og:url" content="https://www.cloudwego.io/docs/monolake/config-guide/"><meta property="og:site_name" content="CloudWeGo"><meta property="og:title" content="Config Guide"><meta property="og:description" content="Comphrensive guide to configuring monolake proxy"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Config Guide"><meta itemprop=description content="Comphrensive guide to configuring monolake proxy"><meta itemprop=dateModified content="2025-03-07T17:25:05+08:00"><meta itemprop=wordCount content="924"><meta name=twitter:card content="summary"><meta name=twitter:title content="Config Guide"><meta name=twitter:description content="Comphrensive guide to configuring monolake proxy"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYWRQRLPRM"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QYWRQRLPRM")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?f1808c42af827f368aa7eca3baae6d55",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=preload href=/scss/main.min.b3c21c777309e05201dd625b8a4ece4076249bfa52b71d58c6e352d84c6c0320.css as=style><link href=/scss/main.min.b3c21c777309e05201dd625b8a4ece4076249bfa52b71d58c6e352d84c6c0320.css rel=stylesheet integrity><script src=/js/jquery.min.js></script><link rel=stylesheet href=/css/prism.css><link rel=stylesheet href=/css/docsearch.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYWRQRLPRM"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QYWRQRLPRM")}</script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand-xl navbar-dark td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><img src=/img/logo.png></span>
</a><button class=navbar-toggler type=button data-toggle=collapse data-target=#main_navbar aria-controls=main_navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0 ml-auto"><li class="dropdown sub-menu active"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>Documentation</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/docs/kitex/>Kitex</a>
<a class=dropdown-item href=/docs/hertz/>Hertz</a>
<a class=dropdown-item href=/docs/volo/>Volo</a>
<a class=dropdown-item href=/docs/netpoll/>Netpoll</a>
<a class=dropdown-item href=/docs/cwgo/>Cwgo</a>
<a class=dropdown-item href=/docs/eino/>Eino</a>
<a class=dropdown-item href=/docs/monolake/>Monolake</a></div></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/about/><span>About</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><span>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cooperation/><span>Cooperation</span></a></li><li class="dropdown sub-menu"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>Security</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/security/safety-bulletin/>safety-bulletin</a>
<a class=dropdown-item href=/security/vulnerability-reporting/>vulnerability-reporting</a></div></li><li class="nav-item dropdown mr-4"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/>中文</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><div id=docsearch></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div id=docsearch></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav foldable-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/>中文</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsmonolake-li><input type=checkbox id=m-docsmonolake-check checked>
<label for=m-docsmonolake-check><a href=/docs/monolake/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsmonolake><span>Monolake</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonolakeoverview-li><input type=checkbox id=m-docsmonolakeoverview-check checked>
<label for=m-docsmonolakeoverview-check><a href=/docs/monolake/overview/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsmonolakeoverview><span>Overview</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonolakegetting-started-li><input type=checkbox id=m-docsmonolakegetting-started-check checked>
<label for=m-docsmonolakegetting-started-check><a href=/docs/monolake/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsmonolakegetting-started><span>Getting Started</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsmonolakearchitecture-li><input type=checkbox id=m-docsmonolakearchitecture-check checked>
<label for=m-docsmonolakearchitecture-check><a href=/docs/monolake/architecture/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsmonolakearchitecture><span>Architecture</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonolakearchitectureruntime-li><input type=checkbox id=m-docsmonolakearchitectureruntime-check>
<label for=m-docsmonolakearchitectureruntime-check><a href=/docs/monolake/architecture/runtime/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsmonolakearchitectureruntime><span>Runtime</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonolakearchitectureservice-li><input type=checkbox id=m-docsmonolakearchitectureservice-check>
<label for=m-docsmonolakearchitectureservice-check><a href=/docs/monolake/architecture/service/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsmonolakearchitectureservice><span>Service</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonolakearchitectureconnector-li><input type=checkbox id=m-docsmonolakearchitectureconnector-check>
<label for=m-docsmonolakearchitectureconnector-check><a href=/docs/monolake/architecture/connector/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsmonolakearchitectureconnector><span>Connectors</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonolakearchitecturecontext-li><input type=checkbox id=m-docsmonolakearchitecturecontext-check>
<label for=m-docsmonolakearchitecturecontext-check><a href=/docs/monolake/architecture/context/ title="Context Management" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsmonolakearchitecturecontext><span>Context</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsmonolaketutorial-li><input type=checkbox id=m-docsmonolaketutorial-check checked>
<label for=m-docsmonolaketutorial-check><a href=/docs/monolake/tutorial/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsmonolaketutorial><span>Tutorial</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonolaketutorialconfig-li><input type=checkbox id=m-docsmonolaketutorialconfig-check>
<label for=m-docsmonolaketutorialconfig-check><a href=/docs/monolake/tutorial/config/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsmonolaketutorialconfig><span>Config & context management</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonolaketutorialservice-li><input type=checkbox id=m-docsmonolaketutorialservice-check>
<label for=m-docsmonolaketutorialservice-check><a href=/docs/monolake/tutorial/service/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsmonolaketutorialservice><span>Creating Service and Factory</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonolaketutorialcode-li><input type=checkbox id=m-docsmonolaketutorialcode-check>
<label for=m-docsmonolaketutorialcode-check><a href=/docs/monolake/tutorial/code/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsmonolaketutorialcode><span>Putting it all together</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docsmonolakeconfig-guide-li><input type=checkbox id=m-docsmonolakeconfig-guide-check checked>
<label for=m-docsmonolakeconfig-guide-check><a href=/docs/monolake/config-guide/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__section" id=m-docsmonolakeconfig-guide><span class=td-sidebar-nav-active-item>Config Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonolakeglossary-li><input type=checkbox id=m-docsmonolakeglossary-check checked>
<label for=m-docsmonolakeglossary-check><a href=/docs/monolake/glossary/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsmonolakeglossary><span>Glossary</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonolakefaq-li><input type=checkbox id=m-docsmonolakefaq-check checked>
<label for=m-docsmonolakefaq-check><a href=/docs/monolake/faq/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsmonolakefaq><span>FAQ</span></a></label></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/cloudwego/cloudwego.github.io/edit/main/content/en//docs/monolake/config-guide target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/new/main/content/en//docs/monolake/config-guide?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/issues/new?labels=bug&amp;template=DOCS_UPDATE.md&amp;title=Config%20Guide" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/cloudwego/monolake/issues/new/choose target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#overview-of-the-configuration-file>Overview of the Configuration File</a><ul><li><a href=#configuration-file-structure>Configuration File Structure</a></li></ul></li><li><a href=#1-runtime-configuration>1. Runtime Configuration</a></li><li><a href=#2-server-configuration>2. Server Configuration</a><ul><li><a href=#http-proxy-configuration>HTTP Proxy Configuration</a></li><li><a href=#https-proxy-configuration>HTTPS Proxy Configuration</a></li><li><a href=#unix-domain-socket-uds-proxy-configuration>Unix Domain Socket (UDS) Proxy Configuration</a></li></ul></li><li><a href=#3-routing-configuration>3. Routing Configuration</a><ul><li><a href=#example-routes-for-http-proxy>Example Routes for HTTP Proxy</a></li></ul></li><li><a href=#4-applying-the-configuration>4. Applying the Configuration</a><ul><li><a href=#key-behavior-of-the-file-watcher>Key Behavior of the File Watcher:</a></li><li><a href=#steps>Steps:</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://www.cloudwego.io/docs/>Documentation</a></li><li class=breadcrumb-item><a href=https://www.cloudwego.io/docs/monolake/>Monolake</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://www.cloudwego.io/docs/monolake/config-guide/>Config Guide</a></li></ol></nav><div class=td-content><h1>Config Guide</h1><div class=lead>Comphrensive guide to configuring monolake proxy</div><header class=article-meta></header><h1 id=proxy-configuration-guide>Proxy Configuration Guide</h1><p>This document explains how to configure monolake proxy using a custom configuration file. It covers how to set up <strong>HTTP</strong>, <strong>HTTPS</strong>, and <strong>Unix Domain Socket (UDS)</strong> proxies, configure routing, and customize server settings.</p><h2 id=overview-of-the-configuration-file>Overview of the Configuration File</h2><p>The configuration file is divided into sections that define various proxy servers, runtime settings, and routes. Each server has specific configuration options, such as the listener type (socket, UNIX domain socket), upstream connections, and HTTP-related settings.</p><h3 id=configuration-file-structure>Configuration File Structure</h3><ol><li><p><strong>Runtime Configuration (<code>[runtime]</code>)</strong><br>Defines the runtime environment and settings for the proxy service.</p></li><li><p><strong>Server Configuration (<code>[servers.&lt;name>]</code>)</strong><br>Defines individual proxy servers. Each server can be an HTTP, HTTPS, or UDS proxy with customizable settings for listener type, upstream connections, and routing.</p></li><li><p><strong>Routes (<code>[[servers.&lt;name>.routes]]</code>)</strong><br>Specifies how incoming requests are routed to upstream endpoints.</p></li></ol><hr><h2 id=1-runtime-configuration>1. Runtime Configuration</h2><p>The <code>[runtime]</code> section configures global settings for the proxy service. Here are the key fields:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>runtime</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>runtime_type</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;io_uring&#34;</span>  <span style=color:#8f5902;font-style:italic># Type of runtime to use (e.g., legacy, io_uring)</span>
</span></span><span style=display:flex><span><span style=color:#000>worker_threads</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span>       <span style=color:#8f5902;font-style:italic># Number of worker threads</span>
</span></span><span style=display:flex><span><span style=color:#000>entries</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1024</span>           <span style=color:#8f5902;font-style:italic># Number of entries for io_uring</span>
</span></span></code></pre></div><ul><li><strong><code>runtime_type</code></strong>: Defines the type of runtime to use, such as <code>legacy</code> or <code>io_uring</code>. The choice of runtime impacts performance and system resources.</li><li><strong><code>worker_threads</code></strong>: Specifies the number of worker threads the proxy service will use. Increasing this number may improve handling of concurrent requests.</li><li><strong><code>entries</code></strong>: Sets the number of entries for <code>io_uring</code> (if used). This controls the number of concurrent I/O operations that can be managed.</li></ul><hr><h2 id=2-server-configuration>2. Server Configuration</h2><p>The <code>[servers]</code> section defines individual proxy servers. You can configure each proxy server&rsquo;s listener, upstream connection settings, and other specific options.</p><h3 id=http-proxy-configuration>HTTP Proxy Configuration</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>servers</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>demo_http</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>name</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;monolake.rs&#34;</span>  <span style=color:#8f5902;font-style:italic># Proxy name</span>
</span></span><span style=display:flex><span><span style=color:#000>listener</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>type</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;socket&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;0.0.0.0:8080&#34;</span> <span style=color:#000;font-weight:700>}</span>  <span style=color:#8f5902;font-style:italic># Listener configuration</span>
</span></span><span style=display:flex><span><span style=color:#000>upstream_http_version</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;http11&#34;</span>  <span style=color:#8f5902;font-style:italic># HTTP version for upstream connections</span>
</span></span><span style=display:flex><span><span style=color:#000>http_opt_handlers</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>content_handler</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span> <span style=color:#000;font-weight:700>}</span>  <span style=color:#8f5902;font-style:italic># Enable HTTP optional handlers</span>
</span></span><span style=display:flex><span><span style=color:#000>http_timeout</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>server_keepalive_timeout_sec</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>60</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>upstream_connect_timeout_sec</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>upstream_read_timeout_sec</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><ul><li><strong><code>name</code></strong>: Specifies the name of the proxy server. This can be used to identify the server in logs or other configuration sections.</li><li><strong><code>listener</code></strong>: Defines where the server will listen for incoming connections. In this case, the server listens on <code>0.0.0.0:8080</code>.</li><li><strong><code>upstream_http_version</code></strong>: Sets the HTTP version used for connections to upstream servers. Here, it uses HTTP/1.1. Use <strong>http2</strong> for HTTP/2.</li><li><strong><code>http_opt_handlers</code></strong>: Enables or disables HTTP optional handlers.</li><li><strong><code>http_timeout</code></strong>: Configures various HTTP timeouts, such as:<ul><li><code>server_keepalive_timeout_sec</code>: The timeout for keeping the connection alive with the client.</li><li><code>upstream_connect_timeout_sec</code>: The timeout for establishing a connection to upstream servers.</li><li><code>upstream_read_timeout_sec</code>: The timeout for reading data from upstream servers.</li></ul></li></ul><h3 id=https-proxy-configuration>HTTPS Proxy Configuration</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>servers</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>demo_https</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>name</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;tls.monolake.rs&#34;</span>  <span style=color:#8f5902;font-style:italic># Proxy name</span>
</span></span><span style=display:flex><span><span style=color:#000>listener</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>type</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;socket&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;0.0.0.0:8081&#34;</span> <span style=color:#000;font-weight:700>}</span>  <span style=color:#8f5902;font-style:italic># Listener configuration</span>
</span></span><span style=display:flex><span><span style=color:#000>tls</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>chain</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;examples/certs/server.crt&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>key</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;examples/certs/server.key&#34;</span> <span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><ul><li><strong><code>tls</code></strong>: Specifies the TLS certificates required for HTTPS encryption. You must provide paths to the certificate chain (<code>server.crt</code>) and private key (<code>server.key</code>).</li></ul><h3 id=unix-domain-socket-uds-proxy-configuration>Unix Domain Socket (UDS) Proxy Configuration</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>servers</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>demo_uds</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>name</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;uds.monolake.rs&#34;</span>  <span style=color:#8f5902;font-style:italic># Server name</span>
</span></span><span style=display:flex><span><span style=color:#000>listener</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>type</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;unix&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;/tmp/monolake.sock&#34;</span> <span style=color:#000;font-weight:700>}</span>  <span style=color:#8f5902;font-style:italic># Listener configuration</span>
</span></span></code></pre></div><ul><li><strong><code>listener</code></strong>: This server listens on a Unix Domain Socket (<code>/tmp/monolake.sock</code>). UDS is useful for communication between processes on the same machine without using network protocols.</li></ul><hr><h2 id=3-routing-configuration>3. Routing Configuration</h2><p>Each proxy server can have multiple routes configured to forward requests to upstream endpoints.</p><h3 id=example-routes-for-http-proxy>Example Routes for HTTP Proxy</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[[</span><span style=color:#000>servers</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>demo_http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>routes</span><span style=color:#000;font-weight:700>]]</span>
</span></span><span style=display:flex><span><span style=color:#000>path</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;/&#39;</span>  <span style=color:#8f5902;font-style:italic># Route path</span>
</span></span><span style=display:flex><span><span style=color:#000>upstreams</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>[{</span> <span style=color:#000>endpoint</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>type</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;uri&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;http://ifconfig.me/&#34;</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>}]</span>  <span style=color:#8f5902;font-style:italic># Upstream endpoint</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[[</span><span style=color:#000>servers</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>demo_http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>routes</span><span style=color:#000;font-weight:700>]]</span>
</span></span><span style=display:flex><span><span style=color:#000>path</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;/{*p}&#39;</span>  <span style=color:#8f5902;font-style:italic># Wild card route path</span>
</span></span><span style=display:flex><span><span style=color:#000>upstreams</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>endpoint</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>type</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;uri&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;https://httpbin.org/xml&#34;</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></div><ul><li><strong><code>path</code></strong>: The route path for which this configuration applies. For example, the route <code>/</code> forwards requests to the endpoint <code>http://ifconfig.me/</code>.</li><li><strong><code>upstreams</code></strong>: A list of upstream endpoints. Each endpoint can be a URI (either HTTP or HTTPS) to which the proxy server forwards the request.</li><li><strong>Wildcard Routes</strong>: You can use <code>{*p}</code> as a wildcard to capture all paths and forward them to an endpoint. This is helpful when you want to handle a wide range of URLs.</li></ul><h2 id=4-applying-the-configuration>4. Applying the Configuration</h2><p>Monolake will <strong>automatically detect changes</strong> to the configuration file and apply the updated settings without needing to manually restart the service.</p><h3 id=key-behavior-of-the-file-watcher>Key Behavior of the File Watcher:</h3><ul><li><strong>Automatic Detection</strong>: When the configuration file is <strong>replaced</strong> (e.g., the old config file is replaced with a new one), the file watcher will automatically detect the change.</li><li><strong>Graceful Transition for Active Connections</strong>:<ul><li>If the new configuration updates an existing proxy service, <strong>any existing connections</strong> (those established before the update) will continue to use the old configuration settings.</li><li><strong>New connections</strong> (those established after the configuration change) will use the <strong>latest configuration</strong>.</li></ul></li><li>This ensures that the service remains stable for active users while applying the updated configuration for all new users.</li></ul><h3 id=steps>Steps:</h3><ol><li><strong>Replace the Configuration File</strong>: Replace the current configuration file with the new version containing your desired changes (e.g., new routes, updated listener settings, or updated certificates).</li><li><strong>File Watcher Detection</strong>: The file watcher will automatically detect the replacement and apply the new configuration to the proxy service.</li><li><strong>Automatic Application</strong>: The updated configuration is applied to any new incoming connections. Existing connections continue using the configuration that was active when they were established.</li><li><strong>Verify</strong>: Check the proxy service logs or metrics to confirm that the new configuration is being applied to new connections, while existing connections are unaffected.</li></ol><p>This approach allows for <strong>seamless updates</strong> to the proxy service, minimizing downtime and ensuring that changes are immediately reflected for new connections without disrupting active ones.</p><hr><div class=section-index></div><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes"><a href=https://github.com/cloudwego/cloudwego.github.io/issues/new>Please tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no"><a href=https://github.com/cloudwego/cloudwego.github.io/issues/new>Please tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector(".feedback--answer-yes"),noButton=document.querySelector(".feedback--answer-no"),yesResponse=document.querySelector(".feedback--response-yes"),noResponse=document.querySelector(".feedback--response-no"),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=e=>{if(typeof ga!="function")return;const t={command:"send",hitType:"event",category:"Helpful",action:"click",label:window.location.pathname,value:e};ga(t.command,t.hitType,t.category,t.action,t.label,t.value)};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(1)}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified
March 7, 2025
: <a href=https://github.com/cloudwego/cloudwego.github.io/commit/590388601ba4c26232b5ba3dcdef1bb571867ba4>doc: update plugin install guide (#1272) (5903886)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Lark aria-label=Lark><a class=text-white target=_blank rel=noopener href="https://applink.feishu.cn/client/chat/chatter/add_by_link?link_token=693v2544-2664-4421-b50f-7f1912p745r6" aria-label=Lark><img src=/webfonts/lark.svg alt style=width:26px;line-height:32.5px;margin-bottom:6px;fill:#fff></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/CloudWeGo aria-label=Twitter><img src=/webfonts/x-twitter.svg alt style=width:26px;line-height:32.5px;margin-bottom:6px;fill:#fff></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/cloudwego aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Discord aria-label=Discord><a class=text-white target=_blank rel=noopener href=https://discord.gg/jceZSE7DsW aria-label=Discord><i class="fab fa-discord"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2025 The CloudWeGo Authors</small><p class="mt-2 text-white"><a class=cloudwego-link href=/about/ target=_blank rel=noopener>About</a>
|
<a class=cloudwego-link href=https://github.com/cloudwego/cloudwego.github.io/blob/main/LICENSE target=_blank rel=noopener>License</a></p></div></div></div></footer></div><script src=/js/popper.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/main.min.9a8648b987db06195f5768f0d7516e8df7c27669e91e383e25c5d07cd6325605.js integrity="sha256-moZIuYfbBhlfV2jw11FujffCdmnpHjg+JcXQfNYyVgU=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/prism-custom.js></script><script src=/js/tabpane-persist.js></script><script src=/js/docsearch.js></script><script type=text/javascript>let siteLang=window.location.pathname.startsWith("/zh/")?"zh":"en";docsearch({appId:"V7I042F992",apiKey:"8380a7ac88106841cb43fb000fa2edb4",indexName:"cloudwego",container:"#docsearch",searchParameters:{hitsPerPage:5,facetFilters:[`lang:${siteLang}`]},transformItems(e){return e.map(e=>({...e,url:e.url.replace("www.cloudwego.io",location.host).replace("https:",location.protocol)}))}})</script><script src=/js/outbound-link.js></script><script src=/js/navScroll.js></script></body></html>