<!doctype html><html lang=zh class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.142.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Engine | CloudWeGo</title>
<meta name=description content="A leading practice for building enterprise cloud native middleware!"><meta property="og:url" content="https://www.cloudwego.io/zh/docs/hertz/tutorials/basic-feature/engine/"><meta property="og:site_name" content="CloudWeGo"><meta property="og:title" content="Engine"><meta property="og:description" content='server.Hertz 是 Hertz 的核心类型，它由 route.Engine 以及 signalWaiter 组成，Hertz 服务器的启动、路由注册、中间件注册以及退出等重要方法均包含在 server.Hertz 中。以下是 server.Hertz 的定义：
type Hertz struct { *route.Engine // 用于接收信号以实现优雅退出 signalWaiter func (err chan error) error } route.Engine 为 server.Hertz 的重要组成部分，Engine 的定义位于 Engine。
配置 配置项 默认值 说明 WithTransport network.NewTransporter 更换底层 transport WithHostPorts :8888 指定监听的地址和端口 WithKeepAliveTimeout 1min tcp 长连接保活时间，一般情况下不用修改，更应该关注 idleTimeout WithReadTimeout 3min 底层读取数据超时时间 WithIdleTimeout 3min 长连接请求链接空闲超时时间 WithMaxRequestBodySize 4 _ 1024 _ 1024 配置最大的请求体大小 WithRedirectTrailingSlash true 自动根据末尾的 / 转发，例如：如果 router 只有 /foo/，那么 /foo 会重定向到 /foo/ ；如果只有 /foo，那么 /foo/ 会重定向到 /foo WithRemoveExtraSlash false RemoveExtraSlash 当有额外的 / 时也可以当作参数。如：user/:name，如果开启该选项 user//xiaoming 也可匹配上参数 WithUnescapePathValues true 如果开启，请求路径会被自动转义（eg. ‘%2F’ -> ‘/’）。如果 UseRawPath 为 false（默认情况），则 UnescapePathValues 实际上为 true，因为 .URI().Path() 将被使用，它已经是转义后的。设置该参数为 false，需要配合 WithUseRawPath(true) WithUseRawPath false 如果开启，会使用原始 path 进行路由匹配 WithHandleMethodNotAllowed false 如果开启，当当前路径不能被匹配上时，server 会去检查其他方法是否注册了当前路径的路由，如果存在则会响应"Method Not Allowed"，并返回状态码 405; 如果没有，则会用 NotFound 的 handler 进行处理 WithDisablePreParseMultipartForm false 如果开启，则不会预处理 multipart form。可以通过 ctx.Request.Body() 获取到 body 后由用户处理 WithStreamBody false 如果开启，则会使用流式处理 body WithNetwork “tcp” 设置网络协议，可选：tcp，udp，unix（unix domain socket），默认为 tcp WithExitWaitTime 5s 设置优雅退出时间。Server 会停止建立新的连接，并对关闭后的每一个请求设置 Connection: Close 的 header，当到达设定的时间关闭 Server。当所有连接已经关闭时，Server 可以提前关闭 WithTLS nil 配置 server tls 能力，详情可见 TLS WithListenConfig nil 设置监听器配置，可用于设置是否允许 reuse port 等 WithALPN false 是否开启 ALPN WithTracer []interface{}{} 注入 tracer 实现，如不注入 Tracer 实现，默认关闭 WithTraceLevel LevelDetailed 设置 trace level WithWriteTimeout 无限长 写入数据超时时间 WithRedirectFixedPath false 如果开启，当当前请求路径不能匹配上时，server 会尝试修复请求路径并重新进行匹配，如果成功匹配并且为 GET 请求则会返回状态码 301 进行重定向，其他请求方式返回 308 进行重定向 WithBasePath / 设置基本路径，前缀和后缀必须为 / WithMaxKeepBodySize 4 _ 1024 _ 1024 设置回收时保留的请求体和响应体的最大大小。单位：字节 WithGetOnly false 如果开启则只接受 GET 请求 WithKeepAlive true 如果开启则使用 HTTP 长连接 WithAltTransport network.NewTransporter 设置备用 transport WithH2C false 设置是否开启 H2C WithReadBufferSize 4 * 1024 设置读缓冲区大小，同时限制 HTTP header 大小 WithRegistry registry.NoopRegistry, nil 设置注册中心配置，服务注册信息 WithAutoReloadRender false, 0 设置自动重载渲染配置 WithDisablePrintRoute false 设置是否禁用 debugPrintRoute WithOnAccept nil 设置在 netpoll 中当一个连接被接受但不能接收数据时的回调函数，在 go net 中在转换 TLS 连接之前被调用 WithOnConnect nil 设置 onConnect 函数。它可以接收来自 netpoll 连接的数据。在 go net 中，它将在转换 TLS 连接后被调用 WithDisableHeaderNamesNormalizing false 设置是否禁用 Request 和 Response Header 名字的规范化 (首字母和破折号后第一个字母大写) Server Connection 数量限制:'><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2023-08-18T00:00:00+00:00"><meta property="article:modified_time" content="2025-03-07T17:25:05+08:00"><meta itemprop=name content="Engine"><meta itemprop=description content='server.Hertz 是 Hertz 的核心类型，它由 route.Engine 以及 signalWaiter 组成，Hertz 服务器的启动、路由注册、中间件注册以及退出等重要方法均包含在 server.Hertz 中。以下是 server.Hertz 的定义：
type Hertz struct { *route.Engine // 用于接收信号以实现优雅退出 signalWaiter func (err chan error) error } route.Engine 为 server.Hertz 的重要组成部分，Engine 的定义位于 Engine。
配置 配置项 默认值 说明 WithTransport network.NewTransporter 更换底层 transport WithHostPorts :8888 指定监听的地址和端口 WithKeepAliveTimeout 1min tcp 长连接保活时间，一般情况下不用修改，更应该关注 idleTimeout WithReadTimeout 3min 底层读取数据超时时间 WithIdleTimeout 3min 长连接请求链接空闲超时时间 WithMaxRequestBodySize 4 _ 1024 _ 1024 配置最大的请求体大小 WithRedirectTrailingSlash true 自动根据末尾的 / 转发，例如：如果 router 只有 /foo/，那么 /foo 会重定向到 /foo/ ；如果只有 /foo，那么 /foo/ 会重定向到 /foo WithRemoveExtraSlash false RemoveExtraSlash 当有额外的 / 时也可以当作参数。如：user/:name，如果开启该选项 user//xiaoming 也可匹配上参数 WithUnescapePathValues true 如果开启，请求路径会被自动转义（eg. ‘%2F’ -> ‘/’）。如果 UseRawPath 为 false（默认情况），则 UnescapePathValues 实际上为 true，因为 .URI().Path() 将被使用，它已经是转义后的。设置该参数为 false，需要配合 WithUseRawPath(true) WithUseRawPath false 如果开启，会使用原始 path 进行路由匹配 WithHandleMethodNotAllowed false 如果开启，当当前路径不能被匹配上时，server 会去检查其他方法是否注册了当前路径的路由，如果存在则会响应"Method Not Allowed"，并返回状态码 405; 如果没有，则会用 NotFound 的 handler 进行处理 WithDisablePreParseMultipartForm false 如果开启，则不会预处理 multipart form。可以通过 ctx.Request.Body() 获取到 body 后由用户处理 WithStreamBody false 如果开启，则会使用流式处理 body WithNetwork “tcp” 设置网络协议，可选：tcp，udp，unix（unix domain socket），默认为 tcp WithExitWaitTime 5s 设置优雅退出时间。Server 会停止建立新的连接，并对关闭后的每一个请求设置 Connection: Close 的 header，当到达设定的时间关闭 Server。当所有连接已经关闭时，Server 可以提前关闭 WithTLS nil 配置 server tls 能力，详情可见 TLS WithListenConfig nil 设置监听器配置，可用于设置是否允许 reuse port 等 WithALPN false 是否开启 ALPN WithTracer []interface{}{} 注入 tracer 实现，如不注入 Tracer 实现，默认关闭 WithTraceLevel LevelDetailed 设置 trace level WithWriteTimeout 无限长 写入数据超时时间 WithRedirectFixedPath false 如果开启，当当前请求路径不能匹配上时，server 会尝试修复请求路径并重新进行匹配，如果成功匹配并且为 GET 请求则会返回状态码 301 进行重定向，其他请求方式返回 308 进行重定向 WithBasePath / 设置基本路径，前缀和后缀必须为 / WithMaxKeepBodySize 4 _ 1024 _ 1024 设置回收时保留的请求体和响应体的最大大小。单位：字节 WithGetOnly false 如果开启则只接受 GET 请求 WithKeepAlive true 如果开启则使用 HTTP 长连接 WithAltTransport network.NewTransporter 设置备用 transport WithH2C false 设置是否开启 H2C WithReadBufferSize 4 * 1024 设置读缓冲区大小，同时限制 HTTP header 大小 WithRegistry registry.NoopRegistry, nil 设置注册中心配置，服务注册信息 WithAutoReloadRender false, 0 设置自动重载渲染配置 WithDisablePrintRoute false 设置是否禁用 debugPrintRoute WithOnAccept nil 设置在 netpoll 中当一个连接被接受但不能接收数据时的回调函数，在 go net 中在转换 TLS 连接之前被调用 WithOnConnect nil 设置 onConnect 函数。它可以接收来自 netpoll 连接的数据。在 go net 中，它将在转换 TLS 连接后被调用 WithDisableHeaderNamesNormalizing false 设置是否禁用 Request 和 Response Header 名字的规范化 (首字母和破折号后第一个字母大写) Server Connection 数量限制:'><meta itemprop=datePublished content="2023-08-18T00:00:00+00:00"><meta itemprop=dateModified content="2025-03-07T17:25:05+08:00"><meta itemprop=wordCount content="1284"><meta name=twitter:card content="summary"><meta name=twitter:title content="Engine"><meta name=twitter:description content='server.Hertz 是 Hertz 的核心类型，它由 route.Engine 以及 signalWaiter 组成，Hertz 服务器的启动、路由注册、中间件注册以及退出等重要方法均包含在 server.Hertz 中。以下是 server.Hertz 的定义：
type Hertz struct { *route.Engine // 用于接收信号以实现优雅退出 signalWaiter func (err chan error) error } route.Engine 为 server.Hertz 的重要组成部分，Engine 的定义位于 Engine。
配置 配置项 默认值 说明 WithTransport network.NewTransporter 更换底层 transport WithHostPorts :8888 指定监听的地址和端口 WithKeepAliveTimeout 1min tcp 长连接保活时间，一般情况下不用修改，更应该关注 idleTimeout WithReadTimeout 3min 底层读取数据超时时间 WithIdleTimeout 3min 长连接请求链接空闲超时时间 WithMaxRequestBodySize 4 _ 1024 _ 1024 配置最大的请求体大小 WithRedirectTrailingSlash true 自动根据末尾的 / 转发，例如：如果 router 只有 /foo/，那么 /foo 会重定向到 /foo/ ；如果只有 /foo，那么 /foo/ 会重定向到 /foo WithRemoveExtraSlash false RemoveExtraSlash 当有额外的 / 时也可以当作参数。如：user/:name，如果开启该选项 user//xiaoming 也可匹配上参数 WithUnescapePathValues true 如果开启，请求路径会被自动转义（eg. ‘%2F’ -> ‘/’）。如果 UseRawPath 为 false（默认情况），则 UnescapePathValues 实际上为 true，因为 .URI().Path() 将被使用，它已经是转义后的。设置该参数为 false，需要配合 WithUseRawPath(true) WithUseRawPath false 如果开启，会使用原始 path 进行路由匹配 WithHandleMethodNotAllowed false 如果开启，当当前路径不能被匹配上时，server 会去检查其他方法是否注册了当前路径的路由，如果存在则会响应"Method Not Allowed"，并返回状态码 405; 如果没有，则会用 NotFound 的 handler 进行处理 WithDisablePreParseMultipartForm false 如果开启，则不会预处理 multipart form。可以通过 ctx.Request.Body() 获取到 body 后由用户处理 WithStreamBody false 如果开启，则会使用流式处理 body WithNetwork “tcp” 设置网络协议，可选：tcp，udp，unix（unix domain socket），默认为 tcp WithExitWaitTime 5s 设置优雅退出时间。Server 会停止建立新的连接，并对关闭后的每一个请求设置 Connection: Close 的 header，当到达设定的时间关闭 Server。当所有连接已经关闭时，Server 可以提前关闭 WithTLS nil 配置 server tls 能力，详情可见 TLS WithListenConfig nil 设置监听器配置，可用于设置是否允许 reuse port 等 WithALPN false 是否开启 ALPN WithTracer []interface{}{} 注入 tracer 实现，如不注入 Tracer 实现，默认关闭 WithTraceLevel LevelDetailed 设置 trace level WithWriteTimeout 无限长 写入数据超时时间 WithRedirectFixedPath false 如果开启，当当前请求路径不能匹配上时，server 会尝试修复请求路径并重新进行匹配，如果成功匹配并且为 GET 请求则会返回状态码 301 进行重定向，其他请求方式返回 308 进行重定向 WithBasePath / 设置基本路径，前缀和后缀必须为 / WithMaxKeepBodySize 4 _ 1024 _ 1024 设置回收时保留的请求体和响应体的最大大小。单位：字节 WithGetOnly false 如果开启则只接受 GET 请求 WithKeepAlive true 如果开启则使用 HTTP 长连接 WithAltTransport network.NewTransporter 设置备用 transport WithH2C false 设置是否开启 H2C WithReadBufferSize 4 * 1024 设置读缓冲区大小，同时限制 HTTP header 大小 WithRegistry registry.NoopRegistry, nil 设置注册中心配置，服务注册信息 WithAutoReloadRender false, 0 设置自动重载渲染配置 WithDisablePrintRoute false 设置是否禁用 debugPrintRoute WithOnAccept nil 设置在 netpoll 中当一个连接被接受但不能接收数据时的回调函数，在 go net 中在转换 TLS 连接之前被调用 WithOnConnect nil 设置 onConnect 函数。它可以接收来自 netpoll 连接的数据。在 go net 中，它将在转换 TLS 连接后被调用 WithDisableHeaderNamesNormalizing false 设置是否禁用 Request 和 Response Header 名字的规范化 (首字母和破折号后第一个字母大写) Server Connection 数量限制:'><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYWRQRLPRM"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QYWRQRLPRM")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?f1808c42af827f368aa7eca3baae6d55",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=preload href=/scss/main.min.b3c21c777309e05201dd625b8a4ece4076249bfa52b71d58c6e352d84c6c0320.css as=style><link href=/scss/main.min.b3c21c777309e05201dd625b8a4ece4076249bfa52b71d58c6e352d84c6c0320.css rel=stylesheet integrity><script src=/js/jquery.min.js></script><link rel=stylesheet href=/css/prism.css><link rel=stylesheet href=/css/docsearch.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYWRQRLPRM"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QYWRQRLPRM")}</script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand-xl navbar-dark td-navbar"><a class=navbar-brand href=/zh/><span class=navbar-logo><img src=/img/logo.png></span>
</a><button class=navbar-toggler type=button data-toggle=collapse data-target=#main_navbar aria-controls=main_navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0 ml-auto"><li class="dropdown sub-menu active"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>文档</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/docs/kitex/>Kitex</a>
<a class=dropdown-item href=/zh/docs/hertz/>Hertz</a>
<a class=dropdown-item href=/zh/docs/volo/>Volo</a>
<a class=dropdown-item href=/zh/docs/netpoll/>Netpoll</a>
<a class=dropdown-item href=/zh/docs/cwgo/>Cwgo</a>
<a class=dropdown-item href=/zh/docs/eino/>Eino</a></div></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/zh/about/><span>关于</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/zh/blog/><span>博客</span></a></li><li class="dropdown sub-menu"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>社区</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/community/overview/>概述</a>
<a class=dropdown-item href=/zh/community/meeting_notes/>会议记录</a>
<a class=dropdown-item href=/zh/community/weekly_report/>周报</a>
<a class=dropdown-item href=/zh/community/past_activities/>往期活动</a></div></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/zh/cooperation/><span>用户案例</span></a></li><li class="dropdown sub-menu"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>[new]企业级解决方案</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=https://www.volcengine.com/docs/6431/1469323>可观测解决方案</a></div></li><li class="dropdown sub-menu"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>安全</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/security/safety-bulletin/>安全公告</a>
<a class=dropdown-item href=/zh/security/vulnerability-reporting/>漏洞管理</a></div></li><li class="nav-item dropdown mr-4"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/docs/hertz/tutorials/basic-feature/engine/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><div id=docsearch></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div id=docsearch></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav foldable-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/docs/hertz/tutorials/basic-feature/engine/>English</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-zhdocs-li><a href=/zh/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-zhdocs><span>文档</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-zhdocshertz-li><input type=checkbox id=m-zhdocshertz-check checked>
<label for=m-zhdocshertz-check><a href=/zh/docs/hertz/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertz><span>Hertz</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertzoverview-li><input type=checkbox id=m-zhdocshertzoverview-check checked>
<label for=m-zhdocshertzoverview-check><a href=/zh/docs/hertz/overview/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertzoverview><span>概览</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertzgetting-started-li><input type=checkbox id=m-zhdocshertzgetting-started-check checked>
<label for=m-zhdocshertzgetting-started-check><a href=/zh/docs/hertz/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertzgetting-started><span>快速开始</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-zhdocshertztutorials-li><input type=checkbox id=m-zhdocshertztutorials-check checked>
<label for=m-zhdocshertztutorials-check><a href=/zh/docs/hertz/tutorials/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertztutorials><span>开发指南</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsexample-li><input type=checkbox id=m-zhdocshertztutorialsexample-check>
<label for=m-zhdocshertztutorialsexample-check><a href=/zh/docs/hertz/tutorials/example/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertztutorialsexample><span>代码示例</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-zhdocshertztutorialsbasic-feature-li><input type=checkbox id=m-zhdocshertztutorialsbasic-feature-check checked>
<label for=m-zhdocshertztutorialsbasic-feature-check><a href=/zh/docs/hertz/tutorials/basic-feature/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertztutorialsbasic-feature><span>基本特性</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-zhdocshertztutorialsbasic-featureengine-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featureengine-check checked>
<label for=m-zhdocshertztutorialsbasic-featureengine-check><a href=/zh/docs/hertz/tutorials/basic-feature/engine/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featureengine><span class=td-sidebar-nav-active-item>Engine</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featureroute-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featureroute-check>
<label for=m-zhdocshertztutorialsbasic-featureroute-check><a href=/zh/docs/hertz/tutorials/basic-feature/route/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featureroute><span>路由</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featureclient-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featureclient-check>
<label for=m-zhdocshertztutorialsbasic-featureclient-check><a href=/zh/docs/hertz/tutorials/basic-feature/client/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featureclient><span>客户端</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featurenetwork-lib-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featurenetwork-lib-check>
<label for=m-zhdocshertztutorialsbasic-featurenetwork-lib-check><a href=/zh/docs/hertz/tutorials/basic-feature/network-lib/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featurenetwork-lib><span>网络库</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhdocshertztutorialsbasic-featurecontext-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featurecontext-check>
<label for=m-zhdocshertztutorialsbasic-featurecontext-check><a href=/zh/docs/hertz/tutorials/basic-feature/context/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertztutorialsbasic-featurecontext><span>请求上下文</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featurecontextrequest-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featurecontextrequest-check>
<label for=m-zhdocshertztutorialsbasic-featurecontextrequest-check><a href=/zh/docs/hertz/tutorials/basic-feature/context/request/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featurecontextrequest><span>请求</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featurecontextresponse-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featurecontextresponse-check>
<label for=m-zhdocshertztutorialsbasic-featurecontextresponse-check><a href=/zh/docs/hertz/tutorials/basic-feature/context/response/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featurecontextresponse><span>响应</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhdocshertztutorialsbasic-featuremiddleware-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featuremiddleware-check>
<label for=m-zhdocshertztutorialsbasic-featuremiddleware-check><a href=/zh/docs/hertz/tutorials/basic-feature/middleware/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertztutorialsbasic-featuremiddleware><span>中间件概览</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featuremiddlewarebasic-auth-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featuremiddlewarebasic-auth-check>
<label for=m-zhdocshertztutorialsbasic-featuremiddlewarebasic-auth-check><a href=/zh/docs/hertz/tutorials/basic-feature/middleware/basic-auth/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featuremiddlewarebasic-auth><span>基本认证</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featuremiddlewarerecovery-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featuremiddlewarerecovery-check>
<label for=m-zhdocshertztutorialsbasic-featuremiddlewarerecovery-check><a href=/zh/docs/hertz/tutorials/basic-feature/middleware/recovery/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featuremiddlewarerecovery><span>Recovery</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featuretls-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featuretls-check>
<label for=m-zhdocshertztutorialsbasic-featuretls-check><a href=/zh/docs/hertz/tutorials/basic-feature/tls/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featuretls><span>TLS</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featurebinding-and-validate-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featurebinding-and-validate-check>
<label for=m-zhdocshertztutorialsbasic-featurebinding-and-validate-check><a href=/zh/docs/hertz/tutorials/basic-feature/binding-and-validate/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featurebinding-and-validate><span>绑定与校验</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featureerror-handle-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featureerror-handle-check>
<label for=m-zhdocshertztutorialsbasic-featureerror-handle-check><a href=/zh/docs/hertz/tutorials/basic-feature/error-handle/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featureerror-handle><span>错误处理</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featuregraceful-shutdown-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featuregraceful-shutdown-check>
<label for=m-zhdocshertztutorialsbasic-featuregraceful-shutdown-check><a href=/zh/docs/hertz/tutorials/basic-feature/graceful-shutdown/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featuregraceful-shutdown><span>优雅退出</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featureproxy-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featureproxy-check>
<label for=m-zhdocshertztutorialsbasic-featureproxy-check><a href=/zh/docs/hertz/tutorials/basic-feature/proxy/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featureproxy><span>正向代理和反向代理</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featureretry-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featureretry-check>
<label for=m-zhdocshertztutorialsbasic-featureretry-check><a href=/zh/docs/hertz/tutorials/basic-feature/retry/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featureretry><span>重试</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featurehooks-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featurehooks-check>
<label for=m-zhdocshertztutorialsbasic-featurehooks-check><a href=/zh/docs/hertz/tutorials/basic-feature/hooks/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featurehooks><span>Hooks</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featureunit-test-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featureunit-test-check>
<label for=m-zhdocshertztutorialsbasic-featureunit-test-check><a href=/zh/docs/hertz/tutorials/basic-feature/unit-test/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featureunit-test><span>单测</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featureadaptor-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featureadaptor-check>
<label for=m-zhdocshertztutorialsbasic-featureadaptor-check><a href=/zh/docs/hertz/tutorials/basic-feature/adaptor/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featureadaptor><span>适配器</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featureconstants-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featureconstants-check>
<label for=m-zhdocshertztutorialsbasic-featureconstants-check><a href=/zh/docs/hertz/tutorials/basic-feature/constants/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featureconstants><span>常量</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featurerender-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featurerender-check>
<label for=m-zhdocshertztutorialsbasic-featurerender-check><a href=/zh/docs/hertz/tutorials/basic-feature/render/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featurerender><span>渲染</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsbasic-featurejson-li><input type=checkbox id=m-zhdocshertztutorialsbasic-featurejson-check>
<label for=m-zhdocshertztutorialsbasic-featurejson-check><a href=/zh/docs/hertz/tutorials/basic-feature/json/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsbasic-featurejson><span>JSON Marshal 库</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhdocshertztutorialsobservability-li><input type=checkbox id=m-zhdocshertztutorialsobservability-check>
<label for=m-zhdocshertztutorialsobservability-check><a href=/zh/docs/hertz/tutorials/observability/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertztutorialsobservability><span>可观测性</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsobservabilitylog-li><input type=checkbox id=m-zhdocshertztutorialsobservabilitylog-check>
<label for=m-zhdocshertztutorialsobservabilitylog-check><a href=/zh/docs/hertz/tutorials/observability/log/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsobservabilitylog><span>日志</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsobservabilitytracing-li><input type=checkbox id=m-zhdocshertztutorialsobservabilitytracing-check>
<label for=m-zhdocshertztutorialsobservabilitytracing-check><a href=/zh/docs/hertz/tutorials/observability/tracing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsobservabilitytracing><span>链路追踪</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsobservabilityinstrumentation-li><input type=checkbox id=m-zhdocshertztutorialsobservabilityinstrumentation-check>
<label for=m-zhdocshertztutorialsobservabilityinstrumentation-check><a href=/zh/docs/hertz/tutorials/observability/instrumentation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsobservabilityinstrumentation><span>埋点</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhdocshertztutorialsframework-exten-li><input type=checkbox id=m-zhdocshertztutorialsframework-exten-check>
<label for=m-zhdocshertztutorialsframework-exten-check><a href=/zh/docs/hertz/tutorials/framework-exten/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertztutorialsframework-exten><span>框架扩展</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsframework-extenmonitor-li><input type=checkbox id=m-zhdocshertztutorialsframework-extenmonitor-check>
<label for=m-zhdocshertztutorialsframework-extenmonitor-check><a href=/zh/docs/hertz/tutorials/framework-exten/monitor/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsframework-extenmonitor><span>监控扩展</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsframework-extenlog-li><input type=checkbox id=m-zhdocshertztutorialsframework-extenlog-check>
<label for=m-zhdocshertztutorialsframework-extenlog-check><a href=/zh/docs/hertz/tutorials/framework-exten/log/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsframework-extenlog><span>日志扩展</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsframework-extenservice_discovery-li><input type=checkbox id=m-zhdocshertztutorialsframework-extenservice_discovery-check>
<label for=m-zhdocshertztutorialsframework-extenservice_discovery-check><a href=/zh/docs/hertz/tutorials/framework-exten/service_discovery/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsframework-extenservice_discovery><span>服务注册与发现扩展</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsframework-extennetwork-lib-li><input type=checkbox id=m-zhdocshertztutorialsframework-extennetwork-lib-check>
<label for=m-zhdocshertztutorialsframework-extennetwork-lib-check><a href=/zh/docs/hertz/tutorials/framework-exten/network-lib/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsframework-extennetwork-lib><span>网络库扩展</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsframework-extenprotocol-li><input type=checkbox id=m-zhdocshertztutorialsframework-extenprotocol-check>
<label for=m-zhdocshertztutorialsframework-extenprotocol-check><a href=/zh/docs/hertz/tutorials/framework-exten/protocol/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsframework-extenprotocol><span>协议扩展</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsframework-extenresponse_writer-li><input type=checkbox id=m-zhdocshertztutorialsframework-extenresponse_writer-check>
<label for=m-zhdocshertztutorialsframework-extenresponse_writer-check><a href=/zh/docs/hertz/tutorials/framework-exten/response_writer/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsframework-extenresponse_writer><span>Response 的 Writer 扩展</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhdocshertztutorialstoolkit-li><input type=checkbox id=m-zhdocshertztutorialstoolkit-check>
<label for=m-zhdocshertztutorialstoolkit-check><a href=/zh/docs/hertz/tutorials/toolkit/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertztutorialstoolkit><span>hz 代码生成</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialstoolkitinstall-li><input type=checkbox id=m-zhdocshertztutorialstoolkitinstall-check>
<label for=m-zhdocshertztutorialstoolkitinstall-check><a href=/zh/docs/hertz/tutorials/toolkit/install/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialstoolkitinstall><span>hz 安装</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialstoolkitusage-li><input type=checkbox id=m-zhdocshertztutorialstoolkitusage-check>
<label for=m-zhdocshertztutorialstoolkitusage-check><a href=/zh/docs/hertz/tutorials/toolkit/usage/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialstoolkitusage><span>hz 的基本使用</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialstoolkitusage-thrift-li><input type=checkbox id=m-zhdocshertztutorialstoolkitusage-thrift-check>
<label for=m-zhdocshertztutorialstoolkitusage-thrift-check><a href=/zh/docs/hertz/tutorials/toolkit/usage-thrift/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialstoolkitusage-thrift><span>hz 使用 (thrift)</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialstoolkitusage-protobuf-li><input type=checkbox id=m-zhdocshertztutorialstoolkitusage-protobuf-check>
<label for=m-zhdocshertztutorialstoolkitusage-protobuf-check><a href=/zh/docs/hertz/tutorials/toolkit/usage-protobuf/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialstoolkitusage-protobuf><span>hz 使用 (protobuf)</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialstoolkitlayout-li><input type=checkbox id=m-zhdocshertztutorialstoolkitlayout-check>
<label for=m-zhdocshertztutorialstoolkitlayout-check><a href=/zh/docs/hertz/tutorials/toolkit/layout/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialstoolkitlayout><span>hz 生成代码的结构</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialstoolkitannotation-li><input type=checkbox id=m-zhdocshertztutorialstoolkitannotation-check>
<label for=m-zhdocshertztutorialstoolkitannotation-check><a href=/zh/docs/hertz/tutorials/toolkit/annotation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialstoolkitannotation><span>IDL 注解说明</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialstoolkitcommand-li><input type=checkbox id=m-zhdocshertztutorialstoolkitcommand-check>
<label for=m-zhdocshertztutorialstoolkitcommand-check><a href=/zh/docs/hertz/tutorials/toolkit/command/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialstoolkitcommand><span>hz 命令梳理</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialstoolkitcautions-li><input type=checkbox id=m-zhdocshertztutorialstoolkitcautions-check>
<label for=m-zhdocshertztutorialstoolkitcautions-check><a href=/zh/docs/hertz/tutorials/toolkit/cautions/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialstoolkitcautions><span>注意事项</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhdocshertztutorialstoolkitmore-feature-li><input type=checkbox id=m-zhdocshertztutorialstoolkitmore-feature-check>
<label for=m-zhdocshertztutorialstoolkitmore-feature-check><a href=/zh/docs/hertz/tutorials/toolkit/more-feature/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertztutorialstoolkitmore-feature><span>更多特性</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialstoolkitmore-featuretemplate-li><input type=checkbox id=m-zhdocshertztutorialstoolkitmore-featuretemplate-check>
<label for=m-zhdocshertztutorialstoolkitmore-featuretemplate-check><a href=/zh/docs/hertz/tutorials/toolkit/more-feature/template/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialstoolkitmore-featuretemplate><span>hz 自定义模板使用</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialstoolkitmore-featureplugin-li><input type=checkbox id=m-zhdocshertztutorialstoolkitmore-featureplugin-check>
<label for=m-zhdocshertztutorialstoolkitmore-featureplugin-check><a href=/zh/docs/hertz/tutorials/toolkit/more-feature/plugin/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialstoolkitmore-featureplugin><span>hz 接入第三方生成代码插件</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialstoolkitmore-featureclient-li><input type=checkbox id=m-zhdocshertztutorialstoolkitmore-featureclient-check>
<label for=m-zhdocshertztutorialstoolkitmore-featureclient-check><a href=/zh/docs/hertz/tutorials/toolkit/more-feature/client/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialstoolkitmore-featureclient><span>hz client 代码生成</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialstoolkitmore-featureapi_none-li><input type=checkbox id=m-zhdocshertztutorialstoolkitmore-featureapi_none-check>
<label for=m-zhdocshertztutorialstoolkitmore-featureapi_none-check><a href=/zh/docs/hertz/tutorials/toolkit/more-feature/api_none/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialstoolkitmore-featureapi_none><span>api.none 注解说明</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhdocshertztutorialsthird-party-li><input type=checkbox id=m-zhdocshertztutorialsthird-party-check>
<label for=m-zhdocshertztutorialsthird-party-check><a href=/zh/docs/hertz/tutorials/third-party/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertztutorialsthird-party><span>三方扩展</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhdocshertztutorialsthird-partyprotocol-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyprotocol-check>
<label for=m-zhdocshertztutorialsthird-partyprotocol-check><a href=/zh/docs/hertz/tutorials/third-party/protocol/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertztutorialsthird-partyprotocol><span>协议</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partyprotocolhttp2-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyprotocolhttp2-check>
<label for=m-zhdocshertztutorialsthird-partyprotocolhttp2-check><a href=/zh/docs/hertz/tutorials/third-party/protocol/http2/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partyprotocolhttp2><span>HTTP2</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partyprotocolhttp3-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyprotocolhttp3-check>
<label for=m-zhdocshertztutorialsthird-partyprotocolhttp3-check><a href=/zh/docs/hertz/tutorials/third-party/protocol/http3/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partyprotocolhttp3><span>HTTP3</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partyprotocolwebsocket-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyprotocolwebsocket-check>
<label for=m-zhdocshertztutorialsthird-partyprotocolwebsocket-check><a href=/zh/docs/hertz/tutorials/third-party/protocol/websocket/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partyprotocolwebsocket><span>Websocket</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partyprotocolsse-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyprotocolsse-check>
<label for=m-zhdocshertztutorialsthird-partyprotocolsse-check><a href=/zh/docs/hertz/tutorials/third-party/protocol/sse/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partyprotocolsse><span>SSE</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhdocshertztutorialsthird-partymiddleware-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddleware-check>
<label for=m-zhdocshertztutorialsthird-partymiddleware-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertztutorialsthird-partymiddleware><span>中间件</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewarecors-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewarecors-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewarecors-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/cors/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewarecors><span>跨源资源共享</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewarejwt-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewarejwt-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewarejwt-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/jwt/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewarejwt><span>JWT 认证</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewaregzip-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewaregzip-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewaregzip-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/gzip/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewaregzip><span>Gzip 压缩</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewarei18n-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewarei18n-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewarei18n-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/i18n/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewarei18n><span>国际化</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewaresession-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewaresession-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewaresession-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/session/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewaresession><span>Session 扩展</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewarepprof-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewarepprof-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewarepprof-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/pprof/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewarepprof><span>Pprof</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewarekeyauth-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewarekeyauth-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewarekeyauth-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/keyauth/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewarekeyauth><span>KeyAuth</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewareswagger-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewareswagger-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewareswagger-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/swagger/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewareswagger><span>Swagger</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewarerequestid-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewarerequestid-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewarerequestid-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/requestid/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewarerequestid><span>Request ID</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewareaccess-log-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewareaccess-log-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewareaccess-log-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/access-log/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewareaccess-log><span>访问日志</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewaresecure-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewaresecure-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewaresecure-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/secure/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewaresecure><span>Secure</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewaresentry-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewaresentry-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewaresentry-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/sentry/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewaresentry><span>Sentry</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewarecsrf-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewarecsrf-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewarecsrf-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/csrf/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewarecsrf><span>CSRF</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewarecasbin-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewarecasbin-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewarecasbin-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/casbin/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewarecasbin><span>Casbin</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewareetag-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewareetag-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewareetag-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/etag/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewareetag><span>ETag</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewarecache-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewarecache-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewarecache-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/cache/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewarecache><span>Cache</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partymiddlewarepaseto-li><input type=checkbox id=m-zhdocshertztutorialsthird-partymiddlewarepaseto-check>
<label for=m-zhdocshertztutorialsthird-partymiddlewarepaseto-check><a href=/zh/docs/hertz/tutorials/third-party/middleware/paseto/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partymiddlewarepaseto><span>Paseto</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhdocshertztutorialsthird-partyservice_discovery-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyservice_discovery-check>
<label for=m-zhdocshertztutorialsthird-partyservice_discovery-check><a href=/zh/docs/hertz/tutorials/third-party/service_discovery/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertztutorialsthird-partyservice_discovery><span>服务注册与发现</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partyservice_discoverynacos-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyservice_discoverynacos-check>
<label for=m-zhdocshertztutorialsthird-partyservice_discoverynacos-check><a href=/zh/docs/hertz/tutorials/third-party/service_discovery/nacos/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partyservice_discoverynacos><span>nacos</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partyservice_discoveryconsul-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyservice_discoveryconsul-check>
<label for=m-zhdocshertztutorialsthird-partyservice_discoveryconsul-check><a href=/zh/docs/hertz/tutorials/third-party/service_discovery/consul/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partyservice_discoveryconsul><span>consul</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partyservice_discoveryetcd-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyservice_discoveryetcd-check>
<label for=m-zhdocshertztutorialsthird-partyservice_discoveryetcd-check><a href=/zh/docs/hertz/tutorials/third-party/service_discovery/etcd/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partyservice_discoveryetcd><span>etcd</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partyservice_discoveryeureka-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyservice_discoveryeureka-check>
<label for=m-zhdocshertztutorialsthird-partyservice_discoveryeureka-check><a href=/zh/docs/hertz/tutorials/third-party/service_discovery/eureka/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partyservice_discoveryeureka><span>eureka</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partyservice_discoverypolaris-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyservice_discoverypolaris-check>
<label for=m-zhdocshertztutorialsthird-partyservice_discoverypolaris-check><a href=/zh/docs/hertz/tutorials/third-party/service_discovery/polaris/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partyservice_discoverypolaris><span>polaris</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partyservice_discoveryservicecomb-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyservice_discoveryservicecomb-check>
<label for=m-zhdocshertztutorialsthird-partyservice_discoveryservicecomb-check><a href=/zh/docs/hertz/tutorials/third-party/service_discovery/servicecomb/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partyservice_discoveryservicecomb><span>servicecomb</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partyservice_discoveryzookeeper-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyservice_discoveryzookeeper-check>
<label for=m-zhdocshertztutorialsthird-partyservice_discoveryzookeeper-check><a href=/zh/docs/hertz/tutorials/third-party/service_discovery/zookeeper/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partyservice_discoveryzookeeper><span>zookeeper</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partyservice_discoveryredis-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyservice_discoveryredis-check>
<label for=m-zhdocshertztutorialsthird-partyservice_discoveryredis-check><a href=/zh/docs/hertz/tutorials/third-party/service_discovery/redis/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partyservice_discoveryredis><span>redis</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhdocshertztutorialsthird-partylog-li><input type=checkbox id=m-zhdocshertztutorialsthird-partylog-check>
<label for=m-zhdocshertztutorialsthird-partylog-check><a href=/zh/docs/hertz/tutorials/third-party/log/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertztutorialsthird-partylog><span>日志</span></a></label><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partyloglogrus-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyloglogrus-check>
<label for=m-zhdocshertztutorialsthird-partyloglogrus-check><a href=/zh/docs/hertz/tutorials/third-party/log/logrus/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partyloglogrus><span>logrus</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partylogzap-li><input type=checkbox id=m-zhdocshertztutorialsthird-partylogzap-check>
<label for=m-zhdocshertztutorialsthird-partylogzap-check><a href=/zh/docs/hertz/tutorials/third-party/log/zap/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partylogzap><span>zap</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partylogzerolog-li><input type=checkbox id=m-zhdocshertztutorialsthird-partylogzerolog-check>
<label for=m-zhdocshertztutorialsthird-partylogzerolog-check><a href=/zh/docs/hertz/tutorials/third-party/log/zerolog/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partylogzerolog><span>zerolog</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partylogslog-li><input type=checkbox id=m-zhdocshertztutorialsthird-partylogslog-check>
<label for=m-zhdocshertztutorialsthird-partylogslog-check><a href=/zh/docs/hertz/tutorials/third-party/log/slog/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partylogslog><span>slog</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partyprometheus-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyprometheus-check>
<label for=m-zhdocshertztutorialsthird-partyprometheus-check><a href=/zh/docs/hertz/tutorials/third-party/prometheus/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partyprometheus><span>Prometheus</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partyopen-telemetry-li><input type=checkbox id=m-zhdocshertztutorialsthird-partyopen-telemetry-check>
<label for=m-zhdocshertztutorialsthird-partyopen-telemetry-check><a href=/zh/docs/hertz/tutorials/third-party/open-telemetry/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partyopen-telemetry><span>OpenTelemetry</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsthird-partysentinel-li><input type=checkbox id=m-zhdocshertztutorialsthird-partysentinel-check>
<label for=m-zhdocshertztutorialsthird-partysentinel-check><a href=/zh/docs/hertz/tutorials/third-party/sentinel/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertztutorialsthird-partysentinel><span>Sentinel</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertztutorialsservice-migration-li><input type=checkbox id=m-zhdocshertztutorialsservice-migration-check>
<label for=m-zhdocshertztutorialsservice-migration-check><a href=/zh/docs/hertz/tutorials/service-migration/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertztutorialsservice-migration><span>迁移到 Hertz</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertzfaq-li><input type=checkbox id=m-zhdocshertzfaq-check checked>
<label for=m-zhdocshertzfaq-check><a href=/zh/docs/hertz/faq/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertzfaq><span>常见问题</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhdocshertzreference-li><input type=checkbox id=m-zhdocshertzreference-check checked>
<label for=m-zhdocshertzreference-check><a href=/zh/docs/hertz/reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhdocshertzreference><span>参考</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertzreferenceconfig-li><input type=checkbox id=m-zhdocshertzreferenceconfig-check>
<label for=m-zhdocshertzreferenceconfig-check><a href=/zh/docs/hertz/reference/config/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertzreferenceconfig><span>配置说明</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhdocshertzreferenceversion-li><input type=checkbox id=m-zhdocshertzreferenceversion-check>
<label for=m-zhdocshertzreferenceversion-check><a href=/zh/docs/hertz/reference/version/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhdocshertzreferenceversion><span>版本说明</span></a></label></li></ul></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/cloudwego/cloudwego.github.io/edit/main/content/zh//docs/hertz/tutorials/basic-feature/engine target=_blank><i class="fa fa-edit fa-fw"></i> 编辑此页</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/new/main/content/zh//docs/hertz/tutorials/basic-feature/engine?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> 添加子页面</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/issues/new?labels=bug&amp;template=DOCS_UPDATE.md&amp;title=Engine" target=_blank><i class="fab fa-github fa-fw"></i> 提交文档问题</a>
<a href=https://github.com/cloudwego/hertz/issues/new/choose target=_blank><i class="fas fa-tasks fa-fw"></i> 提交项目问题</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#配置>配置</a></li><li><a href=#初始化服务>初始化服务</a><ul><li><a href=#default>Default</a></li><li><a href=#new>New</a></li></ul></li><li><a href=#服务运行与退出>服务运行与退出</a><ul><li><a href=#spin>Spin</a></li><li><a href=#run>Run</a></li><li><a href=#setcustomsignalwaiter>SetCustomSignalWaiter</a></li></ul></li><li><a href=#中间件>中间件</a><ul><li><a href=#use>Use</a></li></ul></li><li><a href=#流式处理>流式处理</a><ul><li><a href=#流式读>流式读</a></li><li><a href=#流式写>流式写</a></li></ul></li><li><a href=#注册自定义协议>注册自定义协议</a></li><li><a href=#setclientipfunc>SetClientIPFunc</a></li><li><a href=#setformvaluefunc>SetFormValueFunc</a></li><li><a href=#钩子函数>钩子函数</a></li><li><a href=#panic-处理函数>Panic 处理函数</a></li><li><a href=#continuehandler>ContinueHandler</a></li><li><a href=#渲染-template>渲染 template</a></li><li><a href=#noroute-与-nomethod-使用>NoRoute 与 NoMethod 使用</a></li><li><a href=#获取路由信息>获取路由信息</a><ul><li><a href=#routes>Routes</a></li></ul></li><li><a href=#底层网络库>底层网络库</a><ul><li><a href=#gettransportername>GetTransporterName</a></li><li><a href=#settransporter>SetTransporter</a></li></ul></li><li><a href=#链路追踪>链路追踪</a></li><li><a href=#hijack>Hijack</a><ul><li><a href=#nohijackconnpool>NoHijackConnPool</a></li><li><a href=#hijackconnhandle>HijackConnHandle</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://www.cloudwego.io/zh/docs/>文档</a></li><li class=breadcrumb-item><a href=https://www.cloudwego.io/zh/docs/hertz/>Hertz</a></li><li class=breadcrumb-item><a href=https://www.cloudwego.io/zh/docs/hertz/tutorials/>开发指南</a></li><li class=breadcrumb-item><a href=https://www.cloudwego.io/zh/docs/hertz/tutorials/basic-feature/>基本特性</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://www.cloudwego.io/zh/docs/hertz/tutorials/basic-feature/engine/>Engine</a></li></ol></nav><div class=td-content><h1>Engine</h1><header class=article-meta></header><p><code>server.Hertz</code> 是 <code>Hertz</code> 的核心类型，它由 <code>route.Engine</code> 以及 <code>signalWaiter</code> 组成，<code>Hertz</code> 服务器的启动、路由注册、中间件注册以及退出等重要方法均包含在 <code>server.Hertz</code> 中。以下是 <code>server.Hertz</code> 的定义：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Hertz</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>route</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Engine</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// 用于接收信号以实现优雅退出</span>
</span></span><span style=display:flex><span>    <span style=color:#000>signalWaiter</span> <span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>error</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><code>route.Engine</code> 为 <code>server.Hertz</code> 的重要组成部分，<code>Engine</code> 的定义位于 <a href=https://github.com/cloudwego/hertz/blob/main/pkg/route/engine.go>Engine</a>。</p><h2 id=配置>配置</h2><table><thead><tr><th style=text-align:left>配置项</th><th style=text-align:left>默认值</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>WithTransport</td><td style=text-align:left>network.NewTransporter</td><td style=text-align:left>更换底层 transport</td></tr><tr><td style=text-align:left>WithHostPorts</td><td style=text-align:left><code>:8888</code></td><td style=text-align:left>指定监听的地址和端口</td></tr><tr><td style=text-align:left>WithKeepAliveTimeout</td><td style=text-align:left>1min</td><td style=text-align:left>tcp 长连接保活时间，一般情况下不用修改，更应该关注 idleTimeout</td></tr><tr><td style=text-align:left>WithReadTimeout</td><td style=text-align:left>3min</td><td style=text-align:left>底层读取数据超时时间</td></tr><tr><td style=text-align:left>WithIdleTimeout</td><td style=text-align:left>3min</td><td style=text-align:left>长连接请求链接空闲超时时间</td></tr><tr><td style=text-align:left>WithMaxRequestBodySize</td><td style=text-align:left>4 _ 1024 _ 1024</td><td style=text-align:left>配置最大的请求体大小</td></tr><tr><td style=text-align:left>WithRedirectTrailingSlash</td><td style=text-align:left>true</td><td style=text-align:left>自动根据末尾的 / 转发，例如：如果 router 只有 /foo/，那么 /foo 会重定向到 /foo/ ；如果只有 /foo，那么 /foo/ 会重定向到 /foo</td></tr><tr><td style=text-align:left>WithRemoveExtraSlash</td><td style=text-align:left>false</td><td style=text-align:left>RemoveExtraSlash 当有额外的 / 时也可以当作参数。如：user/:name，如果开启该选项 user//xiaoming 也可匹配上参数</td></tr><tr><td style=text-align:left>WithUnescapePathValues</td><td style=text-align:left>true</td><td style=text-align:left>如果开启，请求路径会被自动转义（eg. &lsquo;%2F&rsquo; -> &lsquo;/&rsquo;）。如果 UseRawPath 为 false（默认情况），则 UnescapePathValues 实际上为 true，因为 .URI().Path() 将被使用，它已经是转义后的。设置该参数为 false，需要配合 WithUseRawPath(true)</td></tr><tr><td style=text-align:left>WithUseRawPath</td><td style=text-align:left>false</td><td style=text-align:left>如果开启，会使用原始 path 进行路由匹配</td></tr><tr><td style=text-align:left>WithHandleMethodNotAllowed</td><td style=text-align:left>false</td><td style=text-align:left>如果开启，当当前路径不能被匹配上时，server 会去检查其他方法是否注册了当前路径的路由，如果存在则会响应"Method Not Allowed"，并返回状态码 405; 如果没有，则会用 NotFound 的 handler 进行处理</td></tr><tr><td style=text-align:left>WithDisablePreParseMultipartForm</td><td style=text-align:left>false</td><td style=text-align:left>如果开启，则不会预处理 multipart form。可以通过 ctx.Request.Body() 获取到 body 后由用户处理</td></tr><tr><td style=text-align:left>WithStreamBody</td><td style=text-align:left>false</td><td style=text-align:left>如果开启，则会使用流式处理 body</td></tr><tr><td style=text-align:left>WithNetwork</td><td style=text-align:left>&ldquo;tcp&rdquo;</td><td style=text-align:left>设置网络协议，可选：tcp，udp，unix（unix domain socket），默认为 tcp</td></tr><tr><td style=text-align:left>WithExitWaitTime</td><td style=text-align:left>5s</td><td style=text-align:left>设置优雅退出时间。Server 会停止建立新的连接，并对关闭后的每一个请求设置 Connection: Close 的 header，当到达设定的时间关闭 Server。当所有连接已经关闭时，Server 可以提前关闭</td></tr><tr><td style=text-align:left>WithTLS</td><td style=text-align:left>nil</td><td style=text-align:left>配置 server tls 能力，详情可见 <a href=/zh/docs/hertz/tutorials/basic-feature/tls/>TLS</a></td></tr><tr><td style=text-align:left>WithListenConfig</td><td style=text-align:left>nil</td><td style=text-align:left>设置监听器配置，可用于设置是否允许 reuse port 等</td></tr><tr><td style=text-align:left>WithALPN</td><td style=text-align:left>false</td><td style=text-align:left>是否开启 ALPN</td></tr><tr><td style=text-align:left>WithTracer</td><td style=text-align:left>[]interface{}{}</td><td style=text-align:left>注入 tracer 实现，如不注入 Tracer 实现，默认关闭</td></tr><tr><td style=text-align:left>WithTraceLevel</td><td style=text-align:left>LevelDetailed</td><td style=text-align:left>设置 trace level</td></tr><tr><td style=text-align:left>WithWriteTimeout</td><td style=text-align:left>无限长</td><td style=text-align:left>写入数据超时时间</td></tr><tr><td style=text-align:left>WithRedirectFixedPath</td><td style=text-align:left>false</td><td style=text-align:left>如果开启，当当前请求路径不能匹配上时，server 会尝试修复请求路径并重新进行匹配，如果成功匹配并且为 GET 请求则会返回状态码 301 进行重定向，其他请求方式返回 308 进行重定向</td></tr><tr><td style=text-align:left>WithBasePath</td><td style=text-align:left><code>/</code></td><td style=text-align:left>设置基本路径，前缀和后缀必须为 <code>/</code></td></tr><tr><td style=text-align:left>WithMaxKeepBodySize</td><td style=text-align:left>4 _ 1024 _ 1024</td><td style=text-align:left>设置回收时保留的请求体和响应体的最大大小。单位：字节</td></tr><tr><td style=text-align:left>WithGetOnly</td><td style=text-align:left>false</td><td style=text-align:left>如果开启则只接受 GET 请求</td></tr><tr><td style=text-align:left>WithKeepAlive</td><td style=text-align:left>true</td><td style=text-align:left>如果开启则使用 HTTP 长连接</td></tr><tr><td style=text-align:left>WithAltTransport</td><td style=text-align:left>network.NewTransporter</td><td style=text-align:left>设置备用 transport</td></tr><tr><td style=text-align:left>WithH2C</td><td style=text-align:left>false</td><td style=text-align:left>设置是否开启 H2C</td></tr><tr><td style=text-align:left>WithReadBufferSize</td><td style=text-align:left>4 * 1024</td><td style=text-align:left>设置读缓冲区大小，同时限制 HTTP header 大小</td></tr><tr><td style=text-align:left>WithRegistry</td><td style=text-align:left>registry.NoopRegistry, nil</td><td style=text-align:left>设置注册中心配置，服务注册信息</td></tr><tr><td style=text-align:left>WithAutoReloadRender</td><td style=text-align:left>false, 0</td><td style=text-align:left>设置自动重载渲染配置</td></tr><tr><td style=text-align:left>WithDisablePrintRoute</td><td style=text-align:left>false</td><td style=text-align:left>设置是否禁用 debugPrintRoute</td></tr><tr><td style=text-align:left>WithOnAccept</td><td style=text-align:left>nil</td><td style=text-align:left>设置在 netpoll 中当一个连接被接受但不能接收数据时的回调函数，在 go net 中在转换 TLS 连接之前被调用</td></tr><tr><td style=text-align:left>WithOnConnect</td><td style=text-align:left>nil</td><td style=text-align:left>设置 onConnect 函数。它可以接收来自 netpoll 连接的数据。在 go net 中，它将在转换 TLS 连接后被调用</td></tr><tr><td style=text-align:left>WithDisableHeaderNamesNormalizing</td><td style=text-align:left>false</td><td style=text-align:left>设置是否禁用 Request 和 Response Header 名字的规范化 (首字母和破折号后第一个字母大写)</td></tr></tbody></table><p>Server Connection 数量限制:</p><ul><li>如果是使用标准网络库，无此限制</li><li>如果是使用 netpoll，最大连接数为 10000
（这个是 netpoll 底层使用的 <a href=https://github.com/bytedance/gopkg/blob/b9c1c36b51a6837cef4c2223e11522e3a647460c/util/gopool/gopool.go#L46>gopool</a>
）控制的，修改方式也很简单，调用 gopool 提供的函数即可：<code>gopool.SetCap(xxx)</code>(main.go 中调用一次即可)。</li></ul><p>Server 侧的配置项均在初始化 Server 时采用 <code>server.WithXXX</code> 的方式，如：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>New</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithXXXX</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=初始化服务>初始化服务</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>Default</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>opts</span> <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Hertz</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>New</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>opts</span> <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Hertz</span>
</span></span></code></pre></div><h3 id=default>Default</h3><p><code>Default</code> 用于初始化服务，默认使用了 <code>Recovery</code> 中间件以保证服务在运行时不会因为 <code>panic</code> 导致服务崩溃。</p><p>函数签名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>Default</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>opts</span> <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Hertz</span>
</span></span></code></pre></div><p>示例代码：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Default</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=new>New</h3><p><code>New</code> 用于初始化服务，没有使用默认的 <code>Recovery</code> 中间件。</p><p>函数签名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>New</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>opts</span> <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Hertz</span>
</span></span></code></pre></div><p>示例代码：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>New</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=服务运行与退出>服务运行与退出</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Hertz</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>Spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>engine</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Engine</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>Run</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Hertz</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>SetCustomSignalWaiter</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>f</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h3 id=spin>Spin</h3><p><code>Spin</code> 函数用于运行 Hertz 服务器，接收到退出信号后可退出服务。</p><p>该函数支持服务的优雅退出，优雅退出的详细内容请看 <a href=/zh/docs/hertz/tutorials/basic-feature/graceful-shutdown/>优雅退出</a>。</p><p>在使用 <a href=/zh/docs/hertz/tutorials/third-party/service_discovery/>服务注册发现</a> 的功能时，<code>Spin</code> 会在服务启动时将服务注册进入注册中心，并使用 <code>signalWaiter</code> 监测服务异常。</p><p>函数签名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Hertz</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>Spin</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>示例代码：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Default</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=run>Run</h3><p><code>Run</code> 函数用于运行 Hertz 服务器，接收到退出信号后可退出服务。</p><p>该函数不支持服务的优雅退出，除非有<strong>特殊</strong>需求，不然一般使用 <a href=/zh/docs/hertz/tutorials/basic-feature/engine/#spin>Spin</a> 函数用于运行服务。</p><p>函数签名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>engine</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Engine</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>Run</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>示例代码：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Default</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Run</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>    	<span style=color:#204a87>panic</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=setcustomsignalwaiter>SetCustomSignalWaiter</h3><p><code>SetCustomSignalWaiter</code> 函数用于自定义服务器接收信号后的处理函数，若没有设置自定义函数，Hertz 使用 <code>waitSignal</code> 函数作为信号处理的默认实现方式，详细内容请看 <a href=/zh/docs/hertz/tutorials/basic-feature/graceful-shutdown/>优雅退出</a>。</p><p>函数签名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Hertz</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>SetCustomSignalWaiter</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>f</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>示例代码：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>New</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>	<span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetCustomSignalWaiter</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>error</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>nil</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span>	<span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=中间件>中间件</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>engine</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Engine</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>Use</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>middleware</span> <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HandlerFunc</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>IRoutes</span>
</span></span></code></pre></div><h3 id=use>Use</h3><p><code>Use</code> 函数用于将中间件注册进入路由。</p><p>Hertz 支持用户自定义中间件，Hertz 已经实现了一些常用的中间件，详情见 <a href=https://github.com/hertz-contrib>hertz-contrib</a>。</p><p>Hertz 支持的中间件的使用方法包括<strong>全局注册</strong>、<strong>路由组</strong>级别和<strong>单一路由</strong>级别的注册，详情见 <a href=/zh/docs/hertz/tutorials/basic-feature/middleware/#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B8%AD%E9%97%B4%E4%BB%B6>服务端中间件</a>。</p><p><code>Use</code> 函数中 <code>middleware</code> 的形参必须为 <code>app.HandlerFunc</code> 的 http 处理函数：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>HandlerFunc</span> <span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestContext</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>函数签名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>engine</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Engine</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>Use</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>middleware</span> <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HandlerFunc</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>IRoutes</span>
</span></span></code></pre></div><p>示例代码：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>New</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// 将内置的 Recovery 中间件注册进入路由</span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Use</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>recovery</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Recovery</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// 使用自定义的中间件</span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Use</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>exampleMiddleware</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>exampleMiddleware</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HandlerFunc</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestContext</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 在 Next 中的函数执行之前打印日志</span>
</span></span><span style=display:flex><span>        <span style=color:#000>hlog</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Info</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;print before...&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 使用 Next 使得路由匹配的函数执行</span>
</span></span><span style=display:flex><span>        <span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Next</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 在 Next 中的函数执行之后打印日志</span>
</span></span><span style=display:flex><span>        <span style=color:#000>hlog</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Info</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;print after...&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=流式处理>流式处理</h2><p>Hertz 支持 Server 的流式处理，包括流式读和流式写。</p><blockquote><p>注意：由于 netpoll 和 go net 触发模式不同，netpoll 流式为“伪”流式（由于 LT 触发，会由网络库将数据读取到网络库的 buffer 中），在大包的场景下（如：上传文件等）可能会有内存问题，推荐使用 go net。</p></blockquote><h3 id=流式读>流式读</h3><p>Hertz Server 支持流式读取请求内容。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Default</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithHostPorts</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;127.0.0.1:8080&#34;</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithStreamBody</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithTransport</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>standard</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTransporter</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>POST</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/bodyStream&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>handler</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>handler</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestContext</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// Acquire body streaming</span>
</span></span><span style=display:flex><span>	<span style=color:#000>bodyStream</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestBodyStream</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// Read half of body bytes</span>
</span></span><span style=display:flex><span>	<span style=color:#000>p</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>([]</span><span style=color:#204a87;font-weight:700>byte</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Request</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Header</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ContentLength</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000>r</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>bodyStream</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Read</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>p</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87>panic</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>	<span style=color:#000>left</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>ioutil</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ReadAll</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>bodyStream</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>consts</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>StatusOK</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;bytes streaming_read: %d\nbytes left: %d\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>r</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>left</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=流式写>流式写</h3><p>Hertz Server 支持流式写入响应。</p><p>提供了两种方式：</p><ol><li><p>用户在 handler 中通过 <code>ctx.SetBodyStream</code> 函数传入一个 <code>io.Reader</code>，然后按与示例代码（利用 channel 控制数据分块及读写顺序）类似的方式分块读写数据。<strong>注意，数据需异步写入。</strong></p><p>若用户事先知道传输数据的总长度，可以在 <code>ctx.SetBodyStream</code> 函数中传入该长度进行流式写，示例代码如 <code>/streamWrite1</code>。</p><p>若用户事先不知道传输数据的总长度，可以在 <code>ctx.SetBodyStream</code> 函数中传入 -1 以 <code>Transfer-Encoding: chunked</code> 的方式进行流式写，示例代码如 <code>/streamWrite2</code>。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Default</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithHostPorts</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;127.0.0.1:8080&#34;</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithStreamBody</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithTransport</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>standard</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTransporter</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GET</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/streamWrite1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestContext</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rw</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>newChunkReader</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#000>line</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87>byte</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;line\r\n&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetBodyStream</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>rw</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>500</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>line</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>&lt;=</span> <span style=color:#0000cf;font-weight:700>500</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// For each streaming_write, the upload_file prints</span>
</span></span><span style=display:flex><span>                <span style=color:#000>rw</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Write</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>line</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>                <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>                <span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sleep</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Millisecond</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#000>rw</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>c</span><span style=color:#000;font-weight:700>..</span><span style=color:#000>Finished</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;request process end&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GET</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/streamWrite2&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestContext</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rw</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>newChunkReader</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// Content-Length may be negative:</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// -1 means Transfer-Encoding: chunked.</span>
</span></span><span style=display:flex><span>        <span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetBodyStream</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>rw</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#0000cf;font-weight:700>1000</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// For each streaming_write, the upload_file prints</span>
</span></span><span style=display:flex><span>                <span style=color:#000>rw</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Write</span><span style=color:#000;font-weight:700>([]</span><span style=color:#204a87>byte</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;===%d===\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>i</span><span style=color:#000;font-weight:700>)))</span>
</span></span><span style=display:flex><span>                <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>                <span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sleep</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>100</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Millisecond</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#000>rw</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>c</span><span style=color:#000;font-weight:700>..</span><span style=color:#000>Finished</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;request process end&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>ChunkReader</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>rw</span>  <span style=color:#000>bytes</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Buffer</span>
</span></span><span style=display:flex><span>    <span style=color:#000>w2r</span> <span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>struct</span><span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span>    <span style=color:#000>r2w</span> <span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>struct</span><span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>newChunkReader</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>ChunkReader</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>rw</span> <span style=color:#000>bytes</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Buffer</span>
</span></span><span style=display:flex><span>    <span style=color:#000>w2r</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>struct</span><span style=color:#000;font-weight:700>{})</span>
</span></span><span style=display:flex><span>    <span style=color:#000>r2w</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>struct</span><span style=color:#000;font-weight:700>{})</span>
</span></span><span style=display:flex><span>    <span style=color:#000>cr</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>ChunkReader</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>rw</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>w2r</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>r2w</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>cr</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>closeOnce</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>new</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>sync</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Once</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>cr</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>ChunkReader</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>Read</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>p</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>byte</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>n</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>cr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w2r</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>!</span><span style=color:#000>ok</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>closeOnce</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Do</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>r2w</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span>            <span style=color:#000>n</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>cr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>rw</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Read</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>p</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>return</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>n</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>cr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>rw</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Read</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>p</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>cr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>r2w</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#204a87;font-weight:700>struct</span><span style=color:#000;font-weight:700>{}{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>n</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>continue</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>cr</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>ChunkReader</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>Write</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>p</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>byte</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>n</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>n</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>cr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>rw</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Write</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>p</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>cr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w2r</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#204a87;font-weight:700>struct</span><span style=color:#000;font-weight:700>{}{}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>cr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>r2w</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>cr</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>ChunkReader</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w2r</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></li><li><p>用户可以在 handler 中使用 <code>pkg/protocol/http1/resp/writer</code> 下提供的 <code>NewChunkedBodyWriter</code> 方法劫持 response 的 writer，然后使用 <code>ctx.Write</code> 函数将分块数据写入 Body 并将分块数据使用 <code>ctx.Flush</code> 函数立即发送给客户端。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GET</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/flush/chunk&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestContext</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// Hijack the writer of response</span>
</span></span><span style=display:flex><span>	<span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Response</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HijackWriter</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>resp</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewChunkedBodyWriter</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Response</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetWriter</span><span style=color:#000;font-weight:700>()))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Write</span><span style=color:#000;font-weight:700>([]</span><span style=color:#204a87>byte</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;chunk %d: %s&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>i</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>strings</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Repeat</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;hi~&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>i</span><span style=color:#000;font-weight:700>))))</span> <span style=color:#8f5902;font-style:italic>// nolint: errcheck</span>
</span></span><span style=display:flex><span>		<span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Flush</span><span style=color:#000;font-weight:700>()</span>                                                                 <span style=color:#8f5902;font-style:italic>// nolint: errcheck</span>
</span></span><span style=display:flex><span>		<span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sleep</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>200</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Millisecond</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>})</span>
</span></span></code></pre></div></li></ol><p><strong>这两种方式的区别：第一种在执行完 handler 逻辑后再将数据按分块发送给客户端，第二种在 handler 逻辑中就可以将分块数据发送出去。</strong></p><p>更多示例代码可参考 <a href=/zh/docs/hertz/tutorials/example/#%E6%B5%81%E5%BC%8F%E8%AF%BB%E5%86%99>example</a>。</p><h2 id=注册自定义协议>注册自定义协议</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>engine</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Engine</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>AddProtocol</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>protocol</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>factory</span> <span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{})</span>
</span></span></code></pre></div><p>详细信息可见 <a href=/zh/docs/hertz/tutorials/framework-exten/protocol/#%E6%B3%A8%E5%86%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE-server-%E5%88%B0-hertz-%E4%B8%AD>注册自定义协议</a>。</p><h2 id=setclientipfunc>SetClientIPFunc</h2><p>该函数的参数 f 会被传递到 <code>RequestContext.SetClientIPFunc</code> 函数中，作用及示例代码见 <a href=/zh/docs/hertz/tutorials/basic-feature/context/request/#setclientipfunc>SetClientIPFunc</a>。</p><p>函数签名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>engine</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Engine</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>SetClientIPFunc</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>f</span> <span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ClientIP</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h2 id=setformvaluefunc>SetFormValueFunc</h2><p>该函数的参数 f 会被传递到 <code>RequestContext.SetFormValueFunc</code> 函数中，作用及示例代码见 <a href=/zh/docs/hertz/tutorials/basic-feature/context/request/#setformvaluefunc>SetFormValueFunc</a>。</p><p>函数签名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>engine</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Engine</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>SetFormValueFunc</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>f</span> <span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FormValueFunc</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h2 id=钩子函数>钩子函数</h2><p>钩子函数（Hooks）是一个通用的概念，表示某事件触发时所伴随的操作。</p><p>Hertz 提供了全局的 Hook 注入能力，用于在服务触发启动后和退出前注入自己的处理逻辑，详细信息可见 <a href=/zh/docs/hertz/tutorials/basic-feature/hooks/>Hooks</a>。</p><h2 id=panic-处理函数>Panic 处理函数</h2><p>用于设置当程序发生 panic 时的处理函数，默认为 <code>nil</code>。</p><blockquote><p>注意：如果同时设置了 <code>PanicHandler</code> 和 <code>Recovery</code> 中间件，则 <code>Recovery</code> 中间件会覆盖 <code>PanicHandler</code> 的处理逻辑。</p></blockquote><p>示例代码:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>New</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// 在 panic 时，会触发 PanicHandler 中的函数，返回 500 状态码并携带错误信息</span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>PanicHandler</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestContext</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>JSON</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>500</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>utils</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>H</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#4e9a06>&#34;message&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;panic&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GET</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/hello&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestContext</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87>panic</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;panic&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=continuehandler>ContinueHandler</h2><p>在接收到客户端发来的 Expect 100 Continue 头之后调用 ContinueHandler。使用 ContinueHandler，服务器可以决定是否读取可能很大的请求正文，默认情况下会读取。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Default</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ContinueHandler</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>header</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>protocol</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestHeader</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>false</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=渲染-template>渲染 template</h2><p>Hertz 提供了 <code>Delims</code>, <code>SetFuncMap</code>, <code>LoadHTMLGlob</code>, <code>LoadHTMLFiles</code> 等方法用于渲染 HTML 或模板文件，详细内容可参考 <a href=/zh/docs/hertz/tutorials/basic-feature/render/#html>HTML</a>。</p><h2 id=noroute-与-nomethod-使用>NoRoute 与 NoMethod 使用</h2><p>Hertz 提供了 <code>NoRoute</code> 与 <code>NoMethod</code> 方法用于全局处理 HTTP 404 与 405 请求，详细内容可参考 <a href=/zh/docs/hertz/tutorials/basic-feature/route/#noroute-%E4%B8%8E-nomethod-%E4%BD%BF%E7%94%A8>NoRoute 与 NoMethod 使用</a>。</p><h2 id=获取路由信息>获取路由信息</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>engine</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Engine</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>Routes</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>routes</span> <span style=color:#000>RoutesInfo</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h3 id=routes>Routes</h3><p><code>Routes</code> 函数返回一个按 HTTP 方法划分的包含路由信息（HTTP 方法名，路由路径，请求处理函数名）的切片。</p><p>函数签名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>engine</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Engine</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>Routes</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>routes</span> <span style=color:#000>RoutesInfo</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>示例代码：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>getHandler</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HandlerFunc</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestContext</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>consts</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>StatusOK</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;get handler&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>postHandler</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HandlerFunc</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestContext</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>consts</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>StatusOK</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;post handler&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Default</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>	<span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GET</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/get&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>getHandler</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>	<span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>POST</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/post&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>postHandler</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>	<span style=color:#000>routesInfo</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Routes</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>routesInfo</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// [{GET /get main.getHandler.func1 0xb2afa0} {POST /post main.postHandler.func1 0xb2b060}]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=底层网络库>底层网络库</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>engine</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Engine</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>GetTransporterName</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>tName</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>SetTransporter</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>transporter</span> <span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>options</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Options</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>network</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Transporter</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h3 id=gettransportername>GetTransporterName</h3><p>获取当前使用的网络库名称，现在有原生的 <code>go net</code> 和 <code>netpoll</code> 两种。</p><p>linux 默认使用 <code>netpoll</code>, windows 只能使用 <code>go net</code>。</p><p>如果对如何使用对应的网络库有疑惑，请查看 <a href=/zh/docs/hertz/tutorials/basic-feature/network-lib/>此处</a>。</p><p>函数签名:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>engine</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Engine</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>GetTransporterName</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>tName</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>示例代码：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>New</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>tName</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetTransporterName</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><h3 id=settransporter>SetTransporter</h3><p><code>SetTransporter</code> 用于设置网络库。</p><blockquote><p>注意：<code>SetTransporter</code> 只设置 Engine 的全局默认值，所以在初始化 Engine 时使用 <code>WithTransporter</code> 来设置网络库会覆盖掉 <code>SetTransporter</code> 的设置。</p></blockquote><p>函数签名:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>SetTransporter</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>transporter</span> <span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>options</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Options</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>network</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Transporter</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>示例代码：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>route</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetTransporter</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>standard</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTransporter</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h2 id=链路追踪>链路追踪</h2><p>Hertz 提供了链路追踪的能力，也支持用户自定义链路跟踪，详情可参考 <a href=/zh/docs/hertz/tutorials/observability/tracing/>链路追踪</a>。</p><h2 id=hijack>Hijack</h2><h3 id=nohijackconnpool>NoHijackConnPool</h3><blockquote><p>Hertz 连接劫持时所使用的 hijack conn 是池化管理的，因此被劫持的连接在 websocket 中使用的时候，不支持异步操作。</p></blockquote><p>劫持的连接仅能被关闭一次，第二次关闭会导致空指针异常。</p><p>NoHijackConnPool 将控制是否使用缓存池来获取/释放劫持连接。如果使用池，将提升内存资源分配的性能，但无法避免二次关闭连接导致的异常。</p><p>如果很难保证 hijackConn 不会被反复关闭，可以将其设置为 true。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// https://github.com/cloudwego/hertz/issues/121</span>
</span></span><span style=display:flex><span>    <span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NoHijackConnPool</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=hijackconnhandle>HijackConnHandle</h3><p>设置 Hijack 连接处理函数。</p><p>函数签名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>engine</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Engine</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>HijackConnHandle</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>c</span> <span style=color:#000>network</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Conn</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>h</span> <span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HijackHandler</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>反馈</h2><p class=feedback--question>当前页面对你有帮助吗？</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">是</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">否</button><p class="feedback--response feedback--response-yes"><a href=https://github.com/cloudwego/cloudwego.github.io/issues/new>请告诉我们如何改进</a>.</p><p class="feedback--response feedback--response-no"><a href=https://github.com/cloudwego/cloudwego.github.io/issues/new>请告诉我们如何改进</a>.</p></div><script>const yesButton=document.querySelector(".feedback--answer-yes"),noButton=document.querySelector(".feedback--answer-no"),yesResponse=document.querySelector(".feedback--response-yes"),noResponse=document.querySelector(".feedback--response-no"),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=e=>{if(typeof ga!="function")return;const t={command:"send",hitType:"event",category:"Helpful",action:"click",label:window.location.pathname,value:e};ga(t.command,t.hitType,t.category,t.action,t.label,t.value)};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(1)}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script><br><div class="text-muted mt-5 pt-3 border-top">最后修改
March 7, 2025
: <a href=https://github.com/cloudwego/cloudwego.github.io/commit/590388601ba4c26232b5ba3dcdef1bb571867ba4>doc: update plugin install guide (#1272) (5903886)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Lark aria-label=Lark><a class=text-white target=_blank rel=noopener href="https://applink.feishu.cn/client/chat/chatter/add_by_link?link_token=693v2544-2664-4421-b50f-7f1912p745r6" aria-label=Lark><img src=/webfonts/lark.svg alt style=width:26px;line-height:32.5px;margin-bottom:6px;fill:#fff></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/CloudWeGo aria-label=Twitter><img src=/webfonts/x-twitter.svg alt style=width:26px;line-height:32.5px;margin-bottom:6px;fill:#fff></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/cloudwego aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Discord aria-label=Discord><a class=text-white target=_blank rel=noopener href=https://discord.gg/jceZSE7DsW aria-label=Discord><i class="fab fa-discord"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2025 The CloudWeGo Authors</small><p class="mt-2 text-white"><a class=cloudwego-link href=/about/ target=_blank rel=noopener>About</a>
|
<a class=cloudwego-link href=https://github.com/cloudwego/cloudwego.github.io/blob/main/LICENSE target=_blank rel=noopener>License</a></p></div></div></div></footer></div><script src=/js/popper.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/main.min.9a8648b987db06195f5768f0d7516e8df7c27669e91e383e25c5d07cd6325605.js integrity="sha256-moZIuYfbBhlfV2jw11FujffCdmnpHjg+JcXQfNYyVgU=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/prism-custom.js></script><script src=/js/tabpane-persist.js></script><script src=/js/docsearch.js></script><script type=text/javascript>let siteLang=window.location.pathname.startsWith("/zh/")?"zh":"en";docsearch({appId:"V7I042F992",apiKey:"8380a7ac88106841cb43fb000fa2edb4",indexName:"cloudwego",container:"#docsearch",searchParameters:{hitsPerPage:5,facetFilters:[`lang:${siteLang}`]},transformItems(e){return e.map(e=>({...e,url:e.url.replace("www.cloudwego.io",location.host).replace("https:",location.protocol)}))}})</script><script src=/js/outbound-link.js></script><script src=/js/navScroll.js></script></body></html>