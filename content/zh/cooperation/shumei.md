---
type: docs
title: "Kitex åœ¨æ•°ç¾Žç§‘æŠ€å¯ç”¨æ€§æ²»ç†çš„è½åœ°å®žè·µè·µ"
linkTitle: "æ•°ç¾Žç§‘æŠ€"
weight: 5
---

> 2023 å¹´ 3 æœˆï¼ŒCloudWeGo Day é‚€è¯·äº†è´ªçŽ©æ¸¸æˆã€æ•°ç¾Žç§‘æŠ€ã€å­—èŠ‚è·³åŠ¨ä¸šåŠ¡éƒ¨é—¨çš„ä¸€çº¿æž¶æž„å¸ˆï¼Œä¸ºå¤§å®¶åˆ†äº«ï¼Œåœ¨ Java è½¬ go åœºæ™¯ä¸‹ã€ä¼ä¸šé«˜å¯ç”¨æ€§æŒ‘æˆ˜ç­‰åœºæ™¯ä¸‹ï¼Œå¦‚ä½•é€šè¿‡ CloudWeGo æ¥è½åœ°å¾®æœåŠ¡æž¶æž„ã€‚æœ¬æ–‡ä¸º **æ•°ç¾Žç§‘æŠ€æž¶æž„å¸ˆ ä»£ä¿Šå‡¯** åˆ†äº«å†…å®¹ã€‚
>
> **ðŸ”— å›žæ”¾é“¾æŽ¥ï¼š** https://juejin.cn/live/cloudwegoday002

## å˜‰å®¾ä»‹ç»

![shumei1](/img/users/shumei/shumei1.png)

æœ¬æ¬¡åˆ†äº«ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰éƒ¨åˆ†å†…å®¹ï¼š

1.  æ•°ç¾Žç§‘æŠ€åœ¨çº¿æž¶æž„çš„ä¸šåŠ¡æŒ‘æˆ˜
1.  ç¨³å®šæ€§é—®é¢˜æ²»ç†ç­–ç•¥
1.  Kitex è½åœ°å®žè·µä¸Žæ•ˆæžœ

åŽ»å¹´ï¼Œæˆ‘ä»¬å…¬å¸æš´éœ²äº†è®¸å¤šä¸Žå¯ç”¨æ€§ç›¸å…³çš„é—®é¢˜ï¼Œå› æ­¤æ€¥éœ€è¿›è¡Œå¯ç”¨æ€§ç›¸å…³æ²»ç†å·¥ä½œã€‚ç”±äºŽå…¬å¸çš„åŸºç¡€è®¾æ–½ä¸Žä¸šç•Œå­˜åœ¨è¾ƒå¤§å·®è·ï¼Œæˆ‘ä»¬è°ƒç ”å¹¶å¼•è¿›äº† Kitex å¼€æºè§£å†³æ–¹æ¡ˆï¼Œä»¥é™ä½Žç ”å‘æˆæœ¬ã€‚åœ¨è¿‡åŽ»ä¸€å¹´ä¸­ï¼Œæˆ‘ä»¬å–å¾—äº†ä¸€äº›æˆæžœï¼Œåœ¨æ­¤å€Ÿè¿™ä¸ªæœºä¼šå‘å¤§å®¶åˆ†äº«ä¸€äº›ç›¸å…³çš„ç»éªŒã€‚æˆ‘å°†é’ˆå¯¹å¯ç”¨æ€§æ–¹é¢å±•å¼€è®¨è®ºï¼Œä¸ºå¤§å®¶æä¾›ä¸€äº›å¯å¤åˆ¶çš„å‚è€ƒç»éªŒã€‚

Kitex æ–‡æ¡£æä¾›äº†å¾ˆå¤šå‚æ•°è®¾ç½®å’Œå‚è€ƒæ„è§ï¼ŒåŒæ—¶æˆ‘ä¼šæä¾›ä¸€äº›å‚è€ƒæ–‡çŒ®é“¾æŽ¥ï¼Œå¸®åŠ©å¤§å®¶äº†è§£å¾®æœåŠ¡åœ¨å‘å±•è¿‡ç¨‹ä¸­çš„æ²‰æ·€ä¸‹æ¥çš„æ²»ç†ç‰¹æ€§åŠå…¶è§£å†³æ–¹æ¡ˆçš„åŽ†å²ã€‚å¯ä»¥è¯´ï¼ŒKitex æ˜¯è¿™äº›å¾®æœåŠ¡æ²»ç†ç‰¹æ€§çš„é›†å¤§æˆè€…ã€‚

## åœ¨çº¿æž¶æž„çš„ä¸šåŠ¡æŒ‘æˆ˜

### ä¸šåŠ¡æŒ‘æˆ˜

é¦–å…ˆä»‹ç»ä¸€ä¸‹æˆ‘ä»¬å…¬å¸çš„ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬å…¬å¸å¯¹å¤–ä¸»è¦æä¾› SaaS æœåŠ¡ï¼Œæˆ‘ä»¬å¤§æ¦‚æœ‰æ•°åƒå®¶å®¢æˆ·ã€æ•°åä¸ªé›†ç¾¤ï¼Œæ‰€æœ‰çš„å®¢æˆ·éƒ½æ˜¯ä½¿ç”¨å…±äº«çš„é›†ç¾¤èµ„æºã€‚è€Œä¸”æˆ‘ä»¬æ˜¯ä¸€ä¸ªå…¸åž‹çš„æœºå™¨å­¦ä¹ ç³»ç»Ÿï¼Œèµ„æºæ¶ˆè€—æ¯”è¾ƒé«˜çš„æ˜¯ GPU ç›¸å…³çš„èµ„æºã€‚

**å¤šç§Ÿæˆ·å…±äº«é›†ç¾¤**

- ç§Ÿæˆ·ä¼—å¤šï¼Œæ–‡æœ¬ã€éŸ³é¢‘ã€å›¾åƒæ¨¡åž‹é¢„æµ‹å æˆæœ¬å¤§å¤´ã€‚å¤§çº¦å æ€»æˆæœ¬çš„ 80% ä»¥ä¸Šã€‚
- å¦‚æžœæ¯ä¸ªç§Ÿæˆ·ç‹¬ç«‹éƒ¨ç½² GPU é›†ç¾¤ï¼Œæ€»ä½“èµ„æºåˆ©ç”¨çŽ‡å°†ä¼šå¾ˆä½Žã€‚æ‰€ä»¥æˆ‘ä»¬å¿…ç„¶æœ‰ä¸€ä¸ªé€‰æ‹©ï¼Œå°±æ˜¯é€šè¿‡å¤šä¸ªç§Ÿæˆ·é€šè¿‡å…±äº«éƒ¨ç½²ï¼Œå¯ä»¥å…±äº«å†—ä½™é™ä½Žæˆæœ¬ã€‚

å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ¯”å¦‚åœ¨æ–‡æœ¬è¯†åˆ«ä¸­ï¼Œä¸€æ¡æ–‡æœ¬é€šå¸¸å¤„ç†æ—¶é—´ä¸ºåå‡ æ¯«ç§’å·¦å³ã€‚å¯¹äºŽéŸ³é¢‘å’Œå›¾åƒï¼Œæ•´ç†çš„å¤„ç†æ—¶å»¶è¦é•¿å¾ˆå¤šã€‚

- å¯¹äºŽéŸ³é¢‘ï¼Œè¦ç»è¿‡ ASR æœåŠ¡ï¼ŒASR æœåŠ¡å¯¹éŸ³é¢‘çš„å“åº”æ—¶é—´é€šå¸¸åœ¨å‡ åæ¯«ç§’å·¦å³ã€‚
- å¯¹äºŽå›¾åƒï¼Œä¼šç»è¿‡å¾ˆå¤šå„ç§æ£€æµ‹çš„æ¨¡åž‹ï¼Œä»¥åŠç»è¿‡ OCR è¯†åˆ«å‡ºæ–‡å­—ï¼Œå†åŽ»è¿‡è¿™äº›æ–‡æœ¬çš„é£Žé™©æ¨¡åž‹ï¼Œæ•´ä½“çš„å»¶æ—¶æ˜¯è®¡ç®—å¯†é›†åž‹çš„ï¼Œå»¶æ—¶æ¯”è¾ƒé«˜ï¼Œå›¾åƒå¤„ç†é€šå¸¸æ¶‰åŠå¤šä¸ªæ£€æµ‹æ¨¡åž‹å’Œ OCR æœåŠ¡ï¼Œä¾‹å¦‚ OCR æœåŠ¡å¯èƒ½éœ€è¦å‡ åæ¯«ç§’çš„æ—¶é—´ï¼Œå†ç»è¿‡åŽç»­ä¸åŒç²¾åº¦çš„æ£€æµ‹æ¨¡åž‹ï¼Œå¦‚è‰²æƒ…æ¨¡åž‹ç­‰ï¼Œ å¤„ç†æ—¶é—´å¯èƒ½ä¼šè¶…è¿‡ç™¾æ¯«ç§’ã€‚

å› æ­¤ï¼Œåœ¨å¤šç§Ÿæˆ·å…±äº«æ—¶ï¼Œæ‰©å®¹é€Ÿåº¦ä¸å¤Ÿå¿«ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œå¹¶ä¸”æ‰€æœ‰é£ŽæŽ§è¯·æ±‚éƒ½ä¸Žç”¨æˆ·è¡Œä¸ºç›¸å…³ï¼Œæ˜¯æ— æ³•ç¼“å­˜çš„ã€‚

![shumei2](/img/users/shumei/shumei2.png)

**å¤šç§Ÿæˆ·å…±äº«é›†ç¾¤é—®é¢˜**

1.  **æ— æ³•ç¼“å­˜**ï¼šé£ŽæŽ§è¯·æ±‚æ¯ä¸ªéƒ½å’Œç”¨æˆ·è¡Œä¸ºç›¸å…³ï¼Œä¸å¯ç¼“å­˜ã€‚
1.  **æ€§èƒ½é—®é¢˜**ï¼šå…±äº«ç¡¬ä»¶åŸºç¡€è®¾æ–½é›†ç¾¤ï¼Œæ€§èƒ½é—®é¢˜å®¹æ˜“å¯¼è‡´ç§Ÿæˆ·é—´äº’ç›¸å½±å“ã€‚å½“ä¸€ä¸ªç§Ÿæˆ·éœ€è¦ä½¿ç”¨æ›´å¤šèµ„æºæ—¶å€™ï¼Œå…¶ä»–ç§Ÿæˆ·å¯èƒ½å—åˆ°å½±å“ï¼Œå¯¼è‡´å»¶è¿Ÿæˆ–è€…æ€§èƒ½ä¸‹é™ã€‚
1.  **ç®¡ç†ç»´æŠ¤æˆæœ¬**ï¼šå…±äº«æ•°æ®åº“ç­‰åŸºç¡€è®¾æ–½ï¼Œå¯¼è‡´æ›´é«˜çš„ç®¡ç†æˆæœ¬å’Œæ›´å¤æ‚çš„ç³»ç»Ÿæž¶æž„ã€‚

**æµé‡ç‰¹å¾**

**1ã€æµé‡æ•´ä½“å¤©çº§åˆ«è§„å¾‹æ³¢**

ä»‹ç»ä¸€ä¸‹æˆ‘ä»¬çš„æµé‡ç‰¹æ€§ï¼šæµé‡æŒ‰å¤©è§„å¾‹æ³¢åŠ¨ï¼Œæœ‰æ˜Žæ˜¾çš„æ³¢å³°æ³¢è°·ï¼Œæ™šé«˜å³°ç”¨æˆ·å¤šæµé‡å¤§ï¼Œå‡Œæ™¨æµé‡ä¸‹é™ã€‚

ä¸ºäº†é™ä½Žæ•´ä½“çš„æˆæœ¬ï¼Œå¦‚æžœå…¨å¤©å°†è¿™äº› GPU çš„æœºå™¨éƒ½å¯åŠ¨ï¼Œé‚£ä¹ˆæ¯å¤©çš„æˆæœ¬å¯èƒ½ä¼šè¾ƒå¤§ã€‚æ ¹æ®æ³¢å³°æ³¢è°·æ¥å¯åŠ¨ GPU æœºå™¨ï¼Œä¼šæ¯”å…¨å¤©å¯åŠ¨æ‰€æœ‰çš„ GPU æœºå™¨çš„æˆæœ¬é™ä½ŽæŽ¥è¿‘ 2/ 3 ã€‚

![shumei3](/img/users/shumei/shumei3.png)

æˆ‘ä»¬ç³»ç»Ÿéœ€è¦å…·å¤‡çš„ä¸€ä¸ªåŠŸèƒ½æ˜¯å¼¹æ€§ä¼¸ç¼©ï¼Œé€šè¿‡å¼¹æ€§ä¼¸ç¼©ï¼ŒåŠ¨æ€å¢žåŠ æˆ–å‡å°‘ç³»ç»Ÿèµ„æºæ¥é€‚åº”ä¸åŒçš„è´Ÿè½½éœ€æ±‚ï¼Œåœ¨é«˜å³°æœŸï¼Œé€šè¿‡å¢žåŠ æœåŠ¡å™¨å®žä¾‹æ¥å¤„ç†æ›´å¤šçš„è¯·æ±‚ï¼Œä»¥é˜²æ­¢å®¢æˆ·çš„çªå¢žæµé‡ã€‚åœ¨ä½Žå³°æœŸï¼Œé€šè¿‡ç¼©å‡æœåŠ¡å™¨å®žä¾‹æ•°é‡æ¥èŠ‚çœæˆæœ¬ã€‚ç„¶è€Œï¼Œå› ä¸ºæˆ‘ä»¬çš„å®¢æˆ·æ•°é‡ä¼—å¤šï¼Œæˆ‘ä»¬ç›¸å½“äºŽè¦æœåŠ¡å„ç§æµé‡ç‰¹æ€§çš„ç”¨æˆ·ï¼Œå¦‚æžœç”¨æˆ·æ˜¯äº’è”ç½‘å®¢æˆ·ï¼Œåˆ™å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ³¢å³°æ³¢è°·æµé‡å¯ä»¥æ»¡è¶³ä»–ä»¬çš„éœ€æ±‚ã€‚

**2ã€å­˜åœ¨æ— æ³•é¢„æµ‹çš„æµé‡çªå¢ž**

æµé‡å—ä¸åŒç§Ÿæˆ·æ´»åŠ¨å½±å“è¾ƒå¤§ï¼Œå®¢æˆ·ä¸šåŠ¡æ´»åŠ¨æˆ–è€…çªå‘çš„æµ‹è¯•æµé‡ï¼Œå°±ä¼šå‡ºçŽ°è¾ƒå¤§çš„æµé‡æ³¢åŠ¨ã€‚æˆ‘ä»¬å¾ˆå¤šå…¶ä»–çš„å®¢æˆ·ä¼šè¿›è¡Œè®¸å¤šæ´»åŠ¨ï¼Œæˆ–è€…ç»å¸¸ä¼šå‘é€ä¸€äº›æµ‹è¯•è¯·æ±‚ï¼Œä¾‹å¦‚æŸæ®µæ—¶é—´æƒ³å°†åŽ†å²æ•°æ®è¿‡æœ€æ–°çš„æ£€æµ‹ç»“æžœï¼Œä¾‹å¦‚å¯¹äºŽä¸€ä¸ªç½‘ç›˜ç”¨æˆ·ï¼Œä»–ä»¬ç»å¸¸ä¼šé‡æ–°æ£€æµ‹æœåŠ¡å™¨ä¸Šçš„æ–‡æœ¬ã€å›¾åƒå’ŒéŸ³é¢‘ï¼Œæ¥ç¡®å®šå½“å‰æ˜¯å¦æ»¡è¶³å½“å‰ç›‘ç®¡è¦æ±‚ï¼Œé¢„æœŸæŽ’é™¤ä¸šåŠ¡é£Žé™©ã€‚ä½†æ˜¯ï¼Œè¿™ç§æƒ…å†µä¼šå¯¼è‡´æˆ‘ä»¬æœåŠ¡å™¨äº§ç”Ÿè¾ƒå¤§çš„æµé‡æ³¢åŠ¨ã€‚

å› æ­¤ï¼Œé¦–å…ˆæˆ‘ä»¬é’ˆå¯¹æ— æ³•é¢„æµ‹çš„ã€çªå¢žçš„æµé‡è¿›è¡Œé™åˆ¶ï¼Œä½†æˆ‘ä»¬çš„é™åˆ¶å¯¹äºŽæ¯ä¸ªå®¢æˆ·å¹¶ä¸æ˜¯ä¸€ä¸ªç»å¸¸åŠ¨æ€è°ƒæ•´çš„è¿‡ç¨‹ï¼Œè€Œä¸”ä¹Ÿä¸ä¼šæ ¹æ®ä¸åŒå¤©ã€æ¯å¤©çš„ä¸åŒæ—¶é—´æœ‰ä¸åŒçš„ QPS é™åˆ¶ã€‚å› æ­¤ï¼Œå®ƒå…¨å¤©éƒ½å¯ä»¥åšåˆ°æµé‡çš„çªå¢žã€‚å¦‚æžœæˆ‘ä»¬åœ¨ä½Žå³°æœŸé¢„ç•™çš„æœåŠ¡å™¨è¾ƒå°‘ï¼Œå°±æ— æ³•å¤„ç†è¿™ä¹ˆå¤šè¯·æ±‚ï¼Œé€ æˆæœåŠ¡å™¨é›ªå´©ã€‚

![shumei4](/img/users/shumei/shumei4.png)

### **å¾®æœåŠ¡æž¶æž„**

æˆ‘ä»¬å…¬å¸æ˜¯ä¸€ä¸ªå…¸åž‹çš„ä¸‰å±‚å¾®æœåŠ¡ä¸šåŠ¡æž¶æž„ï¼š**æŽ¥å…¥å±‚-é€»è¾‘ä¸šåŠ¡å±‚-åŸºç¡€æœåŠ¡å±‚**ã€‚

æˆ‘ä»¬åŸºç¡€æœåŠ¡ï¼ŒæŽ¥å…¥å±‚é€šè¿‡ HTTP è¯·æ±‚æŽ¥å…¥ç”¨æˆ·çš„è¯·æ±‚ï¼Œå†…éƒ¨æœåŠ¡ä½¿ç”¨ thrift åè®®åš RPC ï¼Œè¿›è¡Œå¾®æœåŠ¡é—´çš„è°ƒç”¨ã€‚ä¸šåŠ¡å±‚å¤„ç†å¤§éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘ï¼ŒåŸºç¡€æœåŠ¡å¤§éƒ¨åˆ†æ˜¯çº¿ä¸Šçš„æœºå™¨å­¦ä¹ é¢„æµ‹æœåŠ¡ï¼Œå‡ ä¹Žéƒ½æ˜¯è®¡ç®—å¯†é›†åž‹çš„æœåŠ¡ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ GPU çš„é¢„æµ‹æœåŠ¡ï¼Œç„¶åŽæˆ‘ä»¬å¤§æ¦‚çº¿ä¸Šæœ‰æ•°ç™¾ä¸ªä¸åŒçš„ç±»åž‹çš„æœåŠ¡ï¼Œå¤§æ¦‚å‡ åƒä¸ªå®žä¾‹ï¼Œæ¯å¤©è¦æ‰¿å—æŽ¥è¿‘ 30 äº¿å¤šçš„æ—¥è¯·æ±‚é‡ã€‚

æˆ‘ä»¬å…¬å¸æ˜¯ 15 å¹´å·¦å³æˆç«‹çš„ï¼Œä¸€èˆ¬è®¤ä¸ºï¼Œä¸€ä¸ªå…¬å¸çš„åŸºç¡€æž¶æž„éœ€è¦ 5 å¹´è¿›è¡Œä¸€æ¬¡æ›´æ–°ã€‚æˆ‘ä»¬å…¬å¸åˆšå¥½éœ€è¦è¿›è¡Œä¸‹ä¸€æ¬¡åŸºç¡€è®¾æ–½ç›¸å…³çš„æ›´æ–°ï¼Œå› ä¸ºæˆ‘ä»¬çš„åŸºç¡€æœåŠ¡æž¶æž„ç¼ºå°‘å¾ˆå¤šçŽ°åœ¨ä¸»æµçš„æ²»ç†ç‰¹æ€§ã€‚åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæš´éœ²å‡ºäº†è®¸å¤šç¨³å®šæ€§é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬äºŸéœ€ä¸€ä¸ªé«˜æ€§èƒ½ã€é›†æˆå¤šç§æ²»ç†ç‰¹æ€§è§£å†³ç¨³å®šæ€§é—®é¢˜ã€æ–¹ä¾¿å®šåˆ¶å¯ä»¥èžå…¥å½“å‰åŸºç¡€è®¾æ–½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€äº›è°ƒç ”ï¼Œé€‰æ‹©äº† Kitex ä½œä¸ºæœåŠ¡æ¡†æž¶ã€‚

![shumei5](/img/users/shumei/shumei5.png)

å¤§å®¶å¯ä»¥çœ‹è¿™å¼ å›¾ï¼Œåœ¨å¼•å…¥æ–°æ¡†æž¶çš„è¿‡ç¨‹ä¸­ï¼Œç”±äºŽæˆ‘ä»¬çš„æœåŠ¡éžå¸¸å¤šä¸”åŽ†å²é—®é¢˜çªå‡ºï¼Œæˆ‘ä»¬æ˜¯ä¸»è¦æ˜¯åœ¨æŽ¥å…¥å±‚é€šè¿‡æ›¿æ¢ thrift çš„å®¢æˆ·ç«¯ï¼Œåœ¨æ•´ä¸ªä¸šåŠ¡å±‚å°†æ‰€æœ‰çš„ server ç«¯ä»¥åŠ client ç«¯éƒ½è¿›è¡Œäº†æ›¿æ¢ã€‚è€ŒåŸºç¡€æœåŠ¡ç”±äºŽå¤§éƒ¨åˆ†æ˜¯ C++æœåŠ¡ï¼Œæˆ‘ä»¬æ²¡æœ‰å¯¹å…¶è¿›è¡Œè°ƒæ•´ï¼Œä½†æ˜¯å› ä¸º Kitex çš„å®¢æˆ·ç«¯æ”¯æŒäº†å¾ˆå¤šåŠŸèƒ½ï¼Œå·²ç»å¯ä»¥è§£å†³æˆ‘ä»¬å¾ˆå¤šç¨³å®šæ€§é—®é¢˜ã€‚åŽé¢æˆ‘ä»¬å°†å±•å¼€ä»‹ç»ã€‚

### æ¡†æž¶å®šåˆ¶

CloudWeGo å¼€æºäº†è®¸å¤šç›¸å…³çš„ç»„ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Kitex ã€‚å®ƒè™½ç„¶æ˜¯ä¸€ä¸ªå¼€æºæ¡†æž¶ï¼Œå¹¶ä¸åƒè®¸å¤šå…¨å®¶æ¡¶å¼åœ°å°†å„ç§æœåŠ¡éƒ½é›†æˆè¿›æ¥çš„æ¡†æž¶é‚£æ ·ï¼Œå°†ä¸Žå…¬å¸åŸºç¡€è®¾æ–½è€¦åˆè¾ƒç´§å¯†çš„è¿™éƒ¨åˆ†ä½œä¸ºæ‰©å±•è¿›è¡ŒæŽ¥å…¥ã€‚ä¾‹å¦‚å¹¶æ²¡æœ‰å°†å­—èŠ‚è·³åŠ¨çš„æœåŠ¡å‘çŽ°ã€æ—¥å¿—ç›‘æŽ§ã€tracing å’Œ mesh ç­‰ç»„ä»¶ç›´æŽ¥å¼€æºå‡ºæ¥ï¼Œä»¥æ‹“å±•çš„æ–¹å¼æä¾›æ”¯æŒï¼Œå¤–éƒ¨ç”¨æˆ·å¯ä»¥æŒ‰éœ€é›†æˆã€‚å› æ­¤ï¼Œéœ€è¦æˆ‘ä»¬è¿™äº›ä½¿ç”¨ Kitex çš„è¿›è¡Œä¸€äº›è‡ªæˆ‘çš„å®šåˆ¶ï¼Œæ ¹æ®è‡ªå·±çš„åŸºç¡€è®¾æ–½éƒ¨åˆ†è‡ªç ”ï¼Œéƒ¨åˆ†ä½¿ç”¨çŽ°æˆçš„å¼€æºæ‹“å±•ï¼Œä¸ºäº†æ–¹ä¾¿å†…éƒ¨ä½¿ç”¨è¿˜è¿›è¡Œäº†æ˜“ç”¨æ€§å°è£…ã€‚

Kitex æœ‰ä¸€ä¸ªç¤¾åŒºè´¡çŒ®çš„ä»£ç ä»“åº“ï¼Œæä¾›äº†æˆ‘ä»¬å¼€æºå‡ºæ¥çš„æ²»ç†ç»„ä»¶ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®å…¶ä¸­è¿›è¡Œé€‰ç”¨ï¼Œç„¶åŽç»“åˆä¸€éƒ¨åˆ†è‡ªç ”ï¼Œå°±å¯ä»¥æ­å»ºä¸€å¥—å®Œæ•´çš„å¾®æœåŠ¡æ¡†æž¶æ¥æ–¹ä¾¿ä½¿ç”¨ã€‚

ä¸‹å›¾æ˜¯æˆ‘ä»¬å…¬å¸çš„ä¸€äº›é€‰åž‹ï¼Œæˆ‘ä»¬å…¬å¸ä¹‹å‰ä½¿ç”¨ ZooKeeper è¿›è¡ŒæœåŠ¡å‘çŽ°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¤ç”¨äº†åŽŸæ¥çš„æœåŠ¡å‘çŽ°çš„æœºåˆ¶ã€‚

![shumei6](/img/users/shumei/shumei6.png)

**åŸºäºŽå¼€æºç»„ä»¶å®šåˆ¶**

- DI: samber/do
- Config: viper
- Discovery: zookeeper
- Logging: zap & lumberjack(rolling)
- Metrics: prometheus
- Tracing: opentelemetry

### ä¾èµ–æ³¨å…¥

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡æ¯”è¾ƒåŽŸå§‹æ—¥å¿—æ‰“å°ä»¥åŠåˆ†å‰²å’Œè¿ç»´ç­‰å¤„ç†æ–¹å¼ï¼Œé€‰æ‹©ä¸€äº›å¼€æºæ¡†æž¶è¿›è¡Œæ—¥å¿—çš„å®šåˆ¶ï¼Œå…¶ä»–é€‰ç”¨äº†ç¤¾åŒºæ¯”è¾ƒé€šç”¨å¸¸ç”¨çš„æ–¹æ¡ˆï¼Œç›´æŽ¥è¿›è¡Œäº†ä¸€äº›æŽ¥å…¥ã€‚

ç”±äºŽæˆ‘ä»¬å…¬å¸å¾ˆå¤šåŸºç¡€è®¾æ–½éƒ½ä»¥æ‹“å±•çš„å½¢å¼è¿›è¡Œæ³¨å…¥ï¼Œä½†æ˜¯æˆ‘ä»¬è¦æ³¨å…¥çš„æ‹“å±•å…¶å®žæ˜¯éžå¸¸å¤šçš„ï¼Œè€Œä¸”åœ¨ä¸åŒæ¨¡å—é—´è¿›è¡Œæ‹“å±•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯”å¦‚æ¯æ¬¡å¼€å‘æ—¶ï¼Œéƒ½éœ€è¦åˆå§‹åŒ–ä¸€ä¸ªå®¢æˆ·ç«¯æŠŠæ‰€æœ‰çš„æ‰©å±•è¿›è¡Œæ³¨å…¥ï¼Œå…¶å®žæ˜¯å¾ˆéº»çƒ¦çš„ã€‚

äºŽæ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªä¾èµ–æ³¨å…¥æ¡†æž¶ï¼Œè¯¥æ¡†æž¶éœ€è¦ Go 1.18 æˆ–æ›´é«˜ç‰ˆæœ¬æ‰èƒ½ä½¿ç”¨ï¼Œè¿™ä¸ªå¼€æºåº“è¦æ±‚å¿…é¡»æ”¯æŒæ³›åž‹çš„ Golang ç‰ˆæœ¬ã€‚é€šè¿‡è¿™ä¸€å±‚å°è£…ï¼Œæˆ‘ä»¬å¯ä»¥è§£å†³ä¸åŒæ¨¡å—é—´æ‰©å±•ç»„è£…çš„é—®é¢˜ï¼Œç®€åŒ–ç»„è£…è¿‡ç¨‹ã€‚

å¯ä»¥çœ‹ä¸‹æ–¹æˆ‘æä¾›çš„ä»£ç ç‰‡æ®µï¼Œæ¼”ç¤ºäº†å°†è¿™ä¸ªæœåŠ¡å‘çŽ°çš„ç»„ä»¶åœ¨ä¸€ä¸ªå…¬å…±çš„åœ°æ–¹è¿›è¡Œæ³¨å†Œï¼Œç„¶åŽå…¶ä»–æ‰€æœ‰éœ€è¦ä½¿ç”¨è¯¥ç»„ä»¶çš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥é€šè¿‡å•ä¾‹çš„æ–¹å¼èŽ·å–å¯¹åº”çš„å®žä¾‹ï¼Œè§£å†³è·¨ä»£ç åº“è·¨æ¨¡å—ä¾èµ–çš„é—®é¢˜ã€‚

![shumei7](/img/users/shumei/shumei7.png)

é…ç½®å’ŒæœåŠ¡å‘çŽ°ç»„ä»¶å…±äº«

> æ˜“ç”¨æ€§ï¼š ä½¿ç”¨ä¾èµ–æ³¨å…¥è§£å†³æ‰©å±•ç»„è£…é—®é¢˜ï¼Œç®€åŒ–è·¨æ¨¡å—ä¾èµ–å…±äº«
> ä¾èµ–æ³¨å…¥ç»„ä»¶ï¼ˆæ”¯æŒèŒƒåž‹ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼‰ï¼šhttps://github.com/samber/do
> å‚è€ƒæ–‡çŒ® Dependency injection ï¼š https://en.wikipedia.org/wiki/Dependency_injection

## ç¨³å®šæ€§é—®é¢˜æ²»ç†ç­–ç•¥

### ç¨³å®šæ€§ç­–ç•¥

æˆ‘ä»¬å…¬å¸ä½¿ç”¨çš„ç­–ç•¥å¤§è‡´åˆ†ä¸ºä¸‰ä¸ªæ–¹é¢ï¼šé™æµã€ç†”æ–­å’Œè¿‡è½½ä¿æŠ¤ï¼š

1.  **é™æµ** **ï¼ˆRate Limitingï¼‰** ï¼šé€šè¿‡æŽ§åˆ¶è¯·æ±‚çš„é€ŸçŽ‡æ¥ä¿æŠ¤ç³»ç»Ÿå…å—è¿‡å¤šè¯·æ±‚çš„æŠ€æœ¯æ‰‹æ®µã€‚é™æµå¯ä»¥é¿å…ç³»ç»Ÿè¢«è¿‡å¤šçš„è¯·æ±‚åŽ‹åž®ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚
1.  **ç†”æ–­** **ï¼ˆCircuit Breakingï¼‰** ï¼šé€šè¿‡åˆ‡æ–­ä¸ç¨³å®šæœåŠ¡çš„è°ƒç”¨æ¥ä¿æŠ¤ç³»ç»Ÿå…å—æœåŠ¡é›ªå´©æ•ˆåº”çš„æŠ€æœ¯æ‰‹æ®µã€‚å½“æœåŠ¡çš„è°ƒç”¨å‡ºçŽ°æ•…éšœæ—¶ï¼Œç†”æ–­å™¨ä¼šç«‹å³åœæ­¢å¯¹è¯¥æœåŠ¡çš„è°ƒç”¨ï¼Œå¹¶é€šè¿‡é™çº§å¤„ç†æ¥ä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚
1.  **è¿‡è½½ä¿æŠ¤ï¼ˆOverload Protectionï¼‰** ï¼šé€šè¿‡æ‹’ç»è¿‡å¤šçš„è¯·æ±‚æ¥ä¿æŠ¤ç³»ç»Ÿå…å—è¿‡è½½çš„æŠ€æœ¯æ‰‹æ®µã€‚å½“ç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œè¿‡è½½ä¿æŠ¤ä¼šæ‹’ç»æ–°çš„è¯·æ±‚å¹¶è¿”å›žé”™è¯¯ç æˆ–è€…é”™è¯¯ä¿¡æ¯ï¼Œä»¥é¿å…ç³»ç»Ÿè¢«åŽ‹åž®ã€‚

æˆ‘ä»¬å…¬å¸æ˜¯ä¸€ä¸ªå¤šç§Ÿæˆ·çš„ç³»ç»Ÿï¼Œæ‹¥æœ‰ä¸Šåƒä¸ªç”¨æˆ·ã€‚ä¸ºäº†é’ˆå¯¹ä¸åŒçš„å®¢æˆ·è¿›è¡Œ QPS é™åˆ¶ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡çš„æŽ¥å…¥å±‚å·²ç»åšäº† QPS é™åˆ¶ã€‚ä½†å®žé™…ä¸Šï¼Œåœ¨ç”¨æˆ·è¯·æ±‚è¿›å…¥ç³»ç»Ÿæ—¶ï¼Œåœ¨æœåŠ¡çš„å„ä¸ªå±‚ä¹Ÿéœ€è¦è¿›è¡Œé™æµçš„æŽ§åˆ¶ï¼Œä»¥é¿å…ç³»ç»Ÿå—åˆ°è¿‡å¤šçš„è¯·æ±‚å½±å“ï¼Œå¯¼è‡´ç³»ç»Ÿè¢«è¿‡å¤šçš„è¯·æ±‚åŽ‹åž®ã€‚è¿™ä¸ªæ˜¯ä¸€ä¸ªä»Žé¿å…æ–¹é¢å°±å¯ä»¥è§£å†³ç³»ç»Ÿç¨³å®šæ€§å’Œå¯ç”¨æ€§çš„æ–¹å¼ã€‚

å¦å¤–ï¼Œæˆ‘ä»¬çš„é™æµå¹¶ä¸æ˜¯å¾ˆç²¾å‡†ï¼Œå› ä¸ºå®¢æˆ·çš„è®¿é—®è¯·æ±‚ QPS å¹¶ä¸ä¸¥æ ¼ç­‰äºŽæˆ‘ä»¬ä¸‹æ¸¸çš„è´Ÿè½½ã€‚æˆ‘ä»¬é’ˆå¯¹ä¸åŒ QPS çš„å¤„ç†æ–¹å¼ä¸åŒï¼Œå¯¹äºŽéŸ³é¢‘è¯·æ±‚ã€æ–‡æœ¬è¯·æ±‚æˆ–å›¾åƒè¯·æ±‚ï¼ŒQPS ç›¸åŒçš„æœåŠ¡åŽ‹åŠ›ä¹Ÿä¸ä¸€æ ·ã€‚è€Œä¸”ï¼Œå¦‚æžœæˆ‘ä»¬åªæ˜¯æ ¹æ®å…¥å£ QPS çš„è¯ï¼Œå°±æ— æ³•ä¿æŠ¤æ•´ä¸ªç³»ç»Ÿã€‚

æˆ‘ä»¬è¿›å…¥ç³»ç»ŸåŽï¼Œè¿˜ä¼šç»“åˆç†”æ–­å’Œè¿‡è½½ä¿æŠ¤ï¼Œè®©ç³»ç»Ÿèƒ½å¤Ÿè‡ªé€‚åº”åœ°è§£å†³å¯èƒ½å¸¦æ¥ç¨³å®šæ€§é—®é¢˜çš„æµé‡ã€‚å› ä¸ºå½“ç³»ç»Ÿæ— æ³•å¤„ç†è¿™äº›æµé‡æ—¶ï¼Œä¸€ä¸ªå¾ˆå¥½çš„è§£å†³åŠžæ³•æ˜¯ç›´æŽ¥ä¸¢å¼ƒè¯·æ±‚ï¼Œä»¥é˜²æ­¢é€ æˆä¸¥é‡å½±å“ã€‚

### 1ã€é™æµ

é¦–å…ˆï¼ŒKitex æœ¬èº«è‡ªå¸¦äº†ä¸€ä¸ªé™æµçš„ç­–ç•¥ï¼Œä½†æ— æ³•æ»¡è¶³é«˜åº¦å®šåˆ¶çš„éœ€æ±‚ï¼Œå› ä¸ºéœ€è¦é’ˆå¯¹ä¸åŒå®¢æˆ·çš„ä¸åŒç±»åž‹è¯·æ±‚è®¾ç½®ä¸åŒçš„ QPS é™åˆ¶ï¼Œå¹¶ä¸”éœ€è¦ç»å¸¸å˜æ›´ã€‚å› ä¸ºæˆ‘ä»¬å¾ˆå¤šçš„å®¢æˆ·ä¸€æ®µæ—¶é—´æµé‡å¾ˆå¤§ï¼Œä½†æ˜¯å¦å¤–ä¸€æ®µæ—¶é—´å¯èƒ½åˆåˆ‡åˆ°äº†å…¶ä»–çš„ SaaS ä¾›åº”å•†ï¼Œè¿™æ—¶æµé‡åˆå¾ˆå°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åŠæ—¶è°ƒæ•´ä»–çš„ QPS é™åˆ¶ï¼Œé˜²æ­¢ä»–çš„çªå¢žå¯¹æˆ‘ä»¬ç³»ç»Ÿæ”¿ç­–å¸¦æ¥å½±å“ã€‚

å¹¶ä¸”è¿™ä¸ªé™åˆ¶è¿˜éœ€è¦åŽ»æ ¹æ®æˆ‘ä»¬è‡ªå·±çš„é›†ç¾¤å®¹é‡ï¼ŒåŽ»åšé›†ç¾¤æ•´ä½“çš„é™åˆ¶ï¼Œè¿™éƒ¨åˆ†æ˜¯éœ€è¦æˆ‘ä»¬å®šåˆ¶ä¸€ä¸ªè‡ªå·±æ–¹ä¾¿çš„é…ç½®ä¸­å¿ƒæ¥åšé™æµç­–ç•¥çš„å˜æ›´ã€‚æ‰€ä»¥ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬é€‰æ‹©è‡ªç ”ï¼Œæ²¡æœ‰ç›´æŽ¥ä½¿ç”¨ Kitex è‡ªå¸¦çš„é™æµç­–ç•¥ã€‚ä½†æ˜¯ï¼ŒKitex çš„é™æµç­–ç•¥åœ¨æ‰©å±•æ—¶å…·æœ‰å¾ˆå¥½çš„ç‰¹æ€§ï¼Œå¯ä»¥åŠ¨æ€åœ°æ›´æ–°é™æµçš„å®šåˆ¶ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒä»¥ä¸‹æ–‡æ¡£ï¼Œå…·ä½“çœ‹é™æµç­–ç•¥æ˜¯å¦‚ä½•å®šåˆ¶çš„ã€‚

> é™æµç­–ç•¥ï¼šKitex è‡ªå¸¦çš„é™æµç­–ç•¥æ— æ³•æ»¡è¶³æˆ‘ä»¬é«˜åº¦å®šåˆ¶çš„éœ€æ±‚ï¼Œæˆ‘ä»¬è‡ªç ”äº†åˆ†å¸ƒå¼é™æµç»„ä»¶è§£å†³å¤šç§Ÿæˆ·é™æµé—®é¢˜ï¼Œé’ˆå¯¹ä¸åŒç§Ÿæˆ·ä¸åŒåº”ç”¨å®šåˆ¶äº†æ›´ç»†åˆ†çš„é™æµç­–ç•¥ã€‚
>
> å‚è€ƒæ–‡æ¡£ï¼š[Kitex çš„é™æµç­–ç•¥å®šåˆ¶](/zh/docs/kitex/tutorials/service-governance/limiting/)

å…³äºŽå¦‚ä½•è‡ªç ”åˆ†å¸ƒå¼çš„é™æµç»„ä»¶ï¼Œä¸å±•å¼€æè¿°ã€‚

**é™æµç­–ç•¥**ï¼š

- ä¿è¯å®¢æˆ·çš„åˆç† QPS éœ€æ±‚å¾—åˆ°æ»¡è¶³
- é™åˆ¶çªå¢žå®¢æˆ·çš„ QPS
- ä¼˜åŒ–å¼¹æ€§æ‰©ç¼©èƒ½åŠ›ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

é¦–å…ˆï¼Œ**ä¿è¯å®¢æˆ·çš„åˆç†** **QPS** **éœ€æ±‚å¾—åˆ°æ»¡è¶³**ã€‚ä»€ä¹ˆæ˜¯å®¢æˆ·çš„åˆç† QPSï¼Ÿå¦‚æžœè¿™ä¸ªæ˜¯å®¢æˆ·ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è¿™ä¸ªå®¢æˆ·çš„æµé‡ç‰¹æ€§æ¥çœ‹ä»–ä»€ä¹ˆæ˜¯åˆç†çš„ã€‚æ¯”å¦‚å¾ˆå¤šçš„äº’è”ç½‘å®¢æˆ·ï¼Œä»–ä»¬çš„æµé‡ç‰¹æ€§æœ‰æ˜Žæ˜¾çš„æ³¢å³°ã€æ³¢è°·ï¼Œæ‰€ä»¥åœ¨ä¸åŒçš„æ—¶é—´çš„æµé‡å‡ ä¹Žæ˜¯æ’é™çš„ï¼Œé™¤éžæœ‰ä¸€äº›æ´»åŠ¨ä¼šäº§ç”Ÿçªå¢žçš„æµé‡ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä»–ä¹Ÿä¼šè·Ÿæˆ‘ä»¬åŽ»æå‰æŠ¥å¤‡ï¼Œé¢„ç•™æœºæ¢°å°±å¯ä»¥è§£å†³ä¸´æ—¶æ´»åŠ¨äº§ç”Ÿçš„çªå¢žæµé‡ã€‚

å¦å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šç±»ä¼¼ç½‘ç›˜è¿™æ ·çš„å®¢æˆ·ï¼Œä»–ä»¬çš„æµé‡ä¼šå‘ˆçŽ°æ˜Žæ˜¾çš„å³°å€¼å’Œè°·å€¼ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œ QPS é™åˆ¶æ—¶ï¼Œè¿˜å¼€å‘äº†ä¸€å¥—ç³»ç»Ÿæ¥é¢„æµ‹å®¢æˆ·çš„æµé‡ã€‚è€Œä¸”ï¼Œå¾ˆå¤šå®¢æˆ·çš„æµé‡çªå¢žæ˜¯æœ‰è§„å¾‹çš„ï¼Œå³ä½¿å…¨å¤©æ²¡æœ‰æ˜Žæ˜¾çš„æ³¢æŽ§å’Œæ³¢è°·ï¼Œå¾ˆå¤šæ—¶å€™çš„çªå¢žä¹Ÿæ˜¯æœ‰æ—¶é—´çš„ç‰¹æ€§ã€‚ä¾‹å¦‚åœ¨å‘¨äº”å®¢æˆ·ç«¯å‘ç‰ˆçš„æ—¶å€™ï¼Œç»å¸¸ä¼šå‡ºçŽ°æµé‡çªå¢žï¼Œå¹¶ä¸”åœ¨åœ¨å‘¨å…­ã€å‘¨æ—¥ä¸€äº›èŠ‚å‡æ—¥ä¹Ÿä¼šå‡ºçŽ°æµé‡çªå¢žã€‚æˆ‘ä»¬é€šè¿‡é’ˆå¯¹å‡ åƒå®¶çš„å®¢æˆ·å­¦ä¹ æµé‡çš„ç‰¹æ€§ï¼Œå¹¶æ ¹æ®å…¶ç‰¹æ€§è®¡ç®—ç³»ç»Ÿåº”è¯¥ä¿ç•™å¤šå°‘åˆç†çš„å†—ä½™ï¼Œä»¥æ»¡è¶³å½“å‰å®¢æˆ·çš„æµé‡éœ€æ±‚ã€‚

![shumei8](/img/users/shumei/shumei8.png)

æˆ‘ä»¬ä¼šåœ¨è¿™å¥—é™åˆ¶çš„æƒ…å†µä¸‹ï¼Œå¦‚æžœæµé‡ä¸Žä¹‹å‰é¢„æµ‹çš„ QPS ä¸ä¸€è‡´ï¼Œæˆ‘ä»¬å°†é™åˆ¶è¿™éƒ¨åˆ†çªå¢žçš„ QPSï¼Œä½†æ˜¯è¿™æ ·ç”¨æˆ·ä½“éªŒæ˜¯ä¸å¥½çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬åº”è¯¥è§£å†³çš„é—®é¢˜æ˜¯ï¼šæ ¹æ®æµé‡åé¦ˆè¿›è¡Œå¼¹æ€§æ‰©ç¼©ï¼Œä»¥ä¼˜åŒ–ç”¨æˆ·ä½“éªŒå¹¶æ»¡è¶³å¤§éƒ¨åˆ†ç”¨æˆ·çš„è¯·æ±‚ QPSã€‚å¦‚æžœå¼¹æ€§æ‰©ç¼©çš„é€Ÿåº¦è¶Šå¿«ï¼Œé‚£è¿™éƒ¨åˆ†çªå¢žçš„ QPS å¯ä»¥åœ¨å¼¹æ€§æ‰©ç¼©ä¹‹åŽï¼Œå–æ¶ˆå¯¹å®¢æˆ·çš„ QPS é™åˆ¶ã€‚è¿™æ ·å¯ä»¥ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼Œä¿è¯å¤§éƒ¨åˆ†ç”¨æˆ·çš„è¯·æ±‚ QPS å¯ä»¥å¾—åˆ°æ»¡è¶³ã€‚

**åŸºæœ¬å¯ç”¨æ€§ä¿è¯**

å¯¹äºŽåŸºæœ¬çš„å¯ç”¨æ€§ä¿è¯ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯å…¸åž‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¯¹äºŽåˆ†å¸ƒå¼çš„å¾®æœåŠ¡æ¥è¯´ï¼Œå¾ˆå¤šä»¥å‰çš„åšæ³•ï¼Œæ¯”å¦‚ç›¸å¯¹äºŽå•ä½“æœåŠ¡æ¥è¯´ï¼Œæˆ‘ä»¬çš„è°ƒç”¨æ–¹å¼å‘ç”Ÿäº†å˜åŒ–ï¼Œå˜æˆäº†è®¸å¤šæœ¬åœ°å‡½æ•°çš„è°ƒç”¨ï¼Œè¿™äº›è°ƒç”¨éƒ½å˜æˆäº†ç½‘ç»œè°ƒç”¨ã€‚è€Œä¸”ï¼Œä¸€æ—¦å˜æˆäº†ç½‘ç»œè°ƒç”¨ï¼Œå°±å­˜åœ¨å„ç§å¤±è´¥çš„å¯èƒ½æ€§ã€‚

å› ä¸ºåˆ†å¸ƒå¼æœåŠ¡ä¸Žå•ä½“æœåŠ¡æœ€å¤§çš„åŒºåˆ«åœ¨äºŽï¼Œæˆ‘ä»¬å¾ˆå¤šè°ƒç”¨å¹¶ä¸èƒ½ç™¾åˆ†ä¹‹ç™¾æˆåŠŸï¼Œæ‰€ä»¥åœ¨æ•´ä¸ªå¯ç”¨æ€§çš„æ²»ç†ä¸Šï¼Œé¦–è¦çš„äº‹æƒ…æ˜¯é’ˆå¯¹è¿œç¨‹çš„è°ƒç”¨åº”è¯¥å»ºç«‹è‡ªå·±çš„é‡è¯•æœºåˆ¶ï¼Œå‰ææ˜¯è¯·æ±‚æ˜¯å¯é‡è¯•çš„ï¼Œå¿…é¡»ä¿è¯é‡è¯•æ˜¯å¹‚ç­‰çš„ï¼Œæ‰èƒ½å®šåˆ¶è‡ªå·±çš„é‡è¯•ç­–ç•¥ã€‚å¦‚æžœè¯·æ±‚ä¸èƒ½åšåˆ°å¹‚ç­‰ï¼Œé‡è¯•ç­–ç•¥å¯èƒ½ä¸æ˜¯æœ€ä½³é€‰æ‹©ã€‚è¿™é‡Œæä¾›ä¸€ç§è®¾ç½®é‡è¯•æ¬¡æ•°çš„å…¬å¼ï¼Œå‡è®¾å•æ¬¡è¯·æ±‚çš„æˆåŠŸçŽ‡æ˜¯ 99%ï¼Œä¸€æ¬¡é‡è¯•ç”¨åŽ» 100%å‡åŽ»ä¸¤æ¬¡å¤±è´¥çš„æ¦‚çŽ‡ï¼Œç³»ç»Ÿå¯ä»¥åœ¨å¤§æ¦‚çŽ‡ä¸‹è¾¾åˆ° 4 ä¸ª 9 çš„å¯ç”¨æ€§ï¼Œä¸¤æ¬¡è¿›è¡Œé‡è¯•å¯ä»¥è¾¾åˆ° 6 ä¸ª 9 çš„å¯ç”¨æ€§ã€‚

**é‡è¯•ç­–ç•¥**

- å‡è®¾å•æ¬¡è¯·æ±‚æˆåŠŸçŽ‡ 99%
- ä¸€æ¬¡é‡è¯• 1-(1-99%ï¼‰\* (1-99%ï¼‰=99.99%
- ä¸¤æ¬¡é‡è¯• 1-(1-99%ï¼‰_ (1-99%ï¼‰ _ (1-99%ï¼‰ =99.9999%

> å‚è€ƒæ–‡æ¡£ï¼š[Kitex é‡è¯•å®šåˆ¶](/zh/docs/kitex/tutorials/service-governance/retry/)

![shumei9](/img/users/shumei/shumei9.png)

å¦å¤–é’ˆå¯¹å»¶æ—¶ï¼Œå‡è®¾ 99% çš„è¯·æ±‚éƒ½å¯ä»¥åœ¨ 10 æ¯«ç§’çš„æƒ…å†µä¸‹åŽ»å®Œæˆï¼Œäº§ç”Ÿä¸€æ¬¡é‡è¯•ï¼Œæœ‰ä¸€éƒ¨åˆ†çš„è¯·æ±‚æ—¶é—´å¯èƒ½å°±å˜æˆäº† 20 æ¯«ç§’ã€‚å¦‚æžœæœ‰ä¸¤æ¬¡é‡è¯•ï¼ŒåŒæ—¶æœ‰ä¸€éƒ¨åˆ†è¯·æ±‚çš„å»¶æ—¶å°±å˜æˆäº† 30 æ¯«ç§’ã€‚

é¦–å…ˆï¼Œé‡è¯•å¯ä»¥æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å¤šä¸ªæ¨¡å—é…åˆä¸‹çš„å¯ç”¨æ€§ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¢žåŠ é‡è¯•æ¬¡æ•°ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé‡è¯•ä¹Ÿå¯èƒ½æ˜¯æœ‰å®³çš„ã€‚ä¾‹å¦‚ï¼Œå½“æœåŠ¡è¯·æ±‚é‡éžå¸¸å¤§æ—¶ï¼Œå¦‚æžœæŸä¸ªæœåŠ¡å‡ºçŽ°äº†å¤§é‡å¤±è´¥ï¼Œä»ç„¶è¿›è¡Œé‡è¯•ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡å™¨åŽç«¯çš„åŽ‹åŠ›çž¬é—´å¢žåŠ ä¸ºæ•´ä¸ªç³»ç»Ÿçš„ä¸€å€ï¼Œè€Œå¾ˆå¤šæ—¶å€™å¯¹æ•´ä¸ªç³»ç»Ÿä¿ç•™çš„å†—ä½™ä¸å¯èƒ½è¾¾åˆ°ä¸€å€ï¼Œæ­¤æ—¶å°±ä¼šå¼•å‘æœåŠ¡å™¨é›ªå´©ã€‚å‡è®¾å…¥å£çš„è¯·æ±‚æ˜¯ 600 QPS åˆ°æŸä¸€å±‚æœåŠ¡ï¼Œåªè¦å¤±è´¥å°±è¿›è¡Œé‡è¯•ï¼Œæ­¤æ—¶çš„ QPS å¯èƒ½è¦æŽ¥è¿‘ 1200 QPSã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ç³»ç»Ÿä¸­å¤„ç†çš„å¤§éƒ¨åˆ†è¯·æ±‚å¯èƒ½éƒ½æ˜¯æœ‰å®³çš„é‡è¯•è¯·æ±‚ï¼Œå®¢æˆ·çœŸå®žçš„è¯·æ±‚å¹¶æ²¡æœ‰å¾—åˆ°æœ‰æ•ˆçš„åé¦ˆã€‚

### 2ã€ç†”æ–­

**é‡è¯•ç†”æ–­**

Kitex æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„æœºåˆ¶ï¼Œå«**é‡è¯•ç†”æ–­**çš„æœºåˆ¶ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯é‡è¯•çš„å¤±è´¥çŽ‡é”™è¯¯é˜ˆå€¼ï¼Œç›®å‰ç³»ç»Ÿæ¡†æž¶å…è®¸çš„é˜ˆå€¼èŒƒå›´æ˜¯ 10% - 30%ï¼Œé»˜è®¤çš„é˜ˆå€¼ä¸º 10%ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœé‡è¯•æ¬¡æ•°è®¾ç½®ä¸º 1ï¼Œå½“é‡åˆ°å¤±è´¥æ—¶å°†è¿›è¡Œé‡è¯•ï¼Œæ­¤æ—¶æŸä¸€å±‚æœåŠ¡çš„æµé‡å°†ç¿»å€ã€‚å¦‚æžœå¼€å¯äº†ç†”æ–­é‡è¯•ï¼Œç†”æ–­åªä¼šå¢žåŠ  10% å·¦å³çš„è¯·æ±‚ï¼Œå› æ­¤åªè¦æŸä¸€å±‚æœåŠ¡ä¿ç•™äº†è‡³å°‘ 10% ä»¥ä¸Šçš„å†—ä½™æœåŠ¡å™¨ï¼Œå°±å¯ä»¥ä¿è¯æœåŠ¡ä¸å‘ç”Ÿé›ªå´©ã€‚

![shumei10](/img/users/shumei/shumei10.png)

é’ˆå¯¹äºŽé‡è¯•ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªæœºåˆ¶ï¼Œå³é‡è¯•å¤šæ¬¡ä¼šå¯¼è‡´å»¶æ—¶å¢žåŠ ï¼Œæ¯”å¦‚ 99% åˆ†ä½çš„è¯·æ±‚è€—æ—¶æ˜¯ 10 æ¯«ç§’ï¼Œé’ˆå¯¹äºŽè¯·æ±‚è®¾ç½®çš„è¶…æ—¶æ˜¯ 500 æ¯«ç§’çš„è¯ï¼Œå¾ˆå¤šæ—¶å€™å¦‚æžœç¢°è§ä¸€ä¸ªè¶…æ—¶ï¼Œå®ƒå°†åœ¨ 500 æ¯«ç§’ä¹‹åŽæ‰è¿›è¡Œä¸€æ¬¡é‡è¯•ã€‚

ä½†æ˜¯ Kitex å¸¦äº†ä¸€ä¸ªåŠŸèƒ½å« backup requestï¼Œå¯ä»¥åšåˆ°åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œæ¯”å¦‚ 99% åˆ†ä½æ˜¯ 10 æ¯«ç§’ï¼Œå¦‚æžœåœ¨ 10 æ¯«ç§’ä¹‹å†…æ²¡æœ‰è¿”å›žç»“æžœçš„è¯ï¼Œå°±ç«‹å³åŽ»å‘å‡ºå¦ä¸€æ¬¡çš„è¯·æ±‚ï¼Œè¿™æ ·ä¸éœ€è¦ç­‰åˆ° 500 ç§’çš„è¶…æ—¶å†è¿›è¡Œé‡è¯•ï¼Œè¿™æ˜¯ä¸€ä¸ªé™ä½Žç³»ç»Ÿå»¶æ—¶çš„å¾ˆå¥½æ–¹å¼ã€‚ 2013 å¹´ï¼Œ Google å‘äº†ä¸€ç¯‡æ–‡ç« å« the tail at scaleï¼Œè¿™ç¯‡æ–‡ç« é‡Œå°±è¯¦ç»†äº†ä»‹ç»è¿™ç§æœºåˆ¶æ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„ï¼Œæ„Ÿå…´è¶£å¯ä»¥äº†è§£ã€‚

> the tail at scale
>
> https://research.google/pubs/pub40801/

**æœåŠ¡ç²’åº¦/å®žä¾‹ç²’åº¦ç†”æ–­**

é’ˆå¯¹äºŽç†”æ–­ï¼Œè¿˜æä¾›äº†ä¸¤ç§æœºåˆ¶ï¼šæœåŠ¡ç²’åº¦ç†”æ–­å’Œå®žä¾‹ç²’åº¦ç†”æ–­ã€‚ä¹‹å‰åœ¨çº¿ä¸ŠæœåŠ¡å‡ºçŽ°é—®é¢˜ï¼Œå¦‚ ASR æœåŠ¡æˆ– OCR æœåŠ¡æŒ‚äº†ï¼Œéœ€è¦æ‰‹åŠ¨å°†è¯¥æœåŠ¡æ‘˜é™¤ï¼Œç„¶åŽç­‰å¾…æ‰©å®¹æ»¡è¶³æµé‡éœ€æ±‚å†å°†æœåŠ¡å™¨é‡æ–°æŒ‚å›žæ¥ã€‚ä½†æ˜¯ Kitex è‡ªå¸¦äº†ä¸€ä¸ªç†”æ–­æœºåˆ¶ï¼Œå¯ä»¥è‡ªåŠ¨è§£å†³é—®é¢˜ï¼Œå½“æŸä¸ªæœåŠ¡å‘ç”Ÿè¿‡è½½æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨æ‘˜é™¤è¿™ä¸ªæœåŠ¡çš„è°ƒç”¨ï¼Œé¿å…è¿ç»´æ‰‹åŠ¨è¿›è¡Œä¸€äº›è¿ç»´æ“ä½œã€‚

- æœåŠ¡ç²’åº¦ç†”æ–­è‡ªåŠ¨æ‘˜é™¤å¼‚å¸¸æœåŠ¡è¿›è¡Œç³»ç»Ÿé™çº§ã€‚
- å®žä¾‹ç²’åº¦ç†”æ–­ç»Ÿè®¡ï¼Œä¸»è¦ç”¨äºŽè§£å†³å•å®žä¾‹å¼‚å¸¸é—®é¢˜ï¼Œä¾‹å¦‚éƒ¨åˆ†å®žä¾‹è´Ÿè½½è¿‡é«˜æˆ–è€…äº‘ä¸Šç»å¸¸ç¢°åˆ°çš„ç½‘ç»œé—®é¢˜ã€‚

é’ˆå¯¹äºŽæœåŠ¡ç²’åº¦è¿™ç§ç†”æ–­ï¼Œå…¶å®žæœ‰çš„æ—¶å€™æ˜¯æ¯”è¾ƒæœ‰é£Žé™©çš„ã€‚æ¯”å¦‚è¯´å› ä¸ºä¸€äº›ç½‘ç»œçš„é—®é¢˜æˆ–è€…å‚æ•°çš„è®¾ç½®ï¼Œå¯¼è‡´è¯´è¿™ä¸ªæœåŠ¡è¢«å¼‚å¸¸çš„æ‘˜æŽ‰çš„è¯ï¼Œå…¶å®žä¼šå¯¼è‡´æˆ‘ä»¬å¤§é‡ç³»ç»Ÿå¤±è´¥ï¼Œæ­¤æ—¶ä¹Ÿæ˜¯ä¸€ç§å¼‚å¸¸ã€‚

åœ¨çº¿ä¸Šï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°å•å®žä¾‹é—®é¢˜ï¼Œä¾‹å¦‚æŸä¸ªå®žä¾‹çš„è´Ÿè½½è¿‡é«˜ã€‚ç”±äºŽä¸åŒ QPS çš„è´Ÿè½½å¹¶ä¸æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œå› æ­¤æˆ‘ä»¬è¿˜ä¼šé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œä¾‹å¦‚æŒ‰éœ€æœºå™¨æ‹‰èµ·åŽä¸Šæ¸¸ç½‘ç»œå’Œå½“å‰æœºå™¨ç½‘ç»œéœ€è¦é¢„çƒ­ï¼Œè¿™å°±ä¼šäº§ç”Ÿå¾ˆå¤šè¶…æ—¶æƒ…å†µã€‚ä¸‹é¢æ˜¯ Kitex å¦‚ä½•å®šåˆ¶ç†”æ–­ç­–ç•¥ä»¥åŠå¦‚ä½•è®¾ç½®ç›¸å…³å‚æ•°çš„æ–‡æ¡£ã€‚

> å‚è€ƒæ–‡æ¡£ï¼š[Kitex ç†”æ–­å®šåˆ¶](/zh/docs/kitex/tutorials/service-governance/circuitbreaker/)

### 3ã€è¿‡è½½ä¿æŠ¤

**Kitex** **æœåŠ¡çš„è¿‡è½½ä¿æŠ¤**

**ä¸šåŠ¡é€»è¾‘å±‚å¤§å¤šæ˜¯ IO å¯†é›†åž‹æœåŠ¡ï¼Œæ€§èƒ½æµ‹è¯•è¾ƒå¤§çš„å¼€é”€æ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„å¼€é”€ã€‚** æˆ‘ä»¬çº¿ä¸Šå¤§éƒ¨åˆ†æœåŠ¡éƒ½æ˜¯æˆæœ¬æ¯”è¾ƒé«˜çš„ï¼Œéƒ½æ˜¯è®¡ç®—å¯†é›†åž‹çš„æœåŠ¡ã€‚å¹¶ä¸”ä¸šåŠ¡å±‚çš„æœåŠ¡å®ƒçš„å•æœº QPS æ˜¯ç›¸å¯¹æ¯”è¾ƒé«˜çš„ï¼Œè‡³å°‘ä¹Ÿæœ‰å‡ ç™¾æˆ–è€…æ˜¯ä¸Šåƒçš„ QPSã€‚æˆ‘ä»¬å¾ˆå¤šæ—¶å€™è¿‡è½½ä¿æŠ¤ä¼šé’ˆå¯¹äºŽä¸åŒçš„æœåŠ¡åŽ»ä½¿ç”¨ä¸åŒçš„ç­–ç•¥ï¼Œæ¯”å¦‚è¯´è®¡ç®—å¯†é›†å¯èƒ½æœåŠ¡ï¼Œå¯èƒ½å®ƒå•å‡»åªæœ‰ 50 QPSï¼Œå®ƒçš„è¿‡è½½ä¿æŠ¤è®¾ç½®å°±éœ€è¦æ›´æ¿€è¿›ä¸€ç‚¹ã€‚è€Œåƒè¿™ç§æœ‰å‡ ç™¾å’Œå‡ åƒçš„è¿™äº›æœåŠ¡çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€äº›ä¸å¤ªæ¿€è¿›çš„ç­–ç•¥ã€‚ç„¶åŽè¿™é‡Œ Kitex å®ƒæœ¬èº«æä¾›çš„è¿‡è½½ä¿æŠ¤çš„æœºåˆ¶æ˜¯é€šè¿‡åŽ»è®¾ç½®ä¸€ä¸ªæœ€å¤§è¿žæŽ¥æ•°ï¼Œæˆ–è€…æ˜¯è®¾ç½®å®ƒæœ€å¤§çš„ QPS è¿™ä¸ªæœºåˆ¶æ¥å®žçŽ°çš„ã€‚

ä½†æ˜¯ï¼Œå¯¹äºŽæ‹¥æœ‰å¤§é‡ä¸åŒæœåŠ¡çš„ç»„ç»‡æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªæœºåˆ¶å¯èƒ½å¹¶ä¸æ˜¯ç‰¹åˆ«å¥½ç»´æŠ¤ã€‚è®¾ç½®ä¸€ä¸ªæœ€å¤§ QPS å¯èƒ½ä¼šé¢ä¸´ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æžœè®¾ç½®å¾—æ¯”è¾ƒå°ï¼Œå¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨èµ„æºçš„æµªè´¹ã€‚å¦‚æžœæœåŠ¡ç»è¿‡å¤šæ¬¡çš„è¿­ä»£ï¼Œå…¶æ€§èƒ½å¯èƒ½ä¼šä¸‹é™ï¼Œè€Œæœ€å¤§ QPS æ²¡æœ‰æ›´æ–°ï¼Œåˆ™å¯èƒ½å¯¼è‡´è¯¥æœåŠ¡äº§ç”Ÿè¿‡è½½çš„é£Žé™©ã€‚å› æ­¤ï¼Œæ›´å¥½çš„é€‰æ‹©å¯èƒ½æ˜¯æä¾›ä¸€ä¸ªå¯ä»¥è‡ªé€‚åº”è¿‡è½½ä¿æŠ¤çš„ç³»ç»Ÿï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨è®¾ç½®ä¸€ä¸ªå›ºå®šçš„ QPS æˆ–è¿žæŽ¥æ•°ã€‚

æˆ‘ä»¬çš„éœ€æ±‚æ˜¯éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿ**è‡ªé€‚åº”è¿‡è½½ä¿æŠ¤çš„ç³»ç»Ÿ**ï¼Œä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®ä¸€ä¸ªå›ºå®šçš„ QPS æˆ–è¿žæŽ¥æ•°ã€‚ä¸ºäº†å®žçŽ°è¿‡è½½ä¿æŠ¤ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å¦ä¸€ä¸ªå¼€æºè½¯ä»¶ Sentinelã€‚é€šè¿‡ä½¿ç”¨ Sentinelï¼Œæˆ‘ä»¬å¯ä»¥è®©æœåŠ¡å™¨æœ€å¤§é™åº¦åœ°åˆ©ç”¨ç³»ç»Ÿçš„èµ„æºï¼Œæ‰¿å—æ›´å¤šçš„åžåé‡ã€‚

**è¿‡è½½ä¿æŠ¤ç›®æ ‡ï¼š**

- ä¿è¯ç³»ç»Ÿä¸è¢«æ‹–åž®
- åœ¨ç³»ç»Ÿç¨³å®šçš„å‰æä¸‹ï¼Œä¿æŒç³»ç»Ÿçš„åžåé‡

![shumei11](/img/users/shumei/shumei11.png)

> å‚è€ƒæ–‡æ¡£ï¼šhttps://sentinelguard.io/zh-cn/docs/golang/system-adaptive-protection.html

åœ¨å¤„ç†çº¿ä¸Šé—®é¢˜æ—¶ï¼Œç¬¬ä¸€æ­¥æ˜¯æ‰¾åˆ°ä¸€ç§åº”æ€¥æŽªæ–½ï¼Œä»¥ç¡®ä¿å®¢æˆ·çš„è¯·æ±‚å¾—åˆ°æ»¡è¶³ã€‚ä¾‹å¦‚ï¼Œå½“æœåŠ¡å™¨äº§ç”Ÿå¤§é‡ 5XX æœåŠ¡æ—¶ï¼Œå¯ä»¥é‡‡å–ä¸€äº›æŽªæ–½æ¥ç¼“è§£æœåŠ¡åŽ‹åŠ›ã€‚æ­¤å¤–ï¼Œå½“æœåŠ¡ä¸æ­£å¸¸æ—¶ï¼Œéœ€è¦åŠæ—¶å¤„ç†ï¼Œé¿å…å½±å“å®¢æˆ·çš„ä½¿ç”¨ä½“éªŒã€‚å¯¹äºŽ ChatGPT æœåŠ¡ï¼Œå¯èƒ½ä¼šé‡åˆ°æœåŠ¡è¿‡è½½çš„æƒ…å†µï¼Œæ­¤æ—¶éœ€è¦é‡‡å–ç›¸åº”çš„é™çº§æŽªæ–½ã€‚

æˆ‘ä»¬å‡ºçŽ°é—®é¢˜çš„æ—¶å€™ï¼Œåˆ†å¸ƒå¼çš„ç³»ç»Ÿä¸€å®šè¦æœ‰è¶…æ—¶è¿™ä¸ªæœºåˆ¶æ¥ä¿æŠ¤å¤§å®¶ã€‚å¦å¤–ä¸€ä¸ªå½“å‡ºçŽ°é—®é¢˜çš„æ—¶å€™è¦åŠæ—¶åœ°è¿›è¡Œçº¿ä¸Šç³»ç»Ÿçš„é™çº§ã€‚ä¸ºä»€ä¹ˆè¯´åƒ ChatGPT æˆ–è€…æ˜¯è¯´æˆ‘ä»¬çŽ°åœ¨è¿™äº› AI çš„æœåŠ¡ç»å¸¸ä¼šæç¤ºè¯´æˆ‘çŽ°åœ¨æŸä¸ªåŠŸèƒ½ä¸å¯ç”¨ï¼Ÿè¿™å¾ˆå¤§ä¸€éƒ¨åˆ†åŽŸå› æ˜¯æˆ‘ä»¬è¿‡åŽ»çš„æœåŠ¡å¯¹æ•´ä¸ªç®—åŠ›çš„è¦æ±‚å…¶å®žæ˜¯æ¯”è¾ƒä½Žçš„ï¼Œä½†æ˜¯åƒæˆ‘ä»¬çŽ°åœ¨è¿™äº›æœºå™¨å­¦ä¹ çš„ç³»ç»Ÿï¼Œå®ƒç®—åŠ›çš„è¦æ±‚éžå¸¸é«˜ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬æ˜¯æ— æ³•æ»¡è¶³å³°å€¼çš„èµ„æºéœ€æ±‚ã€‚

æˆ‘ä»¬æ˜¯åŽ»äº‘åŽ‚å•†é‚£é‡Œç§Ÿç”¨ GPUï¼Œå½“äº‘åŽ‚å•†çš„èµ„æºå¯èƒ½æ— æ³•æ»¡è¶³æˆ‘ä»¬å¦‚æ­¤é«˜çš„å¹¶å‘æµé‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªèƒ½é€‰æ‹©é™ä½ŽæœåŠ¡ç­‰çº§ï¼ŒåªæœåŠ¡äºŽæŸäº›é‡è¦çš„å®¢æˆ·ï¼Œæˆ–è€…ä¸Žå®¢æˆ·å•†é‡ï¼Œå°†æµé‡åˆ‡æ¢åˆ°å…¶ä»–å®¢æˆ·ï¼Œå¹¶ä¸”åŒæ—¶å°è¯•è´­ä¹°æœ‰ä½™é‡é›†ç¾¤çš„èµ„æºï¼Œå¹¶ä¸”åšå¤šæœºæˆ¿åˆ‡æ¢æ±‚ã€‚ä¾‹å¦‚ï¼Œç›®å‰æ–°å‡ºçš„ GPT æœåŠ¡ GPU çš„æ¶ˆè€—éžå¸¸é«˜ï¼Œä¸”å•å¡æ— æ³•è¿›è¡Œ Inferenceï¼Œéœ€è¦ä½¿ç”¨å¤šå¡ã€‚å¦‚æžœå…¨çƒæ‰€æœ‰ç”¨æˆ·åŒæ—¶æ¶Œå…¥è¯¥ç³»ç»Ÿï¼Œåˆ™å¾ˆéš¾æ»¡è¶³è¿™ç§ç³»ç»Ÿçš„éœ€è¦ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œä¼ ç»Ÿçš„ç®—åŠ›éœ€æ±‚è¾ƒå°çš„æœåŠ¡ï¼Œå¦‚ IO å¯†é›†åž‹æœåŠ¡ï¼Œå¯¹èµ„æºçš„æ¶ˆè€—ç›¸å¯¹è¾ƒä½Žï¼Œå¯èƒ½ç›¸å¯¹å®¹æ˜“çš„åœ¨é›†ç¾¤ä¸­å¿«é€Ÿå¢žåŠ  è®¡ç®—å’Œå­˜å‚¨èµ„æºï¼Œå¯ä»¥ä¸ºå…¨éƒ¨ç”¨æˆ·æä¾›é«˜è´¨é‡çš„æœåŠ¡ï¼ŒæœåŠ¡çš„å¯ç”¨æ€§è™½ç„¶å¯èƒ½å­˜åœ¨é—®é¢˜ï¼Œä½†æŒç»­æ—¶é—´è¾ƒçŸ­ã€‚

å¯¹äºŽæœºå™¨å­¦ä¹ æœåŠ¡ï¼Œç”±äºŽéš¾ä»¥åè°ƒå¤§é‡çš„ GPU è®¡ç®—èµ„æºã€‚ä¸€äº›ç‰¹æ®Šæ—¶æœŸï¼Œè¿™æ—¶æˆ‘ä»¬åŽ»æ‰€æœ‰çš„äº‘åŽ‚å•†éƒ½ä¹°ä¸åˆ°è¶³å¤Ÿå¤šçš„æœåŠ¡å™¨ï¼Œåªèƒ½å¯¹æ•´ä¸ªæœåŠ¡è¿›è¡Œé™çº§ï¼Œåªæ»¡è¶³éƒ¨åˆ†æœåŠ¡çš„ç”¨æˆ·çš„éœ€æ±‚ã€‚æœ‰å…³è¿‡è½½ä¿æŠ¤ç›¸å…³çš„å·¥ä½œï¼Œä¹Ÿæ˜¯ä¸ºäº†åœ¨æœåŠ¡å™¨å‘ç”Ÿä¸€äº›èµ„æºä¸è¶³çš„æ—¶å€™ï¼Œé¦–å…ˆè¿‡è½½ä¿æŠ¤ç¬¬ä¸€ä»¶äº‹å°½å¯èƒ½åœ¨æˆ‘ä»¬èµ„æºçš„åˆ©ç”¨çŽ‡æ›´é«˜çš„æƒ…å†µä¸‹ï¼Œä¿è¯æœåŠ¡ä¸ä¼šå‡ºçŽ°ä¸€äº›äº‹æ•…ã€‚

å¯¹äºŽ C++çš„ GPU çš„æœåŠ¡ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒä»¬èƒ½è¾¾åˆ°ç›¸åŒçš„æ•ˆæžœï¼Œä½†å®ƒä»¬å¯èƒ½æœ¬èº«èƒ½æ‰¿å—çš„ QPS å°±æ¯”è¾ƒå°ï¼Œç¨å¾®å¤šä¸€äº›è¯·æ±‚å°±ä¼šå¯¼è‡´å¾ˆå¤šçš„é—®é¢˜ã€‚å°±åƒæˆ‘è¿™é‡Œçš„ IO å¯†é›†åž‹æœåŠ¡çš„è¿‡è½½ä¿æŠ¤å’Œ CPU å¯†é›†åž‹è¿‡è½½ä¿æŠ¤ä¸€æ ·ï¼Œå®ƒä»¬å®žçŽ°çš„åŒºåˆ«å°±åœ¨äºŽå®ƒä»¬ä¿©çš„è´Ÿè½½èƒ½æ‰¿å—çš„èŒƒå›´ï¼Œå…¶å®žæ‰¿å—çš„èŒƒå›´çš„æ³¢åŠ¨å·®è·éžå¸¸å¤§ã€‚åƒæˆ‘ä»¬è¿™ç§ IO å¯†é›†åž‹çš„æœåŠ¡ï¼ŒQPS çš„èŒƒå›´å¯èƒ½æ˜¯å‡ åƒï¼Œæ³¢åŠ¨ä¸ªå‡ ç™¾å¯¹å®ƒå½±å“ä¸æ˜¯ç‰¹åˆ«å¤§ã€‚ä½†æ˜¯å¯¹äºŽ GPU çš„æœåŠ¡ï¼Œå®ƒæœ¬èº«å¯èƒ½è¿ž 100 QPS éƒ½æ‰¿å—ä¸åˆ°ï¼Œç¨å¾®å¤š 10 QPSï¼Œç«‹é©¬ GPU çš„é˜Ÿåˆ—å°±å µä½äº†ï¼Œå°±åŸºæœ¬å°±æŒ‚æŽ‰äº†ã€‚

ä¸ºäº†é¿å…æœåŠ¡è¿‡è½½ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›æ›´ç²¾ç»†çš„æœºåˆ¶æ¥æŽ§åˆ¶å®ƒçš„è¿‡è½½ä¿æŠ¤ã€‚å¯¹äºŽ IO å¯†é›†åž‹æœåŠ¡ï¼Œé€šè¿‡é€‰åž‹æˆ‘ä»¬ä½¿ç”¨ Sentinel ç³»ç»Ÿè‡ªé€‚åº”æµæŽ§ä»Žæ•´ä½“ç»´åº¦å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡ŒæŽ§åˆ¶ï¼Œç»“åˆç³»ç»Ÿçš„ Loadã€CPU ä½¿ç”¨çŽ‡ä»¥åŠåº”ç”¨çš„å…¥å£ QPSã€å¹³å‡å“åº”æ—¶é—´å’Œå¹¶å‘é‡ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æŽ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæŽ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§åžåé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚

![shumei12](/img/users/shumei/shumei12.png)

ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªè¯·æ±‚çš„å¹³å‡å“åº”æ—¶é—´æ˜¯ 20 æ¯«ç§’ï¼Œæˆ‘ä»¬çš„ QPS å¤§æ¦‚æ˜¯ 100QPSã€‚ä½†æ˜¯å¯¹äºŽåƒæˆ‘ä»¬çš„ C++ç±»æœåŠ¡æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´ç²¾ç»†çš„æœºåˆ¶æ¥å¿«é€Ÿå“åº”è¿‡è½½ä¿æŠ¤ã€‚

### é˜Ÿåˆ—

åœ¨å¾®æœåŠ¡ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å­˜åœ¨ä¸€ä¸ªæ— å¤„ä¸åœ¨çš„é˜Ÿåˆ—ï¼Œæ— è®ºæ˜¯ç½‘å¡ã€CPUï¼Œè¿˜æ˜¯ RPC æœåŠ¡å™¨ï¼Œéƒ½éœ€è¦å­˜åœ¨äºŽè¯¥é˜Ÿåˆ—ä¸­ã€‚è¯¥é˜Ÿåˆ—çš„å“åº”æ—¶é—´ç­‰äºŽæŽ’é˜Ÿæ—¶é—´åŠ ä¸ŠæœåŠ¡å“åº”æ—¶é—´ï¼Œå¦‚æžœè¯·æ±‚å¯ä»¥ç«‹å³å¤„ç†ï¼Œåˆ™å‡ ä¹Žä¸å­˜åœ¨æŽ’é˜Ÿæ—¶é—´ã€‚ä½†å¦‚æžœä¸‹æ¸¸è¯·æ±‚ä¸èƒ½åŠæ—¶å“åº”ï¼Œåˆ™éœ€è¦åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…å¤„ç†ã€‚

> å“åº”æ—¶é—´ = æŽ’é˜Ÿæ—¶é—´ + æœåŠ¡æ—¶é—´ Response Time = Queue Time + Process Time

![shumei13](/img/users/shumei/shumei13.png)

**Thrift** **ï¼ˆC++ï¼‰/ Fbthrift æœåŠ¡çš„è¿‡è½½ä¿æŠ¤**

> åŸºç¡€æœåŠ¡å±‚å¤§å¤šæ˜¯è®¡ç®—å¯†é›†åž‹æœåŠ¡ï¼ŒCPU åˆ©ç”¨çŽ‡ç­‰ä¸å®Œå…¨ååº”ç¨‹åºçš„è´Ÿè½½ï¼ŒæœåŠ¡è¿‡è½½å¯èƒ½æ˜¯ GPU è´Ÿè½½è¿‡é«˜ã€‚ ä½¿ç”¨è¯·æ±‚åœ¨é˜Ÿåˆ—ä¸­çš„å¹³å‡ç­‰å¾…æ—¶é—´ï¼ˆâ€œqueue timeâ€ï¼‰æ¥è®¡ç®—æœåŠ¡çš„è´Ÿè½½ã€‚ä¹‹æ‰€ä»¥ä¸é€‰æ‹©è¯·æ±‚çš„å¹³å‡å¤„ç†æ—¶é—´ï¼ˆâ€œprocss timeâ€ï¼‰ï¼Œæ˜¯ä¸ºäº†åŽ»é™¤ä¸‹æ¸¸æœåŠ¡è°ƒç”¨çš„å½±å“ã€‚æœ‰æ—¶ process time çš„å¢žåŠ å¹¶ä¸ä»£è¡¨å½“å‰æœåŠ¡è¿‡è½½äº†ï¼Œè€Œæ˜¯è¯·æ±‚ä¾èµ–çš„ä¸‹æ¸¸æœåŠ¡è¿‡è½½ã€‚å¦ä¸€æ–¹é¢ï¼Œè¯·æ±‚çš„ process time å¢žåŠ åˆ°ä¸€å®šç¨‹åº¦ï¼Œå½“å‰æœåŠ¡çš„èµ„æºä¹Ÿä¼šé€æ¸è€—å°½ï¼Œæœ€ç»ˆååº”åœ¨ queue time çš„å¢žåŠ ä¸Šã€‚

æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹å›¾ï¼Œå½“æˆ‘ä»¬æ•´ä¸ª CPU æˆ–è€…æ˜¯ GPU æ•´ä½“çš„è´Ÿè½½è¾ƒé«˜çš„æ—¶å€™ï¼Œå®ƒçš„æŽ’é˜Ÿæ—¶é—´å°±ä¼šåŽ»æ— é™é•¿ã€‚æ‰€ä»¥è¿™é‡Œç»™æˆ‘ä»¬ä¸€ç§å¯å‘çš„æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªæœ€é•¿çš„é˜Ÿåˆ—ç­‰å¾…æ—¶é—´ã€‚å› ä¸ºåˆšæ‰ä¹Ÿè¯´äº†ï¼Œåœ¨æ•´ä¸ªå¾®æœåŠ¡çš„æ¡†æž¶ä¸‹ï¼Œæˆ‘ä»¬ä¸€å®šè¦å¹²çš„ä¸€ä»¶äº‹æƒ…å°±æ˜¯ä¸€å®šè¦æœ‰è¶…æ—¶çš„æœºåˆ¶ï¼Œå› ä¸ºæ²¡æœ‰è¶…æ—¶çš„æœºåˆ¶æœ€ç»ˆå¯èƒ½å¯¼è‡´æ•´ä¸ªç³»ç»Ÿéƒ½è¢«ç„Šä½ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œé’ˆå¯¹äºŽè¿™ä¸ª Queue Time è®¾ç½®ä¸€ä¸ª Timeout çš„è¯ï¼Œé‚£å°±å¯ä»¥åŽ»ä¿è¯æˆ‘ä»¬è¿™äº›è®¡ç®—å¯†é›†èƒ½æœåŠ¡åœ¨å®ƒçš„æŽ’é˜Ÿæ—¶é—´ï¼Œç­‰åˆ°ä¸€å®šæ—¶é—´çš„æ—¶å€™æˆ‘ä»¬å°±ç«‹å³ä¸¢å¼ƒè¯·æ±‚ã€‚

![shumei14](/img/users/shumei/shumei14.png)

> ç›¸å…³ç†è®ºå¯ä»¥å‚è€ƒæŽ’é˜Ÿè®º https://mp.weixin.qq.com/s/YSvvLhBYvif5ykqBXYY5xA https://arthurchiao.art/blog/traffic-control-from-queue-to-edt-zh/

ä½†æ˜¯æˆ‘ä»¬å®žè·µäº†è¿™ç§å›ºå®šçš„ Queue timeout çš„æƒ…å†µä¸‹ï¼Œå…¶å®žäº§ç”Ÿäº†å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬è®¾ç½®å›ºå®šçš„ Queue timeoutï¼Œå¦‚æžœè®¾ç½®è¿‡å¤§ï¼Œä¼šå‘çŽ°ä¿æŠ¤ä¸äº†æˆ‘ä»¬çš„ç³»ç»Ÿï¼›å¦‚æžœè®¾ç½®è¿‡å°ï¼Œå¶å°”çš„ CPU çªå¢žåˆä¼šå¯¼è‡´è¯·æ±‚ä¸¢å¼ƒã€‚æˆ‘ä»¬ä¹‹å‰å®žéªŒäº†è¿™ä¸ªè®¾ç½®ï¼Œæˆ‘ä»¬è¯·æ±‚æ˜¯ç¨³å®šåœ°å‘ QPSï¼Œä½†æ˜¯æ¯éš”ä¸€æ®µæ—¶é—´ä¼šèµ·ä¸€äº›è®¡ç®—å¯†é›†çš„æœåŠ¡ï¼Œä¼šäº§ç”Ÿ CPU çš„æ‰°åŠ¨ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±ä¼šå‘çŽ°ï¼Œåªè¦ CPU äº§ç”Ÿäº†çªå¢žï¼Œå®ƒå°±ä¼šç«‹å³ä¸¢å¼ƒè¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒè¿™ä¸ªæ—¶å€™å¾ˆéš¾åŽ»æŠ¢å  CPU çš„èµ„æºï¼Œå¯¼è‡´å¾ˆå¤šè¯·æ±‚åœ¨é˜Ÿåˆ—ä¸­æŽ’é˜Ÿã€‚

ä½†å› ä¸ºåªæ˜¯åœ¨æŸä¸ªæ—¶é—´æ®µå‡ºçŽ°çªå‘çš„æµé‡å¢žåŠ ï¼Œå¹¶ä¸èƒ½ä»£è¡¨æ•´ä¸ªæœåŠ¡å™¨çš„è´Ÿè½½ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼ä½œä¸ºä¸€ç§è´Ÿè½½ä¿æŠ¤æœºåˆ¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬ä¸¢å¼ƒè®¸å¤šè¯·æ±‚ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä¸€äº›è°ƒç ”ï¼Œå¹¶ä½¿ç”¨äº† C ++ ä½¿ç”¨çš„ Fbthrift æ–¹æ¡ˆä¸­çš„å¯å‘å¼ç®—æ³•ã€‚å¦‚æžœé˜Ÿåˆ—åœ¨è¿‡åŽ»å¾ˆé•¿æ—¶é—´æ²¡æœ‰è¢«æ¸…ç©ºï¼Œå°±å°† Queue timeout è®¾ç½®å¾—æ›´çŸ­ï¼›å¦‚æžœé˜Ÿåˆ—ä¸€ç›´æ²¡æœ‰å †ç§¯ï¼Œåˆ™å¯ä»¥å°† Queue timeout è®¾ç½®å¾—æ›´é•¿ã€‚æˆ‘ä»¬æ¯”è¾ƒäº†è¿™ä¸¤ç§æœºåˆ¶ï¼Œä¹‹å‰å…¶å®žå‚è€ƒäº†å¾®ä¿¡çš„ Queue time è®¾ç½®æ—¶é—´ï¼Œä»–ä»¬çš„è¶…æ—¶æ˜¯ 500 æ¯«ç§’ï¼Œ Queue time è®¾ç½®ä¸º 20 æ¯«ç§’ï¼Œå¯ä»¥ä¿è¯å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåœ¨æœåŠ¡å™¨å‘ç”Ÿè¿‡è½½çš„æ—¶å€™å°½å¿«åœ°ä¸¢å¼ƒè¯·æ±‚ã€‚

![shumei15](/img/users/shumei/shumei15.png)

Control Delay

> ç›¸æ¯”å›ºå®šçš„ queue timeoutï¼Œå¯è‡ªé€‚åº”çš„è°ƒæ•´ queue timeoutã€‚ ä¸Šå›¾æ˜¯è®¾ç½®å›ºå®šçš„è¾ƒçŸ­ queue timeoutï¼ˆå‚è€ƒå¾®ä¿¡çš„ 20msï¼‰ï¼Œå°å¹…çš„ CPU æŠ–åŠ¨éƒ½å°†å¯¼è‡´è¯·æ±‚å¤±è´¥ï¼Œä½†æœåŠ¡å¹¶ä¸æ˜¯æŒç»­çš„è¿‡è½½ã€‚

æˆ‘ä»¬æŠŠ Queue timeout è®¾ç½®äº†ä¸€ä¸ªç›¸å¯¹é•¿çš„æ—¶é—´ï¼Œé è‡ªé€‚åº”çš„ queue timeout æœºåˆ¶ï¼Œä¼šåœ¨æˆ‘ä»¬æœåŠ¡å™¨çš„é˜Ÿåˆ—ï¼Œæ¯”å¦‚åœ¨ 200 æ¯«ç§’ä»¥å†…æ²¡æœ‰è¢«æ¸…ç©ºçš„æ—¶å€™ï¼Œå°±ä¼šæŠŠ queue timeout è®¾ç½®ä¸ºä¸€ä¸ªæ›´çŸ­çš„æ—¶é—´ï¼Œè¾¾åˆ°å¯ä»¥å¿«é€Ÿåœ°ä¸¢å¼ƒè¯·æ±‚çš„æœºåˆ¶ã€‚

![shumei16](/img/users/shumei/shumei16.png)

> ä¸€èˆ¬æ¥è¯´æœåŠ¡å™¨ä¼šæœ‰å†…å­˜æˆ–è€…èµ„æºæ± æ•°é‡çš„é™åˆ¶ï¼Œå¹¶å°†æ²¡æœ‰æ¥å¾—åŠå¤„ç†çš„è¯·æ±‚æ”¾åœ¨ç¼“å†²åŒºã€‚ä¸€æ—¦å¤„ç†è¯·æ±‚çš„é€Ÿåº¦è·Ÿä¸ä¸Šåˆ°æ¥çš„è¯·æ±‚ï¼Œé˜Ÿåˆ—å°†ä¼šè¶Šæ¥è¶Šå¤§å¹¶ä¸”æœ€ç»ˆè¶…è¿‡ä½¿ç”¨é—²ç½®ã€‚ Facebook æ ¹æ® CoDel çš„å¯å‘è®¾è®¡äº†ä¸€å¥—ç®—æ³•ï¼šå½“å†…å­˜ç¼“å†²é˜Ÿåˆ—åœ¨è¿‡åŽ»çš„ N æ¯«ç§’å†…æ²¡æœ‰è¢«æ¸…ç©ºï¼Œåˆ™ queue ä¸­è¯·æ±‚çš„ timeout åˆ™è¢«è®¾ç½®ä¸º M æ¯«ç§’ï¼ˆä¸€èˆ¬ä¸º 10-30msï¼‰ï¼›(Optional) å½“å†…å­˜ç¼“å†²é˜Ÿåˆ—åœ¨è¿‡åŽ»çš„ N æ¯«ç§’å†…è¢«æ¸…ç©ºï¼Œåˆ™ queue ä¸­è¯·æ±‚çš„ timeout è¢«è®¾ç½®æˆ N æ¯«ç§’ã€‚

å¦å¤–ï¼Œå¤§éƒ¨åˆ†çš„ç³»ç»Ÿå…¶å®žéƒ½æ˜¯æœ‰ä¸€ä¸ªæ¶ˆè´¹é˜Ÿåˆ—çš„ï¼Œæ¯”å¦‚å¾ˆå¤š RPC çš„æ¡†æž¶ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªå¤šç”Ÿäº§è€…å•æ¶ˆè´¹è€…çš„é˜Ÿåˆ—ï¼Œä¹Ÿæœ‰ä¸€äº›æ¡†æž¶æ˜¯ä¸€ä¸ªå¤šç”Ÿäº§è€…ã€å¤šæ¶ˆè´¹è€…çš„é˜Ÿåˆ—ï¼Œç„¶åŽå¾ˆå¤šè¯·æ±‚ä¸€å®šä¼šåœ¨é˜Ÿåˆ—ä¸­åŽ»å †ç§¯ã€‚æ¯”å¦‚ Kitex ï¼Œå…¶å®žä¹‹å‰å®ƒæœ‰å®£ç§°è‡ªå·±å¹³å‡å¤„ç†æ—¶é—´çš„æ—¶å€™ï¼Œå…¶å®žå°±æ˜¯å¤„ç†çš„å»¶æ—¶ä»¥åŠé•¿å°¾çš„å»¶æ—¶ï¼Œå°±æ˜¯é’ˆå¯¹äºŽè¿™ç§å¤šç”Ÿäº§è€…ã€å¤šæ¶ˆè´¹è€…æˆ–è€…å¤šç”Ÿäº§è€…å•æ¶ˆè´¹è€…çš„é˜Ÿåˆ—ï¼Œå®ƒé™ä½Žå»¶æ—¶çš„ä¸€ä¸ªæ–¹å¼å°±æ˜¯å½“æœ‰å¤šä¸ªé˜Ÿåˆ—çš„æ—¶å€™ï¼Œå°½å¿«åœ°åŽ»æ¶ˆè´¹è¯·æ±‚ï¼Œè®©å¤§å®¶åœ¨é˜Ÿåˆ—é‡Œå †ç§¯çš„æ—¶é—´è¶³å¤ŸçŸ­ï¼Œå› ä¸ºä¸€ä¸ªè¯·æ±‚å®žé™…å¤„ç†çš„æ—¶é—´å¹¶ä¸å®Œå…¨ç­‰äºŽä»–å¤„ç†çš„æ—¶é—´ï¼Œè¿˜æœ‰ä»–åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…çš„æ—¶é—´ã€‚

è¿™äº› RPC æ¡†æž¶é€šè¿‡ä¼˜åŒ–è¯·æ±‚åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…çš„æ—¶é—´ï¼Œå¯ä»¥ä¼˜åŒ–å®žé™…å¤„ç†çš„å»¶æ—¶ã€‚æˆ‘ä»¬ä½¿ç”¨çš„ C++ æ¡†æž¶å¯ä»¥å®žçŽ°å…ˆè¿›å…ˆå‡ºçš„è¯·æ±‚æ¨¡å¼ï¼Œå³ä½¿åœ¨è¯·æ±‚å †ç§¯çš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¼šå°†æ•´ä¸ªé˜Ÿåˆ—å˜ä¸ºåŽè¿›å…ˆå‡ºã€‚è¿™æ„å‘³ç€æ–°åˆ°æ¥çš„è¯·æ±‚ä¼šè¢«å°½å¿«å¤„ç†ï¼Œè€Œå †ç§¯çš„è¯·æ±‚åˆ™å¯ä»¥åœ¨è¿™äº›é˜Ÿåˆ—æ¸…ç©ºä¹‹åŽæ‰è¿›è¡Œå¤„ç†ã€‚ç»“åˆè‡ªé€‚åº” queue timeout æœºåˆ¶ï¼Œå¯ä»¥è§£å†³æ•´ä½“è¯·æ±‚æˆåŠŸçŽ‡çš„é—®é¢˜ã€‚

æˆ‘ä»¬å¯ä»¥æƒ³è±¡ä¸€ç§åœºæ™¯ï¼Œå³å¦‚æžœæˆ‘ä»¬çš„ GPU æœåŠ¡å¤„ç†æ—¶å»¶å¾ˆé•¿ï¼Œå½“è¯·æ±‚åœ¨é˜Ÿåˆ—ä¸­å †ç§¯æ—¶é—´è¿‡é•¿æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸Šæ¸¸è¶…æ—¶ï¼Œæ­¤æ—¶åº”è¯¥ç«‹å³å°†è¯·æ±‚ä¸¢å¼ƒï¼Œè€Œä¸æ˜¯è®©å †ç§¯çš„è¯·æ±‚åŽ»æ¶ˆè€— GPU èµ„æºã€‚æ­¤å¤–ï¼Œå¯ä»¥å‚è€ƒ â€œFail at Scaleâ€ è¿™ç¯‡æ–‡ç« ï¼Œäº†è§£ queue æ—¶é—´çš„æœºåˆ¶ã€‚å¯¹äºŽ Facebook å‘å¸ƒçš„ fbthrift æ¡†æž¶æ¥è¯´ï¼Œç½‘ä¸Šå¾ˆéš¾æ‰¾åˆ°å¾ˆå¤šèµ„æ–™ï¼Œä½†é€šè¿‡å®žè·µå’Œçº¿ä¸Šé—®é¢˜ï¼Œæ‰¾åˆ°äº†è¿™ä¸¤ä¸ªå‚æ•°çš„è®¾ç½®ï¼Œå³ codel_enabled=true å’Œ queue_timeoutï¼Œå¯ä»¥è‡ªåŠ¨å®žçŽ°è‡ªé€‚åº”çš„æœºåˆ¶ã€‚é€šè¿‡å¼€å¯ gflagï¼Œå¹¶è®¾ç½®åˆç†çš„ queue timeoutï¼Œå¯ä»¥ä¿æŠ¤ GPU æœåŠ¡å…å—è¿‡è½½ã€‚

![shumei17](/img/users/shumei/shumei17.png)
Adaptive LIFO

> å¤§éƒ¨åˆ†ç³»ç»Ÿå¤„ç†è¯·æ±‚éµå¾ª FIFO (First In Last Out) åŽŸåˆ™ã€‚åœ¨å³°å€¼æµé‡å¤ªå¤§æ—¶ï¼ŒåŽæ¥çš„è¯·æ±‚å¯èƒ½ä¼šå› ä¸ºå…ˆæ¥è¯·æ±‚çš„é˜»å¡žè€Œå¯¼è‡´è¯·æ±‚è€—æ—¶æ›´é•¿ã€‚å¯¹æ­¤ Facebook æå‡ºçš„æ–¹æ¡ˆæ˜¯ adaptive LIFO (Last In First Out) ï¼Œå½“ç³»ç»Ÿå‡ºçŽ°é˜Ÿåˆ—è¯·æ±‚ç§¯åŽ‹çš„æ—¶å€™ï¼Œå°†é˜Ÿåˆ—æ¨¡å¼è‡ªåŠ¨åˆ‡æ¢ä¸º LIFOï¼ŒåŽåˆ°çš„è¯·æ±‚é¦–å…ˆæ‰§è¡Œï¼Œæœ€å¤§é™åº¦ä¸Šå¢žåŠ äº†è¯·æ±‚æˆåŠŸçš„å¯èƒ½æ€§ã€‚ Adaptive LIFO ä¸Ž CoDel èƒ½å¤Ÿéžå¸¸å¥½çš„å…¼å®¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚CoDel è®¾ç½®è¾ƒçŸ­ timeoutï¼Œé˜²æ­¢é˜Ÿåˆ—ç§¯åŽ‹è¿‡å¤šè¯·æ±‚ï¼Œadaptive LIFO å°†åŽå…¥çš„è¯·æ±‚çŽ‡å…ˆå¤„ç†ï¼Œæœ€å¤§é™åº¦å¢žåŠ è¯·æ±‚æˆåŠŸçš„æ¦‚çŽ‡ã€‚

## Kitex è½åœ°å®žè·µä¸Žæ•ˆæžœ

### æ•ˆæžœå¯¹æ¯”

å¦å¤–ï¼Œæ˜¯æˆ‘ä»¬ä¸Šçº¿äº† Kitex ä»¥åŠå¯¹æ¯”ä¸Šçº¿å‰åŽçš„æ•ˆæžœã€‚å¯ä»¥çœ‹åˆ°ï¼Œä¸Šå›¾æ˜¯ä¸Šçº¿ä¹‹å‰ï¼Œå› ä¸ºæˆ‘ä»¬ç»å¸¸æœ‰å„ç§å„æ ·çš„çªå¢žæµé‡ï¼Œçªå¢žæµé‡çš„å½±å“ä¼šæŒç»­ä¸€æ®µè¾ƒé•¿çš„æ—¶é—´ã€‚

![shumei18](/img/users/shumei/shumei18.png)

ä½†æ˜¯æ¢äº† Kitex ä»¥åŠç»“åˆä¹‹å‰å¯¹æœåŠ¡çš„ä¿æŠ¤ç­–ç•¥ä¹‹åŽï¼Œå‘çŽ°å¯èƒ½åªæœ‰åœ¨çªå¢žçš„ä¸€åˆ¹é‚£ä¼šæœ‰ä¸€éƒ¨åˆ†çš„å¤±è´¥ï¼Œä½†æ˜¯å®ƒçš„å½±å“çš„èŒƒå›´å·²ç»è¢«ç¼©åˆ°äº†å¾ˆå°ã€‚

å¯ç”¨æ€§å›¾æ˜¯å¯¹æ•°çš„åæ ‡ï¼Œä¸ºäº†è®©å¤§å®¶æ¯”è¾ƒæ˜Žæ˜¾åœ°çœ‹å‡ºæ¥å¤±è´¥çŽ‡ï¼Œå®žé™…å¤±è´¥çŽ‡å…¶å®žå¹¶ä¸é«˜ï¼Œå®žé™…å¤±è´¥çŽ‡å°äºŽåƒåˆ†ä¹‹ä¸€ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c86d33220b84693a556b9c67861aa58~tplv-k3u1fbpfcp-zoom-1.image)

> **å¯ç”¨æ€§å¯¹æ¯”**ï¼š
>
> ä¸Šå›¾å¯¹æ¯”ä¸º Kitex è°ƒç”¨ C++ åŸºç¡€æœåŠ¡æœåŠ¡å¤±è´¥æ•°/æˆåŠŸæ•°ç›‘æŽ§ã€‚ Kitex æ¡†æž¶å¯ä»¥å¾ˆå¥½çš„è§£å†³å¼¹æ€§æ‰©ç¼©ï¼Œä»¥åŠæœºå™¨è´Ÿè½½å¯¼è‡´çš„å¯ç”¨æ€§é—®é¢˜ï¼Œå°†å½±å“éƒ½é™å®šåœ¨å¾ˆå°èŒƒå›´å†…ã€‚

### ç›¸ä¼¼ä¸šåŠ¡çš„å‚è€ƒæ„è§

- **åšå¥½å®¢æˆ·** **QPS** **çš„é™åˆ¶å’Œé›†ç¾¤é¢„ç•™è¶³å¤Ÿçš„å†—ä½™ã€‚** å¯¹äºŽå…·æœ‰å¤šç§Ÿæˆ·çš„ SaaS ç³»ç»Ÿï¼Œä¸€å®šè¦åšå¥½å®¢æˆ· QPS çš„é™åˆ¶ï¼Œå› ä¸ºèµ„æºæ˜¯æœ‰é™çš„ï¼Œä¸å¯èƒ½ç»™æ¯ä¸ªå®¢æˆ·éƒ½é¢„ç•™è¶³å¤Ÿå¤šçš„ QPS è¿™ç§é™é¢ï¼Œå› ä¸ºå®žåœ¨æ˜¯å¤ªè´µäº†ã€‚æ­¤å¤–ï¼Œè¦é¢„ç•™è¶³å¤Ÿçš„å†—ä½™ï¼Œä½†æ˜¯åœ¨å¹³è¡¡æˆæœ¬æ—¶ï¼Œéœ€è¦ç›¸å¯¹ç²¾ç¡®åœ°é¢„æµ‹å®¢æˆ·çš„æµé‡ã€‚
- **è¯·æ±‚å¤„ç†é€ŸçŽ‡è·Ÿä¸ä¸Šè¯·æ±‚åˆ°è¾¾é€ŸçŽ‡ï¼Œå°½æ—©ä¸¢å¼ƒè¯·æ±‚ã€‚** åœ¨æ•´ä¸ªå¾®æœåŠ¡æž¶æž„ä¸‹ï¼Œå¤„ç†è¯·æ±‚çš„å“²å­¦ã€‚
- **é€‰æ‹©åˆé€‚çš„ç†”æ–­** **ã€è¿‡è½½ä¿æŠ¤ç­–ç•¥ã€‚** Kitex æä¾›äº†å¾ˆå¥½çš„ç†”æ–­è¿‡è½½ä¿æŠ¤çš„æœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©è‡ªå·±ç†”æ–­æˆ–è¿‡è½½ä¿æŠ¤çš„ç­–ç•¥ã€‚æµé‡æ˜¯æ£€æŸ¥æ•ˆæžœçš„å”¯ä¸€æ ‡å‡†ã€‚ç»è¿‡è¶³å¤Ÿå¤šæµé‡éªŒè¯çš„ categ çœŸæ˜¯éžå¸¸å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºåƒç†”æ–­ã€è¿‡è½½ä¿æŠ¤ç­‰è¿™äº›æœºåˆ¶ï¼Œæœ‰å¾ˆå¤šè¾¹ç•Œ caseï¼Œéœ€è¦å°†è¿™äº›è¾¹ç•Œ case éƒ½é€šè¿‡è‡ªå·±çš„æµé‡åŽ»éªŒè¯ã€‚
- **æµé‡æ˜¯æ£€éªŒæ•ˆæžœçš„å”¯ä¸€æ ‡å‡†ï¼Œç»è¿‡è¶³å¤Ÿå¤šæµé‡éªŒè¯çš„** **Kitex** **æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚** åœ¨å­—èŠ‚è·³åŠ¨ï¼Œç»è¿‡äº†è¶³å¤Ÿå¤šçš„éªŒè¯ï¼Œå¾ˆå¤šè¾¹ç•Œ case å·²ç»è§£å†³äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹© Kitex å¼€æºæ¡†æž¶ä¸€å®šæ˜¯éžå¸¸å¥½çš„é€‰æ‹©ã€‚

> Kitex Githubï¼šhttps://github.com/cloudwego/kitex
